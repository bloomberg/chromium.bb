<script>
// We load a page that has one iframe
// So we should receive two "all_frames" messages, and one "top_frame_only"
// messages.

var num_all_frames_messages = 0;
var num_top_frame_only_messages = 0;

chrome.test.runTests([
  // Tests receiving a request from a content script and responding.
  function onRequest() {
    chrome.extension.onRequest.addListener(
      function(request, sender, sendResponse) {
        if (request == "all_frames") {
          num_all_frames_messages++;
        } else if (request == "top_frame_only") {
          num_top_frame_only_messages++;
        } else {
          chrome.test.fail("Unexpected request: " + JSON.stringify(request));
        }

        if (num_all_frames_messages == 2 && num_top_frame_only_messages == 1) {
          chrome.test.succeed();
        }
      }
    );
  }
]);

chrome.test.log("Creating tab...");
chrome.tabs.create({
  url: "http://localhost:1337/files/extensions/test_file_with_iframe.html"
});
</script>
