<!DOCTYPE HTML>
<html>
<head>
<title>Canvas 2D Test: Red Box over Black Background</title>
<style type="text/css">
.nomargin {
  margin: 0px auto;
}
</style>
<script>
var g_swapsBeforeAck = 6;
var g_paintLoopStarted = false;

function main()
{
  g_swapsBeforeAck = 6;

  if (!g_paintLoopStarted) {
    g_paintLoopStarted = true;
    draw();
    waitForFinish();
  }
}

function draw()
{
  var canvas = document.getElementById("c");
  var c2d = canvas.getContext("2d");
  c2d.clearRect(0, 0, canvas.width, canvas.height);
  c2d.fillStyle = "rgba(255, 0, 0, 0.5)";
  c2d.fillRect(50, 50, 100, 100);
}

function waitForFinish()
{
  if (g_swapsBeforeAck == 0) {
    domAutomationController.setAutomationId(1);
    domAutomationController.send("resized");
  } else {
    g_swapsBeforeAck--;
    draw();
    window.webkitRequestAnimationFrame(waitForFinish);
  }
}

function notifyLoadFinished()
{
  domAutomationController.setAutomationId(1);
  domAutomationController.send("ok");
}

function preCallResizeInChromium()
{
  window.onresize = main;
  // Call main() on a timeout in case the window did not resize for whatever
  // reason.
  setTimeout(main, 10000);
}
</script>
</head>
<body onload="notifyLoadFinished()">
<div style="position:relative; width:200px; height:200px; background-color:black">
</div>
<div style="position:absolute; top:0px; left:0px">
<canvas id="c" width="200" height="200" class="nomargin"></canvas>
</div>
</body>
</html>
