<html i18n-values="dir:textdirection;">
<style type="text/css"><!--
  body,td,div,p,a,font,span {font-family: arial,sans-serif;}
  body { bgcolor:"#ffffff" } 
  A:link {color:#0000cc; } 
  A:visited { color:#551a8b; }
  A:active { color:#ff0000; }
  .form-noindent {background-color: #ffffff; border: #C3D9FF 1px solid}
--></style> 
  <head> 
    <style type="text/css"><!--
      .body { margin-left: 3em;
              margin-right: 5em;
              font-family: arial,sans-serif; }
      .endaligned {
        text-align: right;
      }
      html[dir='rtl'] .endaligned {
        text-align: left;
      }
      #gaia_account_text { font-weight: bold; }
      div.errorbox-good {}
      div.errorbox-bad {} 
      div.errormsg { color: red; font-size: smaller;
                     font-family: arial,sans-serif;
                     display: none;}
      font.errormsg { color: red; font-size: smaller;
                      font-family: arial,sans-serif;}
      div.errormsgspacer { min-height: 1em;}
      font.errormsgspacer { font-size: smaller;
                            font-family: arial,sans-serif;}
      
      hr {
        border: 0;
        background-color:#DDDDDD; 
        height: 1px;
        width: 100%;
        text-align: left;
        margin: 5px;
      }
      #gaia_loginform {
        margin-bottom: 0;
      }

    #captcha_wrapper {
      -webkit-background-size: 200px 70px;
      background: no-repeat;
      background-position: center;
      background-color: #e8eefa;
      display: block;
    }
    .captcha_image {
      display: block;
      width: 200px;
      height: 70px;
    }
    .toppageverticalspace {
      height: 15px;
    }
    .bottompaddedcell {
      padding-bottom: 3px;
    }
    .noverticalpadding {
      padding-top: 0;
      padding-bottom: 0;
    }
    .cancelspacenocaptcha {
      height: 22px;
    }
    .cancelspaceforcaptcha {
      height: 5px;
    }
    -->
  </style> 
  </head> 
  <body bgcolor="#ffffff" vlink="#666666"
        i18n-values=".style.fontFamily:fontfamily;.style.fontSize:fontsize"
        style="margin-bottom: 0; margin-top: 6px;" onload="initForm();"> 
  <table width="100%" align="center" cellpadding="1" cellspacing="1"> 
  <tr> 
  <td valign="top"> <!-- LOGIN BOX --> 
  <script>
    // Variable to track if a captcha challenge was issued. If this gets set to
    // true, it stays that way until we are told about successful login from
    // the browser.  This means subsequent errors (like invalid password) are
    // rendered in the captcha state, which is basically identical except we
    // don't show the top error blurb "Error Signing in" or the "Create
    // account" link.
    var g_is_captcha_challenge_active = false;

    // Taken from new_new_tab.js.
    // TODO(tim): Can this be unified?
    function url(s) {
      // http://www.w3.org/TR/css3-values/#uris
      // Parentheses, commas, whitespace characters, single quotes (') and
      // double quotes (") appearing in a URI must be escaped with a backslash
      var s2 = s.replace(/(\(|\)|\,|\s|\'|\"|\\)/g, '\\$1');
      // WebKit has a bug when it comes to URLs that end with \
      // https://bugs.webkit.org/show_bug.cgi?id=28885
      if (/\\\\$/.test(s2)) {
        // Add a space to work around the WebKit bug.
        s2 += ' ';
      }
      return 'url("' + s2 + '")';
    }

    function gaia_setFocus() {
      var f = null;
      if (document.getElementById) { 
        f = document.getElementById("gaia_loginform");
      } else if (window.gaia_loginform) { 
        f = window.gaia_loginform;
      } 
      if (f) {
        if (f.Email && (f.Email.value == null || f.Email.value == "")) {
          f.Email.focus();
        } else if (f.Passwd) {
          f.Passwd.focus();
        } 
      }
    }
 
    function advanceThrobber() {
      var throbber = document.getElementById('throb');
      throbber.style.backgroundPositionX =
      ((parseInt(throbber.style.backgroundPositionX) - 16) % 576) + 'px';
    }
 
    function showGaiaLogin(args) {
      var throbber = document.getElementById('throbber_container');
      throbber.style.display = "none";
      var f = document.getElementById("gaia_loginform");
      if (f) {        
        f.Email.value = args.user;
      }
      if (1 == args.error) {
        setElementDisplay("errormsg_1_Password", 'table-row');
        setBlurbError();
      }
      if (3 == args.error) {
        setElementDisplay("errormsg_0_Connection", 'table-row');
        setBlurbError();
      }
      if (4 == args.error) {
        showCaptcha(args);
      }
      document.getElementById("signIn").disabled = false;
      gaia_setFocus();
    }

    function showCaptcha(args) {
      g_is_captcha_challenge_active = true;

      // The captcha takes up lots of space, so make room.
      setElementDisplay("top_blurb", "none");
      setElementDisplay("top_blurb_error", "none");
      setElementDisplay("createaccountdiv", "none");
      setElementDisplay("topspacer", "none");
      var gaiaTable = document.getElementById('gaia_table');
      gaiaTable.cellPadding = 0;
      gaiaTable.cellSpacing = 1;
      document.getElementById('cancelspacer').className =
          "cancelspaceforcaptcha";
      document.getElementById('createaccountcell').height = 0;

      // It's showtime for the captcha now.
      setElementDisplay("captchadiv", "block");
      document.getElementById('Email').disabled = true;
      document.getElementById('Passwd').disabled = false;
      document.getElementById('CaptchaValue').disabled = false;
      document.getElementById('captcha_wrapper').style.backgroundImage =
          url(args.captchaUrl);
    }

    function CloseDialog() {
      chrome.send("DialogClose", [""]);
    }
    
    function showGaiaSuccessAndClose() {
      document.getElementById("signIn").value = templateData['success'];
      setTimeout(CloseDialog, 1600);
    }
    
    function showGaiaSuccessAndSettingUp() {
      document.getElementById("signIn").value = templateData['settingup'];
    }

    function initForm() {
      var acct_text = document.getElementById("gaia_account_text");
      var translated_text = acct_text.textContent;
      var posGoogle = translated_text.indexOf('Google');
      if (posGoogle != -1) {
        var ltr = templateData['textdirection'] == 'ltr';
        var googleIsAtEndOfSentence = posGoogle != 0;
        if (googleIsAtEndOfSentence == ltr) {
          // We're in ltr and in the translation the word 'Google' is AFTER the
          // word 'Account' OR we're in rtl and 'Google' is BEFORE 'Account'.
          var logo_td = document.getElementById('gaia_logo');
          logo_td.parentNode.appendChild(logo_td);
        }
        acct_text.textContent = translated_text.replace('Google','');
      }
      setInterval(advanceThrobber, 30);
      var args = JSON.parse(chrome.dialogArguments);
      showGaiaLogin(args);
    }

    function sendCredentialsAndClose() {
      if (!setErrorVisibility())
        return false;

      document.getElementById('Email').disabled = true;
      document.getElementById('Passwd').disabled = true;
      document.getElementById('CaptchaValue').disabled = true;
      var throbber = document.getElementById('throbber_container');
      throbber.style.display = "inline";
      var f = document.getElementById("gaia_loginform");
      var result = JSON.stringify({"user" : f.Email.value,
                                   "pass" : f.Passwd.value,
                                   "captcha" : f.CaptchaValue.value});
      document.getElementById("signIn").disabled = true;
      chrome.send("SubmitAuth", [result]);
    }
        
    function setElementDisplay(id, display) {
      var d = document.getElementById(id);
      if (d)
        d.style.display = display;
    }

    function setBlurbError() {
      if (g_is_captcha_challenge_active)
        return;  // No blurb in captcha challenge mode.
      document.getElementById("top_blurb").style.display = "none";
      document.getElementById("top_blurb_error").style.display = "block";
      document.getElementById('Email').disabled = false;
      document.getElementById('Passwd').disabled = false;
    }
    
    function resetErrorVisibility() {
      setElementDisplay("errormsg_0_Email", 'none');
      setElementDisplay("errormsg_0_Password", 'none');
      setElementDisplay("errormsg_1_Password", 'none');
      setElementDisplay("errormsg_0_Connection", 'none');
    }   
    
    function setErrorVisibility() {
      resetErrorVisibility();
      var f = document.getElementById("gaia_loginform");      
      if (null == f.Email.value || "" == f.Email.value) {
        setElementDisplay("errormsg_0_Email", 'table-row');
        setBlurbError();
        return false;
      }      
      if (null == f.Passwd.value || "" == f.Passwd.value) {
        setElementDisplay("errormsg_0_Password", 'table-row');
        setBlurbError();
        return false;
      }
      return true;
    }
  </script> 
<style type="text/css"><!--
  div.errormsg { color: red; font-size: smaller; font-family:arial,sans-serif; }
  font.errormsg { color: red; font-size: smaller; font-family:arial,sans-serif;}  
--></style> 
<style type="text/css"><!--
.gaia.le.lbl { font-family: Arial, Helvetica, sans-serif; font-size: smaller; }
.gaia.le.fpwd { font-family: Arial, Helvetica, sans-serif; font-size: 70%; }
.gaia.le.chusr { font-family: Arial, Helvetica, sans-serif; font-size: 70%; }
.gaia.le.val { font-family: Arial, Helvetica, sans-serif; font-size: smaller; }
.gaia.le.button { font-family: Arial, Helvetica, sans-serif; font-size: smaller; }
.gaia.le.rem { font-family: Arial, Helvetica, sans-serif; font-size: smaller; }
.gaia.captchahtml.desc { font-family: arial, sans-serif; font-size: smaller; } 
.gaia.captchahtml.cmt { font-family: arial, sans-serif; font-size: smaller;
                        font-style: italic; }
--></style> 
<div id="top_blurb">
  <p><font size="-1"><span i18n-content="introduction"></span></font></p>
</div>
<div id="top_blurb_error" style="display:none">
  <p><font size="-1">
    <span i18n-content="settingupsync"></span><br/><br/>
    <b><span i18n-content="errorsigningin"></span></b>
  </font></p>
</div>
<form id="gaia_loginform" onsubmit="sendCredentialsAndClose(); return false;"> 
<div id="gaia_loginbox"> 
<table id="content_table" class="form-noindent" cellspacing="0" cellpadding="5"
       width="75%" border="0" align="center"> 
  <tr> 
    <td valign="top" style="text-align:center" nowrap="nowrap"
        bgcolor="#e8eefa"> 
      <div> 
        <table id="gaia_table" align="center" border="0" cellpadding="1"
               cellspacing="0"> 
          <tr>
            <td id="topspacer" class="toppageverticalspace" colspan="2"></td>
          </tr>
          <tr> 
            <td colspan="2" align="center"> 
              <table> 
                <tr> 
                  <td valign="top" id="gaia_logo">
                    <img src="google_transparent.png" alt="Google">
                    </img> 
                  </td>  
                  <td valign="middle"> 
                    <font size="+0">
                      <span id="gaia_account_text" i18n-content="signinsuffix"></span>
                    </font> 
                  </td> 
                </tr> 
              </table> 
            </td> 
          </tr> 
          <script type="text/javascript"><!--
            function onPreCreateAccount() {
              return true;
            }
            function onPreLogin() {
              if (window["onlogin"] != null) {
                return onlogin(); 
              } else {
                return true;
              }
            }
          --></script> 
          <tr> 
            <td colspan="2" align="center"> </td> 
          </tr>
          <tr>
            <td nowrap="nowrap">
              <div class="endaligned">
                <span class="gaia le lbl" i18n-content="emaillabel">
                </span> 
              </div> 
            </td> 
            <td> 
              <input type="text" name="Email"  id="Email" size="18"
                     value="" class='gaia le val' /> 
            </td> 
          </tr>
          <tr> 
            <td></td> 
            <td>
              <div class="errormsg" id="errormsg_0_Email"
                   i18n-content="cannotbeblank">
              </div> 
            </td> 
          </tr>           
          <tr> 
            <td></td>
            <td></td>
          </tr>
          <tr>
            <td class="endaligned">
              <span class="gaia le lbl" i18n-content="passwordlabel">
              </span> 
            </td> 
            <td> 
              <input type="password" name="Passwd" id="Passwd" size="18"
                     class="gaia le val"/> 
            </td> 
          </tr>          
          <tr> 
            <td> 
            </td> 
            <td>
              <div class="errormsgspacer">
                <div class="errormsg" id="errormsg_0_Password"
                     i18n-content="cannotbeblank">
                </div> 
                <div class="errormsg" id="errormsg_1_Password">
                  <span i18n-content="invalidcredentials"></span>[<a i18n-values="href:invalidpasswordhelpurl" target="_blank">?</a>]
                </div>
              </div>  
            </td> 
          </tr>
          <tr>
            <td colspan="2">
              <div id="captchadiv" style="display:none">
                <table cellpadding="1" cellspacing="0" border="0">
                  <tbody>
                    <tr>
                      <td colspan="2" align="center" class="bottompaddedcell">
                        <font size="-1">
                          <span i18n-content="captchainstructions"></span>
                        </font>
                      </td>
                    </tr>
                    <tr>
                      <td colspan="2" align="center" class="bottompaddedcell">
                        <span id="captcha_wrapper">
                          <span class="captcha_image"></span>
                        </span>
                      </td>
                    </tr>
                    <tr>
                      <td colspan="2" align="center">
                        <input type="text" name="CaptchaValue"
                               id="CaptchaValue" size="18"
                               value="" class="gaia le val" /> 
                      </td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </td>
          </tr>
          <tr>
            <td colspan="2" align="center">
              <div class="errormsg" id="errormsg_0_Connection"
                   i18n-content="couldnotconnect">
              </div> 
            </td> 
          </tr>          
          <tr> 
            <td> 
            </td>
            <td>
            </td>
          </tr> 
          <tr> 
            <td colspan="2">
              <table align="center" cellpadding="0" cellspacing="0">
                <tr>
                  <td>
                    <div id="throbber_container" style="display:none;">
                      <div id="throb" style="background-image:url(throbber.png); 
                           width:16px; height:16px; background-position:0px;
                           margin:0px 10px 0px 10px">
                      </div>
                    </div>
                  </td>
                  <td class="noverticalpadding">
                    <input id="signIn" type="button" class="gaia le button"
                           name="signIn" i18n-values="value:signin"
                           onclick="sendCredentialsAndClose();" />
                  </td>
                </tr>
              </table>
            </td> 
          </tr>
          <tr id="ga-fprow"> 
            <td colspan="2" height="16.0" class="gaia le fpwd"
                align="center" valign="bottom">
              <a i18n-values="href:cannotaccessaccounturl"
                 target="_blank" i18n-content="cannotaccessaccount">
              </a> 
            </td>
          </tr> 
          <tr>
            <td id="createaccountcell" colspan="2" height="16.0"
                class="gaia le fpwd" align="center" valign="bottom">
              <div id="createaccountdiv">
                <a i18n-values="href:createnewaccounturl"
                   i18n-content="createaccount" target="_blank">
                </a>
              </div>
           </td> 
          </tr>
        </table> 
      </div> 
    </td> 
  </tr> 
</table> 
</div> 
</form> 
</td> 
</tr>
<tr>
  <td class="cancelspacenocaptcha" id="cancelspacer" colspan="2">
  </td>
</tr>
</table> 
<div class="endaligned">
  <input type="button" name="cancel" i18n-values="value:cancel"
         onclick="CloseDialog();" style="width:85" />
</div>
</body> 
</html>
