var n=analytics.getService("Data Saver Extension"),p=n.getTracker("UA-70446322-1"),r,t,u={},w=(new Date).getTime(),A=null,B=null,C=!1;
document.addEventListener("DOMContentLoaded",function(){"undefined"===typeof chrome.dataReductionProxy||"undefined"===typeof chrome.dataReductionProxy.dataUsageReportingEnabled?document.getElementById("chrome_incompatible").style.display="block":(chrome.dataReductionProxy.getDataUsage(D),chrome.management.getAll(I),document.getElementById("main").style.display="block",chrome.dataReductionProxy.spdyProxyEnabled.get({},J),chrome.dataReductionProxy.spdyProxyEnabled.onChange.addListener(J));document.getElementById("ext_name").innerText=
chrome.i18n.getMessage("extName");document.getElementById("chrome_incompatible_message").innerText=chrome.i18n.getMessage("versionNotCompatible");document.getElementById("loading").innerText=chrome.i18n.getMessage("loading");document.getElementById("proxy_control").addEventListener("change",K);$("#data_usage_label").text(chrome.i18n.getMessage("dataUsageLabel"));$("#data_savings_label").text(chrome.i18n.getMessage("dataSavingsLabel"));$("#data_savings").html(chrome.i18n.getMessage("dataSavings",['<span style="opacity:0;">',
"","","</span>"]));$("#data_usage").html(chrome.i18n.getMessage("dataUsage",["","",""]));$("#loading").css({top:$("#data_savings_graph").position().top+($("#data_savings_graph").outerHeight()-$("#loading").outerHeight())/2,left:$("#data_savings_graph").position().left+($("#data_savings_graph").outerWidth()-$("#loading").outerWidth())/2});L("#proxy_control_ui",!0);N();/mac/i.test(navigator.platform)&&setTimeout(function(){document.body.style.marginBottom="9px"},500)});
function D(a){t=a.data_usage_buckets;O()}
function P(a){if("undefined"===typeof r)return null;$("#proxy_control").prop("checked",r);r?($(".proxy_on").slideDown(500),$(".proxy_off").slideUp(500),chrome.browserAction.setIcon({path:{19:"./images/proxy-enabled19.webp",38:"./images/proxy-enabled38.webp"}})):($(".proxy_off").slideDown(500),$(".proxy_on").slideUp(500),chrome.browserAction.setIcon({path:{19:"./images/proxy-disabled19.png",38:"./images/proxy-disabled38.png"}}));if("undefined"===typeof t)return null;$("#loading:visible").hide();var e=
new Date,e=new Date(9E5*Math.ceil(e/9E5)),b=new Date(e-a),k=a/9E5;a=t.length-k;var d;d=k;var c={4:4,12:3,96:6,672:7};d=d in c?c[d]:10;var k=k/d,c=Array(d+1),f=Array(d+1);c[0]=0;for(var l=f[0]=0,g=0,h={},m=0;m<d;m++){for(var E=0,F=0,G=0;G<k;G++)for(var M=t[a+m*k+G],H=0;H<M.length;H++)for(var x=M[H],v=0;v<x.length;v++){var y=x[v].original_size,z=x[v].data_used;z>y&&(y=z);var E=E+y,F=F+z,q=x[v].hostname;q in h||(h[q]={hostname:q,original_size:0,data_used:0});h[q].data_used+=z;h[q].original_size+=y}c[m+
1]=l+E;f[m+1]=g+F;l=c[m+1];g=f[m+1]}Q(c,f,b,e,r);$(".data_savings_numbers").fadeTo(600,1);return h}function K(a){chrome.dataReductionProxy.spdyProxyEnabled.set({value:a.target.checked});p.sendEvent("Toggle Data Compression",a.target.checked)}function J(a){r="value"in a&&a.value;O()}
function Q(a,e,b,k,d){if(!C){var c=a.length,f=a[c-1],l=e[c-1],g=0==f?0:(f-l)/f;0>g&&(g=0,e=a,l=f);g=g.toLocaleString(navigator.language,{style:"percent",useGrouping:!1,minimumFractionDigits:1,maximumFractionDigits:1});$("#data_savings_value").text(chrome.i18n.getMessage("dataSavingsFormat",[R(f-l),g]));$("#data_usage_value").text(R(l));$("#data_savings").html(chrome.i18n.getMessage("dataSavings",['<span class="tab_animate">',R(f-l),g,"</span>"]));$("#data_usage").html(chrome.i18n.getMessage("dataUsage",
['<span class="tab_animate">',R(l),"</span>"]));l=Array(c);for(g=1;g<c;g++)l[g]="";var g=navigator.language,h={};864E5<=k-b?(h.day="numeric",h.month="numeric",864E5==k-b&&(h.hour="numeric",h.minute="numeric"),l[0]=b.toLocaleDateString(g,h),l[c-1]=k.toLocaleDateString(g,h)):(h.hour="numeric",h.minute="numeric",l[0]=b.toLocaleTimeString(g,h),l[c-1]=k.toLocaleTimeString(g,h));for(var m=S(f),g=0;g<c;g++)a[g]/=Math.pow(2,10*m),e[g]/=Math.pow(2,10*m);b=function(b){return chrome.i18n.getMessage(T(m),""+
b.value)};e={labels:l,datasets:[{fillColor:"rgba(66, 133, 244, 1)",strokeColor:"rgba(34, 85, 196, 1)",pointColor:"rgba(34, 85, 196, 1)",pointStrokeColor:"rgba(34, 85, 196, 1)",data:e}]};d&&e.datasets.splice(0,0,{fillColor:"rgba(217, 217, 217, 0.5)",strokeColor:"rgba(217 , 217, 217, 1)",data:a});a={animationSteps:40,animationEasing:"easeInOutSine",bezierCurveTension:.1,datasetStrokeWidth:1,onAnimationComplete:function(){C=!1},pointDotRadius:2,scaleBeginAtZero:!0,scaleIntegersOnly:!0,scaleLabel:b,showTooltips:!1,
scaleFontColor:"#969696"};null===A&&(d=document.getElementById("data_savings_graph").getContext("2d"),A=new Chart(d));B=A.Line(e,a)}}function I(a){for(var e=0;e<a.length;e++){var b=a[e],k="icons"in b&&0<b.icons.length&&"url"in b.icons[0]?b.icons[0].url:null;u[b.id]=[b.name,k]}}function S(a){if(0===a)return 0;a=Math.log(Math.abs(a))/Math.log(2);return Math.floor(a/10)}function T(a){var e=["sizeFormatBytes","sizeFormatKb","sizeFormatMb","sizeFormatGb","sizeFormatTb"];return e[a]}
function R(a){var e=S(a);a=a?a/Math.pow(2,10*e):0;return chrome.i18n.getMessage(T(e),[Number(a).toLocaleString(navigator.language,{useGrouping:!1,minimumFractionDigits:1,maximumFractionDigits:1})])}
function L(a,e){$(a).click(function(b){var a=$(this),d=a.parent();"static"===d.css("position")&&d.css({position:"relative"});e||d.css({overflow:"hidden"});0==d.find(".ink").length&&d.prepend('<span class="ink"></span>');var c=d.find(".ink");c.removeClass("animate");var f=Math.max(a.outerWidth(),a.outerHeight()),f=2*f;c.css({height:f,width:f});f=b.pageX-d.offset().left-c.width()/2;b=b.pageY-d.offset().top-c.height()/2;e&&(b=a.position(),f=b.left+(a.outerWidth()-c.width())/2,b=b.top+(a.outerHeight()-
c.height())/2);c.css({top:b+"px",left:f+"px"});c.addClass("animate")})};var U,V={};V[chrome.i18n.getMessage("labelOneHour")]=36E5;V[chrome.i18n.getMessage("labelHoursFormat","3")]=108E5;V[chrome.i18n.getMessage("labelOneDay")]=864E5;V[chrome.i18n.getMessage("labelDaysFormat","7")]=6048E5;V[chrome.i18n.getMessage("labelDaysFormat","30")]=2592E6;V[chrome.i18n.getMessage("labelDaysFormat","60")]=5184E6;var W=U=V,X;p.sendAppView("detailed_data_usage.html");
function N(){document.getElementById("reset_data").innerText=chrome.i18n.getMessage("resetData");document.getElementById("data_usage_breakdown_title").innerText=chrome.i18n.getMessage("dataUsageBreakDownTitle");document.getElementById("site_column_heading").innerText=chrome.i18n.getMessage("siteColumnHeading");document.getElementById("data_usage_column_heading").innerText=chrome.i18n.getMessage("dataUsageColumnHeading");document.getElementById("data_savings_column_heading").innerText=chrome.i18n.getMessage("dataSavingsColumnHeading");
document.getElementById("original_size_column_heading").innerText=chrome.i18n.getMessage("originalSizeColumnHeading");document.getElementById("delete_dialog").title=chrome.i18n.getMessage("deleteDataConfirmationHeading");document.getElementById("delete_dialog_message").innerText=chrome.i18n.getMessage("deleteDataConfirmationMessage");document.getElementById("info").title=chrome.i18n.getMessage("dataSavingsTooltipMessage");var a=[],e;for(e in W)a.push('<li><a href="#invisible_time_selector_panel">'),
a.push(e),a.push("</a></li>");$("#time_selector ul").html(a.join(""));$("#time_selector").tabs({active:3,activate:Y});L(".ui-tabs-anchor",!1);L("#reset_data",!1);$("#sites_table").tablesorter({sortInitialOrder:"desc",textExtraction:function(a){return $(a).attr("sort_by")||$(a).text()}}).on("sortStart",function(){$("#site_breakdown").fadeTo(0,0)}).on("sortEnd",function(a){$("#site_breakdown").fadeTo(0,1);X=a.target.config.sortList});$("#info").tooltip();document.getElementById("reset_data").onclick=
aa}
function aa(){var a={};a[chrome.i18n.getMessage("deleteDataUsageLabel")]=function(){var a=$(this);setTimeout(function(){t=t.map(function(){return[]});chrome.dataReductionProxy.clearDataSavings();O();a.dialog("close");p.sendEvent("Clear Data Usage","Confirm")},300)};a[chrome.i18n.getMessage("cancelDeleteDataUsageLabel")]=function(){var a=$(this);setTimeout(function(){a.dialog("close");p.sendEvent("Clear Data Usage","Cancel")},300)};$("#delete_dialog").dialog({modal:!0,height:236,width:384,show:{effect:"fade",duration:400},
hide:{effect:"fade",duration:400},buttons:a});L(".ui-button-text",!1);/mac/i.test(navigator.platform)&&$("body").addClass("mac");$($(".ui-dialog-buttonpane .ui-button")[0]).addClass("delete_button");p.sendEvent("Clear Data Usage","Initiate")}
function O(){var a=P(6048E5);document.getElementById("proxy_control_label").innerText=r?chrome.i18n.getMessage("labelDataSaverOn"):chrome.i18n.getMessage("labelDataSaverOff");Z(a);w&&(p.sendTiming("User Visible Delays","Detailed Usage Layout Completed",(new Date).getTime()-w),w=null)}
function Z(a){if(a){var e=Object.keys(a).map(function(b){return a[b]}),b=[],k;for(k in e){var d=e[k];b.push('<tr><td><span class="favicon_container">');b.push('<img class="favicon" src="');var c=d.hostname;if(-1!=c.indexOf("."))b.push("http://"),b.push(c),b.push("/favicon.ico");else if(c in u){var f=u[c],c=chrome.i18n.getMessage("chromeExtension",f[0]);(f=f[1])&&b.push(f)}b.push('"></span></span><span class="hostname" title="');b.push(c);b.push('">');35<c.length&&(c=c.substr(0,32)+"...");b.push(c);
b.push('</span></td><td class="proxy_on_col" sort_by="');b.push(d.original_size);b.push('">');b.push(R(d.original_size));b.push('</td><td sort_by="');b.push(d.data_used);b.push('">');b.push(R(d.data_used));b.push('</td><td class="proxy_on_col" sort_by="');b.push(d.original_size-d.data_used);b.push('">');c=d.original_size?(d.original_size-d.data_used)/d.original_size:0;c=c.toLocaleString(navigator.language,{style:"percent",useGrouping:!1,minimumFractionDigits:1,maximumFractionDigits:1});b.push(chrome.i18n.getMessage("dataSavingsFormat",
[R(d.original_size-d.data_used),c]));b.push("</td></tr>")}e=$(b.join(""));e.find("img.favicon").one("error",ba);$("#site_breakdown").empty();$("#site_breakdown").append(e);$("#sites_table").trigger("update").trigger("sorton",[X||[[2,1]]]);r?$(".proxy_on_col").show():$(".proxy_on_col").hide()}}function ba(){this.src="images/details-favicon.png"}
function Y(a,e){$(".tab_animate:visible").fadeTo(0,0);B.clear();$("#loading").show();var b=W[e.newTab.text()];setTimeout(function(){var a=(new Date).getTime(),d=P(b);Z(d);p.sendTiming("User Visible Delays","Time Selection Tab",(new Date).getTime()-a,""+b);$("#loading").hide();$(".tab_animate:visible").fadeTo(1,600)},0);p.sendEvent("Time Selection on Usage Graph",""+b)};
