var p=analytics.getService("Data Saver Extension"),q=p.getTracker("UA-70446322-1"),t,u,y=(new Date).getTime(),z=null,A=!1;
document.addEventListener("DOMContentLoaded",function(){"undefined"===typeof chrome.dataReductionProxy||"undefined"===typeof chrome.dataReductionProxy.dataUsageReportingEnabled?document.getElementById("chrome_incompatible").style.display="block":(chrome.dataReductionProxy.getDataUsage(E),chrome.management.getAll(F),document.getElementById("main").style.display="block",chrome.dataReductionProxy.spdyProxyEnabled.get({},G),chrome.dataReductionProxy.spdyProxyEnabled.onChange.addListener(G));document.getElementById("ext_name").innerText=
chrome.i18n.getMessage("extName");document.getElementById("chrome_incompatible_message").innerText=chrome.i18n.getMessage("versionNotCompatible");document.getElementById("loading").innerText=chrome.i18n.getMessage("loading");document.getElementById("proxy_control").addEventListener("change",H);$("#data_usage_label").text(chrome.i18n.getMessage("dataUsageLabel"));$("#data_savings_label").text(chrome.i18n.getMessage("dataSavingsLabel"));$("#data_savings").html(chrome.i18n.getMessage("dataSavings",['<span style="opacity:0;">',
"","","</span>"]));$("#data_usage").html(chrome.i18n.getMessage("dataUsage",["","",""]));$("#loading").css({top:$("#data_savings_graph").position().top+($("#data_savings_graph").outerHeight()-$("#loading").outerHeight())/2,left:$("#data_savings_graph").position().left+($("#data_savings_graph").outerWidth()-$("#loading").outerWidth())/2});I("#proxy_control_ui",!0);K();/mac/i.test(navigator.platform)&&setTimeout(function(){document.body.style.marginBottom="9px"},500)});
function E(a){u=a.data_usage_buckets;L()}function H(a){chrome.dataReductionProxy.spdyProxyEnabled.set({value:a.target.checked});q.sendEvent("Toggle Data Compression",a.target.checked)}function G(a){t="value"in a&&a.value;L()}
function M(a,b,l,g,h){if(!A){var d=a.length,e=a[d-1],k=b[d-1],c=0==e?0:(e-k)/e;0>c&&(c=0,b=a,k=e);c=c.toLocaleString(navigator.language,{style:"percent",useGrouping:!1,minimumFractionDigits:1,maximumFractionDigits:1});$("#data_savings_value").text(chrome.i18n.getMessage("dataSavingsFormat",[N(e-k),c]));$("#data_usage_value").text(N(k));$("#data_savings").html(chrome.i18n.getMessage("dataSavings",['<span class="tab_animate">',N(e-k),c,"</span>"]));$("#data_usage").html(chrome.i18n.getMessage("dataUsage",
['<span class="tab_animate">',N(k),"</span>"]));k=Array(d);for(c=1;c<d;c++)k[c]="";var c=navigator.language,f={};864E5<=g-l?(f.day="numeric",f.month="numeric",864E5==g-l&&(f.hour="numeric",f.minute="numeric"),k[0]=l.toLocaleDateString(c,f),k[d-1]=g.toLocaleDateString(c,f)):(f.hour="numeric",f.minute="numeric",k[0]=l.toLocaleTimeString(c,f),k[d-1]=g.toLocaleTimeString(c,f));for(var m=O(e),c=0;c<d;c++)a[c]/=Math.pow(2,10*m),b[c]/=Math.pow(2,10*m);l=function(a){return chrome.i18n.getMessage(P(m),""+
a.value)};b={labels:k,datasets:[{fillColor:"rgba(66, 133, 244, 1)",strokeColor:"rgba(34, 85, 196, 1)",pointColor:"rgba(34, 85, 196, 1)",pointStrokeColor:"rgba(34, 85, 196, 1)",data:b}]};h&&b.datasets.splice(0,0,{fillColor:"rgba(217, 217, 217, 0.5)",strokeColor:"rgba(217 , 217, 217, 1)",data:a});a={animationSteps:40,animationEasing:"easeInOutSine",bezierCurveTension:.1,datasetStrokeWidth:1,onAnimationComplete:function(){A=!1},pointDotRadius:2,scaleBeginAtZero:!0,scaleIntegersOnly:!0,scaleLabel:l,showTooltips:!1,
scaleFontColor:"#969696"};null===z&&(h=document.getElementById("data_savings_graph").getContext("2d"),z=new Chart(h));z.Line(b,a)}}function F(a){for(var b=0;b<a.length;b++);}function O(a){if(0===a)return 0;a=Math.log(Math.abs(a))/Math.log(2);return Math.floor(a/10)}function P(a){var b=["sizeFormatBytes","sizeFormatKb","sizeFormatMb","sizeFormatGb","sizeFormatTb"];return b[a]}
function N(a){var b=O(a);a=a?a/Math.pow(2,10*b):0;return chrome.i18n.getMessage(P(b),[Number(a).toLocaleString(navigator.language,{useGrouping:!1,minimumFractionDigits:1,maximumFractionDigits:1})])}
function I(a,b){$(a).click(function(a){var g=$(this),h=g.parent();"static"===h.css("position")&&h.css({position:"relative"});b||h.css({overflow:"hidden"});0==h.find(".ink").length&&h.prepend('<span class="ink"></span>');var d=h.find(".ink");d.removeClass("animate");var e=Math.max(g.outerWidth(),g.outerHeight()),e=2*e;d.css({height:e,width:e});e=a.pageX-h.offset().left-d.width()/2;a=a.pageY-h.offset().top-d.height()/2;b&&(a=g.position(),e=a.left+(g.outerWidth()-d.width())/2,a=a.top+(g.outerHeight()-
d.height())/2);d.css({top:a+"px",left:e+"px"});d.addClass("animate")})};q.sendAppView("popup.html");
function L(){var a=2592E6;if("undefined"!==typeof t&&($("#proxy_control").prop("checked",t),t?($(".proxy_on").slideDown(500),$(".proxy_off").slideUp(500),chrome.browserAction.setIcon({path:{19:"./images/proxy-enabled19.webp",38:"./images/proxy-enabled38.webp"}})):($(".proxy_off").slideDown(500),$(".proxy_on").slideUp(500),chrome.browserAction.setIcon({path:{19:"./images/proxy-disabled19.png",38:"./images/proxy-disabled38.png"}})),"undefined"!==typeof u)){$("#loading:visible").hide();var b=new Date,
b=new Date(9E5*Math.ceil(b/9E5)),l=new Date(b-a),g=a/9E5,a=u.length-g,g=g/3,h=Array(4),d=Array(4);h[0]=0;for(var e=d[0]=0,k=0,c={},f=0;3>f;f++){for(var m=0,B=0,C=0;C<g;C++)for(var J=u[a+f*g+C],D=0;D<J.length;D++)for(var v=J[D],r=0;r<v.length;r++){var w=v[r].original_size,x=v[r].data_used;x>w&&(w=x);var m=m+w,B=B+x,n=v[r].hostname;n in c||(c[n]={hostname:n,original_size:0,data_used:0});c[n].data_used+=x;c[n].original_size+=w}h[f+1]=e+m;d[f+1]=k+B;e=h[f+1];k=d[f+1]}M(h,d,l,b,t);$(".data_savings_numbers").fadeTo(600,
1)}y&&(q.sendTiming("User Visible Delays","Popup Layout Completed",(new Date).getTime()-y),y=null)}
function K(){document.getElementById("learn_more").innerText=chrome.i18n.getMessage("learnMoreLinkText");document.getElementById("detailed_usage_link").innerText=chrome.i18n.getMessage("detailedDataUsageLinkText");var a=$("#learn_more"),b=$("#detailed_usage_link"),l=$("#links_panel");a.outerWidth()+b.outerWidth()>l.outerWidth()&&(a.width("100%"),a.css("padding","0"),a.css("line-height","48px"),b.width("100%"),b.css("padding","0"),b.css("line-height","48px"),$(".ripple_button_container").height("46px"),
$(".ripple_button_container").width("100%"),$("#divider_line_overflow").show(),l.css("text-align","center"),l.css("margin-right","0"));I("#learn_more",!1);I("#detailed_usage_link",!1);$("#learn_more").click(function(){setTimeout(function(){window.open("https://support.google.com/chrome/?p=data_saver_off","learnmore");q.sendEvent("Navigation","Learn More Link")},300)});$("#detailed_usage_link").click(function(){setTimeout(function(){window.open(chrome.extension.getURL("detailed_data_usage.html"),"detailed_data_usage");
q.sendEvent("Navigation","Detailed Data Usage Link")},300)})};
