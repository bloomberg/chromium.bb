# Copyright 2017 The Chromium Authors. All rights reserved.
# Use of this source code is governed by a BSD-style license that can be
# found in the LICENSE file.

# This is a .pyl, or "Python Literal", file. You can treat it just like a
# .json file, with the following exceptions:
# * all keys must be quoted (use single quotes, please);
# * comments are allowed, using '#' syntax; and
# * trailing commas are allowed.

# Exceptions to the common test suites can only include removal from
# particular bots, and modifications on particular bots. By design,
# it's not possible to add one-off tests to bots. Instead they have to
# be added to one of the test suites in test_suites.pyl.
#
# Note that if you are excluding with variants, you will need to exclude
# per variant, with the identifier appended to the test suite name.
# For example, if you have ios_chrome_ui_eg2tests_module with variant
# SIM_IPHONE_6S_14_0 (identifier = "iPhone 6s 14.0"), you
# must exclude with the test name as:
# "ios_chrome_ui_eg2tests_module_iPhone 6s 14.0"

# The goal is to drive the number of exceptions to zero, to make all
# the bots behave similarly.
{
  'android_browsertests': {
    'modifications': {
      'android-11-x86-fyi-rel': {
        'swarming': {
          'shards': 2,
        },
      },
      'android-pie-arm64-rel': {
        'args': [
          '--gtest_filter=-ImportantSitesUtilBrowserTest.DSENotConsideredImportantInRegularMode', # https://crbug.com/1034001
        ],
        # TODO(crbug.com/1111436): Move this back to walleye if/when additional
        # capacity has been deployed.
        'swarming': {
          'dimension_sets': [
            {
              'device_type': 'sailfish',
            },
          ],
          'shards': 2,
        },
      },
      'android-pie-x86-rel': {
        'args': [
          '--gtest_filter=-ImportantSitesUtilBrowserTest.DSENotConsideredImportantInRegularMode', # https://crbug.com/1034001
        ],
        'swarming': {
          'shards': 2,
        },
      },
    },
  },
  'android_sync_integration_tests': {
   'remove_from': [
     # Remove from CQ bots due to capacity.
     'android-marshmallow-arm64-rel',
     'android-lollipop-arm-rel',
   ],
  },
  'android_webview_unittests': {
    'remove_from': [
      # On chromium.android, these do not need to run prior to M.
      'android-lollipop-arm-rel',
    ],
  },
  'angle_end2end_tests': {
    'remove_from': [
      # TODO(ynovikov) Investigate why the test breaks on older devices.
      'Android FYI Release (Nexus 5)',
      'Android FYI Release (Nexus 6)',
      'Android FYI Release (Nexus 9)',
      # Temporarily disabled due to bad NVIDIA driver upgrade crbug.com/950542
      'Linux FYI Debug (NVIDIA)',
    ],
    'modifications': {
      # anglebug.com/5328 suspecting blue screen caused by multiprocess
      'Optional Win10 x64 Release (Intel HD 630)': {
        'args': [
          '--max-processes=1',
        ],
      },
      'Win10 FYI x64 Exp Release (Intel HD 630)': {
        'args': [
          '--max-processes=1',
        ],
      },
      'Win10 FYI x64 Release (Intel HD 630)': {
        'args': [
          '--max-processes=1',
        ],
      },
      'win10-angle-x64-intel': {
        'args': [
          '--max-processes=1',
        ],
      },
    },
    'replacements': {
      'Linux FYI Release (AMD RX 5500 XT)': {
        'args': {
          '--max-processes': '1',
        },
      },
    },
  },
  'angle_gles1_conformance_tests': {
    'replacements': {
      'Win10 FYI x64 Debug (NVIDIA)': {
        'args': {
          '--test-timeout': '60',
        },
      },
    },
  },
  'angle_perftests': {
    'remove_from': [
      'Android FYI Release (Nexus 5)',  # crbug.com/915429
      'Android FYI Release (Nexus 6)',  # anglebug.com/2433
      'Linux FYI GPU TSAN Release',  # crbug.com/950542
    ],
  },
  'angle_unittests': {
    'remove_from': [
      # On Android, these are already run on the main waterfall.
      'Android FYI Release (Nexus 5X)',
      # Times out listing tests crbug.com/1167314
      'android-asan',
      # Does not currently work on Lacros configurations.
      'linux-lacros-code-coverage',
      'linux-lacros-tester-rel',
      'linux-lacros-tester-fyi-rel',
    ],
  },
  'angle_white_box_tests': {
    'modifications': {
      # anglebug.com/5328 suspecting blue screen caused by multiprocess
      'Optional Win10 x64 Release (Intel HD 630)': {
        'args': [
          '--max-processes=1',
        ],
      },
      'Win10 FYI x64 Exp Release (Intel HD 630)': {
        'args': [
          '--max-processes=1',
        ],
      },
      'Win10 FYI x64 Release (Intel HD 630)': {
        'args': [
          '--max-processes=1',
        ],
      },
      'win10-angle-x64-intel': {
        'args': [
          '--max-processes=1',
        ],
      },
    },
  },
  'aura_unittests_amd64-generic': {
    'remove_from': [
      # TODO(crbug.com/1204231): Re-enable.
      'lacros-amd64-generic-rel',
    ]
  },
  'base_unittests': {
    'modifications': {
      'android-11-x86-fyi-rel': {
        'args': [
          '--test-launcher-filter-file=../../testing/buildbot/filters/android.emulator_11.base_unittests.filter',
        ],
      },
      'fuchsia-code-coverage': {
        'swarming': {
          'shards': 5,
        },
      },
    },
  },
  'blink_platform_unittests': {
    'modifications': {
      # TODO(crbug.com/1108121): Remove this filter
      'android-nougat-arm64-rel': {
        'args': [
          '--gtest_filter=-HarfBuzzShaperTest.ShapeHorizontalWithoutSubpixelPositionWithKerningIsRounded',
        ],
      },
      'android-pie-arm64-rel': {
        # TODO(crbug.com/1111436): Move this back to walleye if/when additional
        # capacity has been deployed.
        'swarming': {
          'dimension_sets': [
            {
              'device_type': 'sailfish',
            },
          ],
        },
      },
      'fuchsia-code-coverage': {
        'swarming': {
          'shards': 5,
        },
      },
    },
  },
  'blink_unittests': {
    'modifications': {
      'fuchsia-code-coverage': {
        'swarming': {
          'shards': 30,
        },
      },
    },
  },
  'blink_web_tests': {
    'remove_from': [
      'Mac10.11 Tests',
      'Win 7 Tests x64 (1)',  # 64-bit win is unsupported by the layout tests.
      'Win10 Tests x64 (dbg)',
    ],
    'modifications': {
      'Fuchsia x64': {
        'args': [
          '--platform=fuchsia',
        ],
        'swarming': {
          'shards': 1,
        },
      },
      'Linux Tests': {
        "args": [
          "--additional-env-var=LLVM_PROFILE_FILE=${ISOLATED_OUTDIR}/profraw/default-%2m.profraw",
        ],
      },
      'Linux Tests (dbg)(1)': {
        'args': [
          '--debug',
        ],
        'swarming': {
          'shards': 25,
        },
      },
      'Mac10.11 Tests': {
        # TODO(kbr): this is essentially redundant.
        'swarming': {
          'dimension_sets': [
            {
              'cpu': 'x86-64',
              'gpu': 'none',
              'os': 'Mac-10.11.6',
            },
          ],
          'shards': 25,
        },
      },
      'Mac10.12 Tests': {
        'swarming': {
          'shards': 25,
        },
      },
      'Mac10.13 Tests': {
        'swarming': {
          'dimension_sets': [
            {
              'gpu': None,
            },
          ],
          'shards': 25,
        },
      },
      'Mac10.15 Tests': {
        'swarming': {
          'dimension_sets': [
            {
              'gpu': None,
            },
          ],
          'shards': 25,
        },
      },
      'Mac10.15 Tests (dbg)': {
        'args': [
          '--debug',
        ],
        'swarming': {
          'shards': 25,
        },
      },
      'Mac11 Tests': {
        # TODO(crbug.com/1206401): Restore to defaults when there is
        # enough capacity.
        'swarming': {
          'dimension_sets': [
            {
              'machine_type': 'n1-standard-4',
            },
          ],
          'hard_timeout': 4500,
          'shards': 5,
        },
      },
      'ToTFuchsia x64': {
        'args': [
          '--platform=fuchsia',
        ],
        'swarming': {
          'shards': 1,
        },
      },
      'V8 Blink Linux Debug': {
        # This builder compiles Chromium in release mode, but V8 in debug.
        # TODO(machenbach): Change name and out directory of this builder to
        # something less confusing.
        'args': [
          '-t',
          'Debug',
          '--release',
        ],
      },
      'V8 Blink Linux Future': {
        'args': [
          '--additional-driver-flag=--js-flags=--future',
        ],
      },
      'WebKit Linux ASAN': {
        'args': [
          '--additional-expectations',
          '../../third_party/blink/web_tests/ASANExpectations',
          '--time-out-ms',
          '48000',
          '--enable-sanitizer',
        ],
        'swarming': {
          'shards': 20,
        },
      },
      'WebKit Linux Leak': {
        'args': [
          '--additional-expectations',
          '../../third_party/blink/web_tests/LeakExpectations',
          '--time-out-ms',
          '48000',
          '--enable-leak-detection',
        ],
        'swarming': {
          'shards': 10,
        },
      },
      'WebKit Linux MSAN': {
        'args': [
          '--additional-expectations',
          '../../third_party/blink/web_tests/MSANExpectations',
          '--time-out-ms',
          '66000',
          '--enable-sanitizer',
        ],
        'swarming': {
          'expiration': 36000,
          'hard_timeout': 10800,
          'io_timeout': 3600,
          'shards': 20,
        },
      },
      'WebKit Linux composite_after_paint Dummy Builder': {
        'args': [
          '--additional-driver-flag=--enable-blink-features=CompositeAfterPaint',
        ],
        'swarming': {
          'shards': 20,
        },
      },
      'WebKit Linux layout_ng_disabled Builder': {
        'args': [
          '--additional-driver-flag=--disable-blink-features=LayoutNG',
        ],
        'swarming': {
          'shards': 20,
        },
      },
      'Win10 Tests x64': {
        'args': [
          '--target',
          'Release_x64',
        ],
        'swarming': {
          "shards": 28
        },
      },
      'Win10 Tests x64 (dbg)': {
        'args': [
          '--debug',
          '--target',
          'Debug_x64',
        ],
      },
      'Win7 Tests (dbg)(1)': {
        'args': [
          '--debug',
          '--time-out-ms',
          '60000'
        ],
        'experiment_percentage': 100,
        # TODO(kbr): the "Windows-7-SP1" Swarming dimension set is implicit,
        # from prefered_os_dimension in
        # tools/build/scripts/slave/recipe_modules/swarming/api.py. Ideally,
        # Swarming dimensions would be either specified for all testers on the
        # waterfall (and therefore, explicitly specified for all tests in the
        # generated JSON), or this would be removed, and the implicit one used.
        'swarming': {
          'dimension_sets': [
            {
              'os': 'Windows-7-SP1',
            }
          ],
        },
      },
      # tryserver.chromium.android
      'android_blink_rel': {
        'args': [
          '--release',
          '--android',
          # TODO(crbug.com/912120): Breakpad was entirely disabled on
          # Android. Remove this when it no longer affects Android crash
          # log handling.
          '--disable-breakpad',
          # TODO(crbug.com/875172): run on the real GPU since the
          # software fallback, SwiftShader, isn't yet for 32-bit ARM.
          '--additional-driver-flag=--use-gpu-in-tests',
        ],
      },
      'devtools_frontend_linux_blink_light_rel': {
        'args': [
          'http/tests/devtools',
        ],
        'swarming': {
          'shards': 4,
        },
      },
      'fuchsia-fyi-x64-rel': {
        'args': [
          '--platform=fuchsia',
        ],
        'swarming': {
          'shards': 1,
        },
      },
      'linux-autofill-assistant': {
        'args': [
          '--release',
        ],
      },
      'linux-bfcache-rel': {
        'args': [
          '--additional-driver-flag=--enable-features=BackForwardCache:enable_same_site/true',
          '--additional-expectations=../../third_party/blink/web_tests/FlagExpectations/enable-features=BackForwardCache',
        ],
      },
      'linux-blink-animation-use-time-delta': {
        'args': [
          '--debug',
        ],
      },
      'linux-blink-heap-concurrent-marking-tsan-rel': {
        'args': [
          '--release',
          '--additional-driver-flag=--enable-features=BlinkHeapConcurrentMarking',
        ],
      },
      'linux-blink-web-tests-force-accessibility-rel': {
        'args': [
          '--additional-driver-flag=--force-renderer-accessibility',
        ],
      },
      'linux-code-coverage': {
        'args': [
          '--additional-env-var=LLVM_PROFILE_FILE=${ISOLATED_OUTDIR}/profraw/default-%2m.profraw',
        ],
        'swarming': {
          'shards': 20,
        },
      },
      'linux-layout-tests-edit-ng': {
        'args': [
          '--additional-driver-flag=--enable-blink-features=EditingNG',
        ],
      },
      'linux-xenial-rel': {
        "args": [
          "--additional-env-var=LLVM_PROFILE_FILE=${ISOLATED_OUTDIR}/profraw/default-%2m.profraw",
        ],
      },
      'mac10.12-blink-rel-dummy': {
        'swarming': {
          'shards': 20,
        },
      },
      'mac10.13-blink-rel-dummy': {
        'swarming': {
          'shards': 20,
        },
      },
      'mac10.14-blink-rel-dummy': {
        'swarming': {
          # Increase timeout and reduce shards.
          # See https://crbug.com/1203565.
          'shards': 12,
          'hard_timeout': 1800,
        },
      },
      'mac10.15-blink-rel-dummy': {
        'swarming': {
          'shards': 20,
        },
      },
      'mac11.0-blink-rel-dummy': {
        # TODO(crbug.com/1206401): Restore to defaults when there is
        # enough capacity.
        'swarming': {
          'dimension_sets': [
            {
              'machine_type': 'n1-standard-4',
            },
          ],
          'hard_timeout': 4500,
          'shards': 5,
        },
      },
      'win10-blink-rel-dummy': {
        'swarming': {
          'hard_timeout': 1200,
        },
      },
    },
  },
  'breakpad_unittests': {
    'modifications': {
      'android-asan': {
        'args': [
          '--test-launcher-filter-file=../../testing/buildbot/filters/android.asan.breakpad_unittests.filter',
        ],
      },
    },
  },
  'browser_tests': {
    'remove_from': [
      'CrWinAsan(dll)', # https://crbug.com/935598
      'linux-win_cross-rel',
      'ToTLinuxTSan',  # https://crbug.com/368525
      # TODO(crbug.com/1171053): Enable the suite in 'Mac10.13 Tests' once it's
      # off CQ.
      'Mac10.13 Tests', # https://crbug.com/1042757
      'Mac10.15 Tests', # https://crbug.com/1042757
      'Mac10.15 Tests (dbg)', # https://crbug.com/1201386
      'mac-code-coverage', # https://crbug.com/1201386
      'Linux TSan (bionic)',  # https://crbug.com/368525
      'Linux TSan Tests',  # https://crbug.com/368525
      # TODO(crbug.com/1200904): Remove after migration
      'Win10 Tests x64 (dbg)',
    ],
    'modifications': {
      'CrWinAsan': {
        # These are very slow on the ASAN trybot for some reason.
        # crbug.com/794372
        'swarming': {
          'shards': 40,
        },
      },
      'CrWinAsan(dll)': {
        # These are very slow on the ASAN trybot for some reason.
        # crbug.com/794372
        'swarming': {
          'shards': 40,
        },
      },
      'Linux - Future (dbg)': {  # client.v8.chromium
        'swarming': {
          'shards': 10,
        },
      },
      'Linux ASan LSan Tests (1)': {
        # These are very slow on the ASAN trybot for some reason.
        # crbug.com/794372
        'swarming': {
          'shards': 40,
        },
      },
      'Linux ASan Tests (sandboxed)': {
        'swarming': {
          'shards': 30, # https://crbug.com/1103330
        },
      },
      'Linux Chromium OS ASan LSan Tests (1)': {
        # These are very slow on the ASAN trybot for some reason.
        # crbug.com/794372
        'swarming': {
          'shards': 31,
        },
      },
      'Linux ChromiumOS MSan Tests': {
        # These are very slow on the Chrome OS MSAN trybot for some reason.
        # crbug.com/865455
        'swarming': {
          'shards': 32,
        },
        'args': [
          '--test-launcher-filter-file=../../testing/buildbot/filters/chromeos.msan.browser_tests.oobe_negative.filter',
        ],
      },
      'Linux Tests (dbg)(1)': {
        # crbug.com/1066161
        'swarming': {
          'shards': 20,
        },
      },
      'Mac ASan 64 Tests (1)': {
        'swarming': {
          'shards': 30,
        },
        # crbug.com/1196416
        'args': [
          '--test-launcher-filter-file=../../testing/buildbot/filters/mac.mac-rel.browser_tests.filter',
        ],
      },
      'Mac10.15 Tests': {
        # crbug.com/1042757
        'swarming': {
          'dimension_sets': [
            {
              # These shards are liable to time out when running on macmini7,1.
              'cores': '8|12',
            }
          ],
        },
        # crbug.com/1196416
        'args': [
          '--test-launcher-filter-file=../../testing/buildbot/filters/mac.mac-rel.browser_tests.filter',
        ],
      },
      'Mac11 Tests': {
        # TODO(crbug.com/1206401): Restore to defaults when there is enough
        # capacity.
        'swarming': {
          'dimension_sets': [
            {
              'machine_type': 'n1-standard-4',
            }
          ],
          'hard_timeout': 4500,
          'shards': 8,
        },
      },
      'ToTWin(dbg)': {
        'swarming': {
          'shards': 20,
        },
      },
      'ToTWin64(dbg)': {
        'swarming': {
          'shards': 20,
        },
      },
      'Win10 Tests x64': {
        # crbug.com/868082
        'args': [
          '--disable-features=WebRTC-H264WithOpenH264FFmpeg',
        ],
        'swarming': {
          # This is for slow test execution that often becomes a critical path of
          # swarming jobs. crbug.com/868114
          'shards': 15,
        }
      },
      'Win7 Tests (1)': {
        # This is for slow test execution that often becomes a critical path of
        # swarming jobs. crbug.com/868114
        'swarming': {
          'shards': 15,
        },
      },
      'Win7 Tests (dbg)(1)': {
        'swarming': {
          'shards': 20,
        },
      },
      'linux-chromeos-chrome': {
        # TODO(https://crbug.com/932269): Promote out of experiment when the
        # tests are green.
        'args': [
          '--test-launcher-filter-file=../../testing/buildbot/filters/chromeos.browser_tests.filter',
        ],
      },
      'linux-chromeos-code-coverage': {
        'swarming': {
          'shards': 50,
        },
      },
      'linux-chromeos-dbg': {
        'swarming': {
          'shards': 40,
        },
      },
      'linux-chromeos-ltc': {
        'args': [
          '--test-launcher-filter-file=../../testing/buildbot/filters/chromeos.browser_tests.filter',
        ],
      },
      'linux-chromeos-lts': {
        'args': [
          '--test-launcher-filter-file=../../testing/buildbot/filters/chromeos.browser_tests.filter',
        ],
      },
      'linux-chromeos-rel': {
        'swarming': {
          'shards': 20,
          'dimension_sets': [
            {
              'kvm': '1',
            },
          ],
        },
      },
      'linux-code-coverage': {
        'args': [
          '--no-sandbox',
        ],
        'swarming': {
          'shards': 50,
        },
      },
      'linux-lacros-code-coverage': {
        'args': [
          '--test-launcher-filter-file=../../testing/buildbot/filters/linux-lacros.browser_tests.filter',
        ],
      },
      'linux-lacros-rel': {
        'args': [
          '--test-launcher-filter-file=../../testing/buildbot/filters/linux-lacros.browser_tests.filter',
        ],
      },
      'linux-lacros-tester-rel': {
        'args': [
          '--test-launcher-filter-file=../../testing/buildbot/filters/linux-lacros.browser_tests.filter',
        ],
      },
      'linux-trusty-rel': {
       'args': [
          '--test-launcher-filter-file=../../testing/buildbot/filters/linux_trusty_rel.browser_tests.filter',
        ],
      },
      'win-asan': {
        # These are very slow on the ASAN trybot for some reason.
        # crbug.com/794372
        'swarming': {
          'shards': 40,
        },
      },
    },
  },
  'browser_tests_wayland': {
    'modifications': {
      # CQ tester.
      'Linux Ozone Tester (Wayland)': {
        'args': [
          '--test-launcher-filter-file=../../testing/buildbot/filters/ozone-linux.wayland_browser_tests.filter',
        ],
      },
      # CI tester.
      'Linux Tester (Ozone Wayland)': {
        'args': [
          '--test-launcher-filter-file=../../testing/buildbot/filters/ozone-linux.wayland_browser_tests.filter',
        ],
      },
    },
  },
  'cc_unittests': {
    'modifications': {
      # TODO(crbug.com/1200904): Remove after migration
      'Linux TSan (bionic)': {
        'swarming': {
          'shards': 3,
        },
      },
      'Linux TSan Tests': {
        'swarming': {
          'shards': 3,
        },
      },
      'android-11-x86-fyi-rel': {
        # https://crbug.com/1039860
        'args': [
          '--test-launcher-filter-file=../../testing/buildbot/filters/android.emulator_11.cc_unittests.filter',
        ],
      },
      'android-marshmallow-x86-rel-non-cq': {
        # https://crbug.com/1039860
        'args': [
          '--test-launcher-filter-file=../../testing/buildbot/filters/android.emulator.cc_unittests.filter',
        ],
      },
      'android-pie-x86-rel': {
        # https://crbug.com/1039860
        'args': [
          '--test-launcher-filter-file=../../testing/buildbot/filters/android.emulator.cc_unittests.filter',
        ],
      },
      'fuchsia-code-coverage': {
        'swarming': {
          'shards': 4,
        },
      },
    },
  },
  'check_static_initializers': {
    'modifications': {
      'Mac Builder': {
        'args': [
          '--allow-coverage-initializer',
        ],
      },
    },
  },
  'checkbins': {
    'remove_from': [
      'linux-archive-dbg',
      'linux-archive-rel',
      'mac-archive-dbg',
      'mac-archive-rel',
      'mac-arm64-archive-dbg',
      'mac-arm64-archive-rel',
    ],
  },
  'chrome_all_tast_tests': {
    'modifications': {
      'chromeos-betty-pi-arc-cfi-thin-lto-chrome': {
        'args': [
          # This bot sets symbol_level=2, which doesn't fit inside a normal VM.
          '--strip-chrome',
        ],
      },
    },
  },
  'chrome_java_test_pagecontroller_tests': {
    'modifications': {
      'android-pie-arm64-rel': {
        # TODO(crbug.com/1111436): Move this back to walleye if/when additional
        # capacity has been deployed.
        'swarming': {
          'dimension_sets': [
            {
              'device_type': 'sailfish',
            },
          ],
        },
      },
    },
  },
  'chrome_modern_public_bundle_fake_modules_smoke_test': {
    'remove_from': [
      # Runs on android-marshmallow-x86-rel already (crbug.com/1127110)
      'android-marshmallow-arm64-rel',
    ],
  },
  'chrome_modern_public_bundle_smoke_test': {
    'remove_from': [
      # Runs on android-marshmallow-x86-rel already (crbug.com/1127110)
      'android-marshmallow-arm64-rel',
    ],
  },
  'chrome_public_smoke_test': {
    'remove_from': [
      'android-code-coverage-native', # Does not generate profraw data.
      'android-pie-arm64-coverage-experimental-rel', # Does not generate profraw data.
      # Runs on android-marshmallow-x86-rel already (crbug.com/1127110#c21)
      'android-marshmallow-arm64-rel',
    ],
  },
  'chrome_public_test_apk': {
    'remove_from': [
      'android-asan',  # https://crbug.com/964562
      'android-code-coverage-native', # Does not generate profraw data.
      'android-lollipop-arm-rel', # https://crbug.com/1060245
      'android-pie-arm64-coverage-experimental-rel', # Does not generate profraw data.

      # Runs on android-marshmallow-x86-rel already (crbug.com/1127110)
      'android-marshmallow-arm64-rel',
      'android-marshmallow-x86-rel-non-cq',
    ],
    'modifications': {
      'Marshmallow 64 bit Tester': {
        'swarming': {
          'shards': 14,
        },
      },
      'Marshmallow Tablet Tester': {
        'args': [
          '--timeout-scale',
          '2.0',
        ],
      },
      'Oreo Phone Tester': {
        # TODO(https://crbug.com/884413): Re-enable this once the tests are
        # either passing or there is more capacity.
        'experiment_percentage': 0,
      },
      'android-11-x86-fyi-rel': {
        'args': [
          '--test-launcher-filter-file=../../testing/buildbot/filters/android.emulator_11.chrome_public_test_apk.filter',
          '--timeout-scale=2.0',
        ],
        # TODO(crbug.com/1137474): Revisit the shard number once failed tests
        # are fixed.
        'swarming': {
          'shards': 30,
        },
      },
      'android-arm64-proguard-rel': {
        'swarming': {
          'shards': 25,
        },
      },
      'android-lollipop-arm-rel-swarming': {
        'swarming': {
          'service_account': 'chrome-gold-dev@chops-service-accounts.iam.gserviceaccount.com'
        },
      },
      'android-marshmallow-arm64-rel-swarming': {
        'swarming': {
          'service_account': 'chrome-gold-dev@chops-service-accounts.iam.gserviceaccount.com'
        },
      },
      'android-marshmallow-x86-rel': {
        'args': [
          '--test-launcher-filter-file=../../testing/buildbot/filters/android.emulator_m.chrome_public_test_apk.filter',
        ],
        'swarming': {
          # TODO(crbug.com/1127110): Revisit shards and machine_type if there
          # are n2 machines available in the test pool.
          'shards': 25,
          'dimension_sets': [
            {
              'machine_type': 'e2-standard-8', # use 8-core to shorten runtime
            },
          ],
        },
      },
      'android-pie-arm64-rel': {
        'args': [
          '--test-launcher-filter-file=../../testing/buildbot/filters/android.pie_arm64_rel.chrome_public_test_apk.filter', # https://crbug.com/1010211
        ],
      },
      'android-pie-x86-rel': {
        'args': [
          '--avd-config=../../tools/android/avd/proto/generic_playstore_android28.textpb',
          # https://crbug.com/1046059
          '--test-launcher-filter-file=../../testing/buildbot/filters/android.emulator_p.chrome_public_test_apk.filter',
        ],
        'swarming': {
          'named_caches': [
            {
              'name': 'avd_generic_playstore_android28',
              'path': '.android',
            },
            {
              'name': 'system_images_android_28_google_apis_playstore_x86',
              'path': '.emulator_sdk',
            },
          ],
          'dimension_sets': [
            {
              'machine_type': 'n1-standard-8', # use 8-core to shorten runtime
            },
          ],
        },
      },
    },
  },
  'chrome_public_test_vr_apk': {
    'remove_from': [
      # Decided to no longer run VR tests on L, crbug.com/1159619.
      'Lollipop Phone Tester',
      'Lollipop Tablet Tester',
      'Marshmallow Tablet Tester',
      'android-11-x86-fyi-rel',
      'android-lollipop-arm-rel',
      'android-marshmallow-x86-rel-non-cq',
      'android-pie-x86-rel',
      'android-pie-arm64-rel', # https://crbug.com/1010211
      'ToTAndroid',
      'android-asan',  # https://crbug.com/964562
      'android-code-coverage-native', # Does not generate profraw data.
      'android-pie-arm64-coverage-experimental-rel', # Does not generate profraw data.
    ],
    'modifications': {
      # Use "--remove-system-package" according to crbug.com/931947#c1
      'android-nougat-arm64-rel': {
        'args': [
          # Applying a mixin via an exception doesn't work, so manually apply
          # the same arguments as the 'vr_instrumentation_test' mixin.
          '--remove-system-package=com.google.vr.vrcore',
          '--additional-apk=//third_party/gvr-android-sdk/test-apks/vr_services/vr_services_current.apk',
        ],
      },
    },
  },
  'chrome_public_test_vr_apk-vega': {
    'modifications': {
      'Oreo Phone Tester': {
        'swarming': {
          'dimension_sets': [
            {
              'device_os': 'OVR1.180808.003',
              'device_type': 'vega',
              'os': 'Android',
            },
          ],
        },
      }
    }
  },
  'chrome_public_wpt': {
    'modifications': {
      'android-web-platform-pie-x86-fyi-rel': {
        'swarming': {
          'dimension_sets': [
            {
              'machine_type': 'n1-standard-8',
            },
          ],
          'shards': 18,
        },
      },
    },
  },
  'chrome_sizes': {
    'modifications': {
      'lacros-amd64-generic-chrome': {
        'swarming': {
          'dimension_sets': [
            {
              'cpu': 'x86-64',
              'os': 'Ubuntu-16.04',
            },
          ],
        },
      },
      'win-chrome': {
        'swarming': {
          # TODO(crbug.com/1124829): Remove this exception once pool
          # chrome.tests is migrated to 1909.
          'dimension_sets': [
            {
              'os': 'Windows-10-15063',
            },
          ],
        },
      },
      'win64-chrome': {
        'swarming': {
          # TODO(crbug.com/1124829): Remove this exception once pool
          # chrome.tests is migrated to 1909.
          'dimension_sets': [
            {
              'os': 'Windows-10-15063',
            },
          ],
        },
      },
    },
  },
  'chromedriver_py_tests': {
    'remove_from': [
      # Timeout happens sometimes (crbug.com/951799).
      'Win10 Tests x64 (dbg)',
    ],
  },
  'components_browsertests': {
    'modifications': {
      'android-11-x86-fyi-rel': {
        'swarming': {
          'shards': 2,
        },
      },
    },
  },
  'components_unittests': {
    'remove_from': [
      # https://crbug.com/1147531 - covered on lollipop
      'android-marshmallow-arm64-rel',
      'Fuchsia ARM64',  # https://crbug.com/961457
      'Fuchsia x64', # https://crbug.com/961457
      'fuchsia-code-coverage',  # https://crbug.com/961457
      'fuchsia-fyi-arm64-dbg',  # https://crbug.com/961457
      'fuchsia-fyi-arm64-rel',  # https://crbug.com/961457
      'fuchsia-fyi-x64-dbg',  # https://crbug.com/961457
      'fuchsia-fyi-x64-rel',  # https://crbug.com/961457
      'ToTFuchsia x64',  # https://crbug.com/961457
      'ToTFuchsiaOfficial',  # https://crbug.com/961457
    ],
    'modifications': {
      'Linux ASan LSan Tests (1)': {
        # These are very slow on the ASAN trybot for some reason.
        # crbug.com/794372
        'swarming': {
          'shards': 5,
        },
      },
      'Linux Chromium OS ASan LSan Tests (1)': {
        # These are very slow on the ASAN trybot for some reason.
        # crbug.com/794372
        'swarming': {
          'shards': 5,
        },
      },
      # TODO(crbug.com/1200904): Remove after migration
      'Linux TSan (bionic)': {
        'swarming': {
          'shards': 2,
        },
      },
      'Linux TSan Tests': {
        'swarming': {
          'shards': 2,
        },
      },
      'Mac11 Tests': {
        # TODO(crbug.com/1206401): Restore to defaults when there is enough
        # capacity.
        'swarming': {
          'dimension_sets': [
            {
              'machine_type': 'n1-standard-4',
            }
          ],
        },
      },
      # https://crbug.com/1203439 components_unittests on Win10 got much slower.
      'Win10 Tests x64': {
        'args': [
          '--test-launcher-print-timestamps',
        ],
      },
      'android-11-x86-fyi-rel': {
        'args': [
          '--test-launcher-filter-file=../../testing/buildbot/filters/android.emulator_11.components_unittests.filter',
        ],
      },
      'linux-blink-heap-concurrent-marking-tsan-rel': {
        'swarming': {
          'shards': 2,
        },
      },
      # https://crbug.com/1111979,
      'linux-lacros-code-coverage': {
        'args': [
          '--test-launcher-filter-file=../../testing/buildbot/filters/linux-lacros.components_unittests.filter',
        ],
      },
      # https://crbug.com/1111979,
      'linux-lacros-rel': {
        'args': [
          '--test-launcher-filter-file=../../testing/buildbot/filters/linux-lacros.components_unittests.filter',
        ],
      },
      # https://crbug.com/1111979,
      'linux-lacros-tester-rel': {
        'args': [
          '--test-launcher-filter-file=../../testing/buildbot/filters/linux-lacros.components_unittests.filter',
        ],
      },
    },
  },
  'content_browsertests': {
    'remove_from': [
      'CrWinAsan(dll)', # https://crbug.com/935598
      'android-lollipop-arm-rel', # crbug.com/1133002
      # http://crbug.com/1060245#c30: due to low utility and capacity.
      'android-marshmallow-arm64-rel',
    ],
    'modifications': {
      'Cast Audio Linux': {
        'args': [
          '--test-launcher-filter-file=../../testing/buildbot/filters/cast-linux.content_browsertests.filter',
        ],
      },
      'Cast Linux': {
        'args': [
          '--test-launcher-filter-file=../../testing/buildbot/filters/cast-linux.content_browsertests.filter',
        ],
      },
      'Linux ASan LSan Tests (1)': {
        'swarming': {
          'shards': 12,
        },
      },
      'Linux ASan Tests (sandboxed)': {
        'swarming': {
          'shards': 10, # https://crbug.com/1103330
        },
      },
      # TODO(crbug.com/1200904): Remove after migration
      'Linux TSan (bionic)': {
        'swarming': {
          'shards': 15,
        },
      },
      'Linux TSan Tests': {
        'swarming': {
          'shards': 15,
        },
      },
      'Lollipop Phone Tester': {
        'swarming': {
          'shards': 10,
        },
      },
      'Lollipop Tablet Tester': {
        'args': [
          '--test-launcher-filter-file=../../testing/buildbot/filters/android.lollipop_tablet_tester.content_browsertests.filter',
        ],
      },
      'Mac11 Tests': {
        # TODO(crbug.com/1206401): Restore to defaults when there is enough
        # capacity.
        'swarming': {
          'dimension_sets': [
            {
              'machine_type': 'n1-standard-4',
            }
          ],
          'hard_timeout': 4500,
          'shards': 2,
        },
      },
      'Marshmallow Tablet Tester': {
        'args': [
          '--test-launcher-filter-file=../../testing/buildbot/filters/android.marshmallow_tablet_tester.content_browsertests.filter',
        ],
      },
      'WebRTC Chromium FYI Android Tests (dbg) (L Nexus5)': {
        'args': [
          '--test-launcher-filter-file=../../testing/buildbot/filters/chromium.webrtc.fyi.android.tests.dbg.content_browsertests.filter',
        ],
      },
      'WebRTC Chromium FYI Android Tests (dbg) (M Nexus5X)': {
        'args': [
          '--test-launcher-filter-file=../../testing/buildbot/filters/chromium.webrtc.fyi.android.tests.dbg.content_browsertests.filter',
        ],
      }
      ,
      'Win10 Tests x64': {
        # crbug.com/868082
        'args': [
          '--disable-features=WebRTC-H264WithOpenH264FFmpeg',
        ],
      },
      'Win10 Tests x64 (dbg)': {
        'experiment_percentage': 100,
        # crbug.com/868082
        'args': [
          '--disable-features=WebRTC-H264WithOpenH264FFmpeg',
        ],
      },
      'android-11-x86-fyi-rel': {
        # TODO(crbug.com/1137474): Revisit the shard number once failed tests
        # are fixed.
        'swarming': {
          'shards': 30,
        },
      },
      'android-arm64-proguard-rel': {
        'swarming': {
          'shards': 16,
        },
      },
      'android-asan': {
        'args': [
          '--test-launcher-filter-file=../../testing/buildbot/filters/android.asan.content_browsertests.filter',
        ],
        'swarming': {
          'shards': 18,
        },
      },
      'android-marshmallow-arm64-rel': {
        'swarming': {
          'shards': 16,
        },
      },
      'android-marshmallow-x86-rel-non-cq': {
        'args': [
          '--test-launcher-filter-file=../../testing/buildbot/filters/android.emulator_m.content_browsertests.filter',
        ],
        'swarming': {
          'shards': 20,
        },
      },
      'android-nougat-arm64-rel': {
        'swarming': {
          'shards': 16,
        },
        # TODO(crbug.com/1108055): Remove this filter
        'args': [
          '--gtest_filter=-BackgroundTracingManagerBrowserTest.PerfettoSystemBackgroundScenario*',
        ],
      },
      'android-pie-x86-rel': {
        'args': [
          '--test-launcher-filter-file=../../testing/buildbot/filters/android.emulator_p.content_browsertests.filter',
        ],
        'swarming': {
          'shards': 20,
        },
      },
      'linux-blink-heap-concurrent-marking-tsan-rel': {
        'swarming': {
          'shards': 4,
        },
      },
      'linux-chromeos-code-coverage': {
        'swarming': {
          'shards': 12,
        },
      },
      'linux-chromeos-rel': {
        'swarming': {
          'shards': 3,
        },
      },
      'linux-code-coverage': {
        'args': [
          '--no-sandbox',
        ],
        'swarming': {
          'shards': 12,
        },
      },
      # https://crbug.com/1111979,
      'linux-lacros-code-coverage': {
        'args': [
          '--test-launcher-filter-file=../../testing/buildbot/filters/linux-lacros.content_browsertests.filter',
        ],
      },
      # https://crbug.com/1111979
      'linux-lacros-tester-fyi-rel': {
        'experiment_percentage': 100,
      },
      # https://crbug.com/1111979,
      'linux-lacros-tester-rel': {
        'args': [
          '--test-launcher-filter-file=../../testing/buildbot/filters/linux-lacros.content_browsertests.filter',
        ],
      },
    },
  },
  'content_browsertests_wayland': {
    'modifications': {
      'Linux Ozone Tester (Wayland)': {
        'args': [
          '--test-launcher-filter-file=../../testing/buildbot/filters/ozone-linux.wayland_content_browsertests.filter',
        ],
      },
    },
  },
  'content_shell_crash_test': {
    'remove_from': [
      'Mac10.11 Tests',  # crbug.com/1138050
      'android-marshmallow-x86-rel-non-cq', # crbug.com/1084353
    ],
    'modifications': {
      'Win10 Tests x64 (dbg)': {
        'experiment_percentage': 100,  # https://crbug.com/861730
      },
    },
  },
  'content_shell_test_apk': {
    'remove_from': [
      'android-asan',  # https://crbug.com/964562
      'android-code-coverage-native', # Does not generate profraw data.
      'android-pie-arm64-coverage-experimental-rel', # Does not generate profraw data.
    ],
    'modifications': {
      'android-11-x86-fyi-rel': {
        'args': [
          '--test-launcher-filter-file=../../testing/buildbot/filters/android.emulator_11.content_shell_test_apk.filter',
        ],
      },
      'android-marshmallow-x86-rel-non-cq': {
        'args': [
          '--test-launcher-filter-file=../../testing/buildbot/filters/android.emulator_m.content_shell_test_apk.filter',
        ],
      },
      'android-pie-x86-rel': {
        'args': [
          '--gtest_filter=-ContentViewScrollingTest.testFling',
        ],
      },
    },
  },
  'content_unittests': {
    'modifications': {
      'Linux ASan LSan Tests (1)': {
        # These are slow on the ASAN trybot for some reason.
        # crbug.com/794372
        'swarming': {
          'shards': 2,
        },
      },
      'Linux ChromiumOS MSan Tests': {
        # These are very slow on the Chrome OS MSAN trybot for some reason.
        # crbug.com/865455
        'swarming': {
          'shards': 2,
        },
      },
      'Mac11 Tests': {
        # TODO(crbug.com/1206401): Restore to defaults when there is enough
        # capacity.
        'swarming': {
          'dimension_sets': [
            {
              'machine_type': 'n1-standard-4',
            },
          ],
        },
      },
      'fuchsia-code-coverage': {
        'swarming': {
          'shards': 12,
        },
      },
    },
  },
  'context_lost_passthrough_tests': {
    'modifications': {
      'Mac FYI GPU ASAN Release': {
        'args': [
          '--is-asan',
        ]
      },
    },
  },
  'context_lost_validating_tests': {
    # TODO(https://crbug.com/850107): Remove the Android FYI Release (Pixel 2)
    # exception once there is enough capacity to run these tests.
    'remove_from': [
      'Android FYI Release (Pixel 2)',
    ],
    'modifications': {
      'Mac FYI GPU ASAN Release': {
        'args': [
          '--is-asan',
        ]
      },
    },
  },
  'crashpad_tests': {
    'remove_from': [
      'linux-win_cross-rel', # https://crbug.com/762167
      # TODO(crbug.com/1200904): Remove after migration
      'Linux TSan (bionic)',
      # https://crbug.com/crashpad/304
      'Linux TSan Tests',
      'ToTLinuxTSan',
      # https://crbug.com/crashpad/306
      'Linux CFI',
      'CFI Linux ToT',
    ],
    'modifications': {
      'android-11-x86-fyi-rel': {
        'args': [
          '--test-launcher-filter-file=../../testing/buildbot/filters/android.emulator_11.crashpad_tests.filter',
        ],
      },
    },
  },
  'cronet_sizes': {
    'modifications': {
      'android-cronet-arm-dbg': {
        'swarming': {
          'dimension_sets': [
            {
              'device_os': None,
              'device_type': None,
              'os': 'Ubuntu-16.04',
            },
          ],
        },
      },
    },
  },
  'depth_capture_tests': {
    'remove_from': [
      # TODO(https://crbug.com/850107): Remove the Android FYI Release (Pixel 2)
      # exception once there is enough capacity to run these tests.
      'Android FYI Release (Pixel 2)',
      # TODO(https://crbug.com/1203234): Remove exception once the 1% flake-
      # rate regression is addressed.
      'Fuchsia x64' # https://crbug.com/1203236
    ],
  },
  'disk_usage_tast_test': {
    # TODO(crbug.com/1077659): Add the test back after it's fixed.
    'remove_from': [
      'chromeos-kevin-rel',
    ],
  },
  'extensions_browsertests': {
    'remove_from': [
      'CrWinAsan(dll)', # https://crbug.com/935598
    ],
    'modifications': {
      'Win10 Tests x64 (dbg)': {
        'experiment_percentage': 100, # https://crbug.com/876615
      },
      # https://crbug.com/1111979,
      'linux-lacros-code-coverage': {
        'args': [
          '--gtest_filter=-BluetoothShellApiTest.ApiSanityCheck:BluetoothSocketApiTest.Listen:BluetoothSocketApiTest.PermissionDenied',
        ],
      },
      'linux-lacros-rel': {
        'args': [
          '--gtest_filter=-BluetoothShellApiTest.ApiSanityCheck:BluetoothSocketApiTest.Listen:BluetoothSocketApiTest.PermissionDenied',
        ],
      },
      'linux-lacros-tester-rel': {
        'args': [
          '--gtest_filter=-BluetoothShellApiTest.ApiSanityCheck:BluetoothSocketApiTest.Listen:BluetoothSocketApiTest.PermissionDenied',
        ],
      },
    },
  },
  'extensions_unittests': {
    'modifications': {
      # https://crbug.com/1111979,
      'linux-lacros-code-coverage': {
        'args': [
          '--gtest_filter=-NativeExtensionBindingsSystemUnittest*:'
          'BluetoothSocketApiUnittest.CreateThenClose:'
          'FeatureProviderTest.PermissionFeatureAvailability',
        ],
      },
      'linux-lacros-tester-rel': {
        'args': [
          '--gtest_filter=-NativeExtensionBindingsSystemUnittest*:'
          'BluetoothSocketApiUnittest.CreateThenClose:'
          'FeatureProviderTest.PermissionFeatureAvailability',
        ],
      },
    },
  },
  'gfx_unittests': {
    'modifications': {
      'fuchsia-code-coverage': {
        'swarming': {
          'shards': 2,
        },
      },
    },
  },
  'gin_unittests': {
    'remove_from': [
      'ToTLinuxASan',  # https://crbug.com/831667
      'Linux ASan LSan Tests (1)',  # https://crbug.com/831667
      'Linux Chromium OS ASan LSan Tests (1)',  # https://crbug.com/831667
    ],
  },
  'gl_tests_passthrough': {
    'remove_from': [
      'CFI Linux ToT',
      # Can't run on MSAN because gl_tests uses the hardware driver,
      # which isn't instrumented.
      'Linux MSan Tests',
    ],
    'modifications': {
      # TODO(kbr): figure out a better way to specify blocks of
      # arguments like this for tests on multiple machines.
      'Linux ASan LSan Tests (1)': {
        'args': [
          '--use-gpu-in-tests',
          '--no-xvfb',
        ],
        'swarming': {
          'dimension_sets': [
            {
              'gpu': '10de:1cb3',
              'os': 'Ubuntu',
              'pool': 'chromium.tests.gpu',
            },
          ],
        },
      },
      'Linux CFI': {
        'args': [
          '--use-gpu-in-tests',
          '--no-xvfb',
        ],
        'swarming': {
          'dimension_sets': [
            {
              'gpu': '10de:1cb3',
              'os': 'Ubuntu',
              'pool': 'chromium.tests.gpu',
            },
          ],
        },
      },
      # TODO(crbug.com/1200904): Remove after migration
      'Linux TSan (bionic)': {
        'args': [
          '--use-gpu-in-tests',
          '--no-xvfb',
        ],
        'swarming': {
          'dimension_sets': [
            {
              'gpu': '10de:1cb3',
              'os': 'Ubuntu',
              'pool': 'chromium.tests.gpu',
            },
          ],
        },
      },
      'Linux TSan Tests': {
        'args': [
          '--use-gpu-in-tests',
          '--no-xvfb',
        ],
        'swarming': {
          'dimension_sets': [
            {
              'gpu': '10de:1cb3',
              'os': 'Ubuntu',
              'pool': 'chromium.tests.gpu',
            },
          ],
        },
      },
    },
  },
  'gl_tests_validating': {
   'remove_from': [
      'Android FYI Release (Nexus 5X)',
    ],
    'modifications': {
      'android-11-x86-fyi-rel': {
        'args': [
          '--test-launcher-filter-file=../../testing/buildbot/filters/android.emulator_11.gl_tests.filter',
        ],
      },
      'android-marshmallow-x86-rel-non-cq': {
        'args': [
          '--test-launcher-filter-file=../../testing/buildbot/filters/android.emulator.gl_tests.filter',
        ],
      },
      'android-pie-arm64-rel': {
        'args': [
          '--test-launcher-filter-file=../../testing/buildbot/filters/android.pie_arm64_rel.gl_tests.filter', # https://crbug.com/1034007
        ],
      },
      'android-pie-x86-rel': {
        'args': [
          '--test-launcher-filter-file=../../testing/buildbot/filters/android.emulator.gl_tests.filter',
        ],
      },
    },
  },
  'gl_unittests': {
    'remove_from': [
      # On Android, these are already run on the main waterfall.
      # Run them on the one-off Android FYI bots, though.
      'Android FYI Release (Nexus 5X)',
      # Can't run on MSAN because gl_unittests uses the hardware driver,
      # which isn't instrumented.
      'Linux MSan Tests',
    ],
  },
  'gl_unittests_ozone': {
    'remove_from': [
      # Can't run on MSAN because gl_unittests_ozone uses the hardware driver,
      # which isn't instrumented.
      'Linux ChromiumOS MSan Tests',
    ],
  },
  'gpu_process_launch_tests': {
    # TODO(https://crbug.com/850107): Remove the Android FYI Release (Pixel 2)
    # exception once there is enough capacity to run these tests.
    'remove_from': [
      'Android FYI Release (Pixel 2)',
    ],
  },
  'gpu_unittests': {
    'modifications': {
      'fuchsia-code-coverage': {
        'swarming': {
          'shards': 5,
        },
      },
    },
  },
  'hardware_accelerated_feature_tests': {
    # TODO(https://crbug.com/850107): Remove the Android FYI Release (Pixel 2)
    # exception once there is enough capacity to run these tests.
    'remove_from': [
      'Android FYI Release (Pixel 2)',
    ],
  },
  'headless_browsertests': {
    'modifications': {
      'fuchsia-code-coverage': {
        'swarming': {
          'shards': 6,
        },
      },
    },
    'remove_from': [
      'CrWinAsan(dll)', # https://crbug.com/935598
      'Mac10.13 Tests', # https://crbug.com/1204424
    ],
  },
  'info_collection_tests': {
    'remove_from': [
      # The Mac ASAN swarming bot runs tests on two different GPU
      # types, so we can't have one expected vendor ID / device ID.
      'Mac FYI GPU ASAN Release',
      'Android V8 FYI Release (Nexus 5X)',
      'Linux V8 FYI Release (NVIDIA)',
      'Linux V8 FYI Release - pointer compression (NVIDIA)',
      'Mac V8 FYI Release (Intel)',
      'Win V8 FYI Release (NVIDIA)',
      # TODO(https://crbug.com/1203234): Remove exception once the 1% flake-
      # rate regression is addressed.
      'Fuchsia x64' # https://crbug.com/1203236
    ],
    'modifications': {
      'ChromeOS FYI Release (amd64-generic)': {
        'args': [
          # Swarming does not report a GPU since tests are run in a VM, but
          # the VM does report that a GPU is present.
          '--expected-device-id', '1050',
        ],
      },
    },
    'replacements': {
      'ChromeOS FYI Release (amd64-generic)': {
        'args': {
          # Swarming does not report a GPU since tests are run in a VM, but
          # the VM does report that a GPU is present.
          '--expected-vendor-id': '1af4',
          # Magic substitution happens after regular replacement, so remove it
          # now since we are manually applying the expected device ID above.
          '$$MAGIC_SUBSTITUTION_GPUExpectedDeviceId': None,
        },
      },
      'Mac FYI arm64 Release (Apple DTK)': {
        'args': {
          # The GPU information is not yet exposed in swarming, so we can't
          # explicitly request it and have the JSON generation handle this
          # automatically.
          '--expected-vendor-id': '106b',
        },
      },
    },
  },
  'interactive_ui_tests': {
    'remove_from': [
      'CrWinAsan(dll)', # https://crbug.com/935598
    ],
    'modifications': {
      'Linux - Future (dbg)': {  # client.v8.chromium
        'swarming': {
          'shards': 3,
        },
      },
      'Linux ASan LSan Tests (1)': {
        # These are slow on the ASan trybot for some reason, crbug.com/794372
        'swarming': {
          'shards': 6,
        },
      },
      'Linux ChromiumOS MSan Tests': {
        # These are very slow on the Chrome OS MSAN trybot for some reason.
        # crbug.com/865455
        'swarming': {
          'shards': 5,
        },
      },
      # TODO(crbug.com/1200904): Remove after migration
      'Linux TSan (bionic)': {
        # These are slow on the TSan bots for some reason, crbug.com/794372
        'swarming': {
          'shards': 32, # Adjusted for testing, see https://crbug.com/1179567
        },
      },
      'Linux TSan Tests': {
        # These are slow on the TSan bots for some reason, crbug.com/794372
        'swarming': {
          'shards': 32, # Adjusted for testing, see https://crbug.com/1179567
        },
      },
      'Mac11 Tests': {
        # TODO(crbug.com/1206401): Restore to defaults when there is enough
        # capacity.
        'swarming': {
          'dimension_sets': [
            {
              'machine_type': 'n1-standard-4',
            },
          ],
          'shards': 1,
        },
      },
      'ToTLinuxTSan': {
        # These are slow on the TSan bots for some reason, crbug.com/794372
        'swarming': {
          'shards': 6,
        },
      },
      # temporary, https://crbug.com/818832
      'Win10 Tests x64 (dbg)': {
        'experiment_percentage': 100,
      },
      'Win7 Tests (dbg)(1)': {
        'swarming': {
          'shards': 4,
        },
      },
      # TODO(crbug.com/970649): Remove these filters.
      'linux-chromeos-chrome': {
        'args': [
          '--gtest_filter=-SadTabViewInteractiveUITest.ReloadMultipleSadTabs',
        ],
      },
      'linux-chromeos-code-coverage': {
        'swarming': {
          'shards': 10,
        },
      },
      'linux-chromeos-ltc': {
        'args': [
          '--gtest_filter=-SadTabViewInteractiveUITest.ReloadMultipleSadTabs',
        ],
      },
      'linux-chromeos-lts': {
        'args': [
          '--gtest_filter=-SadTabViewInteractiveUITest.ReloadMultipleSadTabs',
        ],
      },
      'linux-code-coverage': {
        'swarming': {
          'shards': 10,
        },
      },
      # https://crbug.com/1111979
      'linux-lacros-code-coverage': {
        'args': [
          '--test-launcher-filter-file=../../testing/buildbot/filters/linux-lacros.interactive_ui_tests.filter',
        ],
      },
      # https://crbug.com/1111979
      'linux-lacros-rel': {
        'args': [
          '--test-launcher-filter-file=../../testing/buildbot/filters/linux-lacros.interactive_ui_tests.filter',
        ],
      },
      # https://crbug.com/1111979
      'linux-lacros-tester-rel': {
        'args': [
          '--test-launcher-filter-file=../../testing/buildbot/filters/linux-lacros.interactive_ui_tests.filter',
        ],
      },
    },
  },
  'interactive_ui_tests_amd64-generic': {
    'remove_from': [
      # TODO(crbug.com/1204231): Re-enable.
      'lacros-amd64-generic-rel',
    ]
  },
  'interactive_ui_tests_wayland': {
    'modifications': {
      # CQ tester.
      'Linux Ozone Tester (Wayland)': {
        'args': [
          '--test-launcher-filter-file=../../testing/buildbot/filters/ozone-linux.interactive_ui_tests_wayland.filter',
        ],
      },
      # CI Ozone/Wayland tester.
      'Linux Tester (Ozone Wayland)': {
        'args': [
          '--test-launcher-filter-file=../../testing/buildbot/filters/ozone-linux.interactive_ui_tests_wayland.filter',
        ],
      },
    },
  },
  'ipc_tests': {
    'modifications': {
      'android-asan': {
        'swarming': {
          'shards': 2,
        },
      },
    },
  },
  'maps_pixel_passthrough_test': {
    'replacements': {
      # The V8 builders pass the V8 revision for ${got_revision}, so instead
      # use ${got_cr_revision}, which is only set on the V8 bots.
      'Linux V8 FYI Release (NVIDIA)': {
        'args': {
          '--git-revision': '${got_cr_revision}',
        },
      },
      'Linux V8 FYI Release - pointer compression (NVIDIA)': {
        'args': {
          '--git-revision': '${got_cr_revision}',
        },
      },
      'Mac V8 FYI Release (Intel)': {
        'args': {
          '--git-revision': '${got_cr_revision}',
        },
      },
      'Win V8 FYI Release (NVIDIA)': {
        'args': {
          '--git-revision': '${got_cr_revision}',
        },
      },
    },
  },
  'maps_pixel_validating_test': {
    'modifications': {
      'Android FYI Release (Pixel 4)': {
        'args': [
          # Pixel 4s are weird in that they can output in different color spaces
          # simultaneously. The readback code for capturing a screenshot assumes
          # only one color space, so disable wide color gamut for the test to
          # work around the issue. See https://crbug.com/1166379 for more
          # information.
          '--extra-browser-args=--disable-wcg-for-test',
        ],
      },
    },
    # TODO(https://crbug.com/850107): Remove the Android FYI Release (Pixel 2)
    # exception once there is enough capacity to run these tests.
    'remove_from': [
      'Android FYI Release (Pixel 2)',
    ],
    'replacements': {
      # The V8 builders pass the V8 revision for ${got_revision}, so instead
      # use ${got_cr_revision}, which is only set on the V8 bots.
      'Android V8 FYI Release (Nexus 5X)': {
        'args': {
          '--git-revision': '${got_cr_revision}',
        },
      },
      'Mac V8 FYI Release (Intel)': {
        'args': {
          '--git-revision': '${got_cr_revision}',
        },
      },
    },
  },
  'media_blink_unittests': {
    'modifications': {
      'fuchsia-code-coverage': {
        'swarming': {
          'shards': 2,
        },
      },
    },
  },
  'media_unittests': {
    'modifications': {
      'android-11-x86-fyi-rel': {
        'args': [
          '--test-launcher-filter-file=../../testing/buildbot/filters/android.emulator_11.media_unittests.filter',
        ],
      },
      'android-marshmallow-x86-rel-non-cq': {
        'args': [
          '--test-launcher-filter-file=../../testing/buildbot/filters/android.emulator_m.media_unittests.filter',
        ],
      },
      'android-pie-arm64-rel': {
        'args': [
          '--gtest_filter=-AAudio/AudioOutputTest.Play200HzTone/0', # https://crbug.com/1034009
        ],
      },
      'android-pie-x86-rel': {
        'args': [
          '--test-launcher-filter-file=../../testing/buildbot/filters/android.emulator_p.media_unittests.filter',
        ],
      },
      'fuchsia-code-coverage': {
        'swarming': {
          'shards': 3,
        },
      },
    },
  },
  'mediapipe_validating_tests': {
    'remove_from': [
      # TODO(crbug.com/1201887): Remove once tests are stable.
      'Fuchsia x64',
    ],
  },
  'mojo_test_apk': {
    'remove_from': [
      'android-code-coverage-native', # Does not generate profraw data.
      'android-pie-arm64-coverage-experimental-rel', # Does not generate profraw data.
    ],
  },
  'mojo_unittests': {
    'modifications': {
      'android-asan': {
        'swarming': {
          'shards': 5,
        },
      },
      'fuchsia-code-coverage': {
        'swarming': {
          'shards': 2,
        },
      },
    },
  },
  'monochrome_public_apk_checker': {
    'modifications': {
      'ToTAndroid': {
        'swarming': {
          'dimension_sets': [
            {
              'cpu': 'x86-64',
              'device_os': None,
              'device_playstore_version': None,
              'device_type': None,
              'os': 'Ubuntu-16.04',
            },
          ],
        },
      },
      'android-arm64-proguard-rel': {
        'swarming': {
          'dimension_sets': [
            {
              'cpu': 'x86-64',
              'device_os': None,
              'device_playstore_version': None,
              'device_type': None,
              'os': 'Ubuntu-16.04',
            },
          ],
        },
      },
      'android-pie-arm64-rel': {
        'swarming': {
          'dimension_sets': [
            {
              'cpu': 'x86-64',
              'device_os': None,
              'device_os_flavor': None,
              'device_playstore_version': None,
              'device_type': None,
              'os': 'Ubuntu-16.04',
            },
          ],
        },
      },
    },
  },
  'monochrome_public_bundle_fake_modules_smoke_test' : {
    'remove_from': [
      'android-pie-arm64-coverage-experimental-rel', # TODO(crbug.com/1190999):
                                                     # GLIBC_2.28 Not found.
    ],
  },
  'monochrome_public_bundle_smoke_test' : {
    'remove_from': [
      'android-pie-arm64-coverage-experimental-rel', # TODO(crbug.com/1190999):
                                                     # GLIBC_2.28 Not found.
    ],
  },
  'monochrome_public_smoke_test' : {
    'remove_from': [
      'android-pie-arm64-coverage-experimental-rel', # TODO(crbug.com/1190999):
                                                     # GLIBC_2.28 Not found.
    ],
  },
  'monochrome_public_test_ar_apk': {
    'modifications': {
      'Nougat Phone Tester': {
        'args': [
          # ArCore is not installed as a system app on N, so we can install it
          # normally instead of replacing the system version.
          '--additional-apk=//third_party/arcore-android-sdk/test-apks/arcore/arcore_current.apk'
        ],
      },
      # We need to match the Playstore version as well because AR tests fail on
      # old versions of the Playstore.
      'Oreo Phone Tester': {
        'args': [
          # ArCore is not installed as a system app on O, so we can install it
          # normally instead of replacing the system version.
          '--additional-apk=//third_party/arcore-android-sdk/test-apks/arcore/arcore_current.apk'
        ],
        'swarming': {
          'dimension_sets': [
            {
              'device_os': 'OPR3.170623.008',
              'device_type': 'marlin',
              'os': 'Android',
            },
          ],
        },
      },
      'android-10-arm64-rel': {
        'args': [
          '--remove-system-package=com.google.ar.core',
          '--additional-apk=//third_party/arcore-android-sdk/test-apks/arcore/arcore_current.apk',
        ]
      },
      'android-nougat-arm64-rel': {
        'args': [
          # ArCore is not installed as a system app on N, so we can install it
          # normally instead of replacing the system version.
          '--additional-apk=//third_party/arcore-android-sdk/test-apks/arcore/arcore_current.apk'
        ],
      },
      'android-pie-arm64-dbg': {
        'args': [
          '--remove-system-package=com.google.ar.core',
          '--additional-apk=//third_party/arcore-android-sdk/test-apks/arcore/arcore_current.apk',
        ]
      }
    },
  },
  'nacl_helper_nonsfi_unittests': {
    'remove_from': [
      # TODO(crbug.com/1200904): Remove after migration
      'Linux TSan (bionic)',  # Sets enable_nacl=false.
      'Linux TSan Tests',  # Sets enable_nacl=false.
    ],
  },
  'nacl_loader_unittests': {
    'remove_from': [
      'ToTMacASan',  # The mac asan tot bot sets enable_nacl=false
      'linux-win_cross-rel',  # Sets enable_nacl=false, https://crbug.com/774186
      # TODO(crbug.com/1200904): Remove after migration
      'Linux TSan (bionic)',  # The TSan bot sets enable_nacl=false
      'Linux TSan Tests',  # The TSan bot sets enable_nacl=false
      'Mac ASan 64 Tests (1)',  # The mac asan bot sets enable_nacl=false
    ],
  },
  'net_unittests': {
    'modifications': {
      'CrWinAsan': {
        # TODO(crbug.com/794372): net_unittests is slow under ASan.
        'swarming': {
          'shards': 16,
        },
      },
      'CrWinAsan(dll)': {
        # TODO(crbug.com/794372): net_unittests is slow under ASan.
        'swarming': {
          'shards': 16,
        },
      },
      'Linux ASan LSan Tests (1)': {
        # These are very slow on the ASAN trybot for some reason.
        # crbug.com/794372
        'swarming': {
          'shards': 16,
        },
      },
      'Linux Chromium OS ASan LSan Tests (1)': {
        # These are very slow on the ASAN trybot for some reason.
        # crbug.com/794372
        'swarming': {
          'shards': 8,
        }
      },
      'Linux ChromiumOS MSan Tests': {
        # These are very slow on the Chrome OS MSAN trybot for some reason.
        # crbug.com/865455
        'swarming': {
          'shards': 2,
        },
      },
      # TODO(crbug.com/1200904): Remove after migration
      'Linux TSan (bionic)': {
        'swarming': {
          'shards': 4,
        }
      },
      'Linux TSan Tests': {
        'swarming': {
          'shards': 4,
        }
      },
      # The suite runs signficantly slower on linux dbg, so increase shards.
      'Linux Tests (dbg)(1)': {
        'swarming': {
          'shards': 2,
        },
      },
      'ToTLinuxASan': {
        # TODO(crbug.com/794372): net_unittests is slow under ASan.
        'swarming': {
          'shards': 16,
        },
      },
      'ToTLinuxTSan': {
        'swarming': {
          'shards': 4,
        }
      },
      'android-11-x86-fyi-rel': {
        'args': [
          '--test-launcher-filter-file=../../testing/buildbot/filters/android.emulator_11.net_unittests.filter',
        ],
      },
      'android-marshmallow-x86-rel-non-cq': {
        # crbug.com/1046060
        'args': [
          '--test-launcher-filter-file=../../testing/buildbot/filters/android.emulator.net_unittests.filter',
        ],
      },
      'android-pie-x86-rel': {
        # crbug.com/1046060
        'args': [
          '--test-launcher-filter-file=../../testing/buildbot/filters/android.emulator.net_unittests.filter',
        ],
      },
      'fuchsia-code-coverage': {
        'swarming': {
          'shards': 14,
        },
      },
      'linux-blink-heap-concurrent-marking-tsan-rel': {
        'swarming': {
          'shards': 4,
        }
      },
      'linux-chromeos-dbg': {
        'swarming': {
          'shards': 2,
        },
      },
      'win-asan': {
        # TODO(crbug.com/794372): net_unittests is slow under ASan.
        'swarming': {
          'shards': 16,
        },
      },
    },
  },
  'not_site_per_process_blink_web_tests': {
    'remove_from': [
      # TODO(dpranke): Should we be running this step on Linux Tests (dbg)(1)?
      'Linux Tests (dbg)(1)',
    ],
    'modifications': {
      'Linux Tests': {
        "args": [
          "--additional-env-var=LLVM_PROFILE_FILE=${ISOLATED_OUTDIR}/profraw/default-%2m.profraw",
        ],
      },
      'linux-code-coverage': {
        'args': [
          '--additional-env-var=LLVM_PROFILE_FILE=${ISOLATED_OUTDIR}/profraw/default-%2m.profraw',
        ],
        'swarming': {
          'shards': 20,
        },
      },
      'linux-xenial-rel': {
        "args": [
          "--additional-env-var=LLVM_PROFILE_FILE=${ISOLATED_OUTDIR}/profraw/default-%2m.profraw",
        ],
      },
    },
  },
  'notification_helper_unittests': {
    'remove_from': [
      # The test uses WinRT, which only exists in Windows 8 or above.
      # (https://crbug.com/813553)
      'Win 7 Tests x64 (1)',
      'Win7 Tests (1)',
      'Win7 Tests (dbg)(1)',
      # all these bots run Windows 7.
      'ToTWin',
      'ToTWin(dbg)',
      'ToTWin(dll)',
      'ToTWinOfficial',
      'ToTWin64',
      'ToTWin64(dbg)',
      'ToTWin64(dll)',
      'ToTWinCFI',
      'ToTWinCFI64',
      'ToTWinThinLTO64',
    ],
  },
  'ozone_unittests': {
    'modifications': {
      'chromeos-betty-pi-arc-chrome': {
        'args': [
          '--test-launcher-filter-file=../../testing/buildbot/filters/chromeos.ozone_unittests.filter',
        ],
      },
      'chromeos-betty-pi-arc-chrome-dchecks': {
        'args': [
          '--test-launcher-filter-file=../../testing/buildbot/filters/chromeos.ozone_unittests.filter',
        ],
      },
      'chromeos-betty-pi-arc-chrome-ltc': {
        'args': [
          '--test-launcher-filter-file=../../testing/buildbot/filters/chromeos.ozone_unittests.filter',
        ],
      },
      'chromeos-betty-pi-arc-chrome-lts': {
        'args': [
          '--test-launcher-filter-file=../../testing/buildbot/filters/chromeos.ozone_unittests.filter',
        ],
      },
      'linux-chromeos-chrome': {
        'args': [
          '--test-launcher-filter-file=../../testing/buildbot/filters/chromeos.ozone_unittests.filter',
        ],
      },
      'linux-chromeos-ltc': {
        'args': [
          '--test-launcher-filter-file=../../testing/buildbot/filters/chromeos.ozone_unittests.filter',
        ],
      },
      'linux-chromeos-lts': {
        'args': [
          '--test-launcher-filter-file=../../testing/buildbot/filters/chromeos.ozone_unittests.filter',
        ],
      },
    },
  },
  'perfetto_unittests': {
    'remove_from': [
      # TODO(crbug.com/931138): Fix permission issue when creating tmp files
      'android-arm64-proguard-rel',
      'android-asan',
      'android-code-coverage',
      'android-code-coverage-native',
      'android-lollipop-arm-rel',
      'android-marshmallow-arm64-rel',
      'android-marshmallow-x86-rel-non-cq',
      'android-nougat-arm64-rel',
      'android-pie-arm64-coverage-experimental-rel', # Does not generate profraw data.
      'android-pie-arm64-rel',
      'android-pie-x86-rel',
      'android-11-x86-fyi-rel',
      'Lollipop Phone Tester',
      'Lollipop Tablet Tester',
      'Marshmallow 64 bit Tester',
      'Marshmallow Tablet Tester',
      'Nougat Phone Tester',
      'ToTAndroid'
    ]
  },
  'performance_test_suite': {
    'modifications': {
      'Mac10.15 Tests (dbg)': {
        'args': [
          '--browser=debug',
        ],
      },
      'Win10 Tests x64 (dbg)': {
        'args': [
          '--browser=debug_x64',
        ],
        'experiment_percentage': 100,
      },
      'Win7 Tests (dbg)(1)': {
        'args': [
          '--browser=debug',
        ],
      },
    },
  },
  'pixel_browser_tests': {
    'modifications': {
      'win-pixel-tester-rel': {
        'non_precommit_args': [
          # Do not allow retry or it will break the bulk approval process.
          # When retry with fail-pass pattern, the passing test will overwrite the previously
          # seen flaky version on the trace. We can triage the image using the printed link,
          # but it will not show on the Skia Gold search page.
          '--test-launcher-retry-limit=0',
        ],
      },
    },
  },
  'pixel_skia_gold_passthrough_test': {
    'replacements': {
      # The V8 builders pass the V8 revision for ${got_revision}, so instead
      # use ${got_cr_revision}, which is only set on the V8 bots.
      'Linux V8 FYI Release (NVIDIA)': {
        'args': {
          '--git-revision': '${got_cr_revision}',
        },
      },
      'Linux V8 FYI Release - pointer compression (NVIDIA)': {
        'args': {
          '--git-revision': '${got_cr_revision}',
        },
      },
      'Mac V8 FYI Release (Intel)': {
        'args': {
          '--git-revision': '${got_cr_revision}',
        },
      },
      'Win V8 FYI Release (NVIDIA)': {
        'args': {
          '--git-revision': '${got_cr_revision}',
        },
      },
    },
  },
  'pixel_skia_gold_validating_test': {
    'modifications': {
      'Android FYI Release (Pixel 4)': {
        'args': [
          # Pixel 4s are weird in that they can output in different color spaces
          # simultaneously. The readback code for capturing a screenshot assumes
          # only one color space, so disable wide color gamut for the test to
          # work around the issue. See https://crbug.com/1166379 for more
          # information.
          '--extra-browser-args=--disable-wcg-for-test',
        ],
      },
    },
    'replacements': {
      # The V8 builders pass the V8 revision for ${got_revision}, so instead
      # use ${got_cr_revision}, which is only set on the V8 bots.
      'Android V8 FYI Release (Nexus 5X)': {
        'args': {
          '--git-revision': '${got_cr_revision}',
        },
      },
      'Mac V8 FYI Release (Intel)': {
        'args': {
          '--git-revision': '${got_cr_revision}',
        },
      },
    },
  },
  'pixel_test':{
    'modifications': {
      'Android Release (Nexus 5X)': {
        'swarming': {
          'shards': 2,
        },
      },
    },
  },
  'pixel_tests': {
    'remove_from': [
      'Fuchsia x64' # https://crbug.com/1203236
    ],
  },
  'rendering_representative_perf_tests': {
    'modifications': {
      'Win10 FYI x64 Exp Release (Intel HD 630)': {
        'args': [
          '--browser=release_x64',
        ],
      },
      'Win10 FYI x64 Exp Release (NVIDIA)': {
        'args': [
          '--browser=release_x64',
        ],
      },
      'Win10 FYI x64 Release (AMD RX 5500 XT)': {
        'args': [
          '--browser=release_x64',
        ],
      },
      'Win10 FYI x64 Release (Intel HD 630)': {
        'args': [
          '--browser=release_x64',
        ],
      },
      'Win10 FYI x64 Release (NVIDIA)': {
        'args': [
          '--browser=release_x64',
        ],
      },
      'Win10 x64 Release (NVIDIA)': {
        'args': [
          '--browser=release_x64',
        ],
      },
    },
  },
  'sandbox_linux_unittests': {
    'modifications': {
      'Lollipop Phone Tester': {
        'args': [
          '--shard-timeout=300',
        ],
      },
      'android-lollipop-arm-rel': {
        'args': [
          '--shard-timeout=300',
        ],
      },
      'android-marshmallow-x86-rel-non-cq': {
        'args': [
          '--test-launcher-filter-file=../../testing/buildbot/filters/android.emulator.sandbox_linux_unittests.filter',
        ]
      },
      'android-pie-x86-rel': {
        'args': [
          '--test-launcher-filter-file=../../testing/buildbot/filters/android.emulator.sandbox_linux_unittests.filter',
        ]
      },
    },
    'remove_from': [
      'android-asan',  # https://crbug.com/962650
    ],
  },
  'screenshot_sync_tests': {
    'remove_from': [
      'Fuchsia x64' # https://crbug.com/1203236
    ],
  },
  'screenshot_sync_validating_tests': {
    'modifications': {
      'Android FYI Release (Pixel 4)': {
        'args': [
          # Pixel 4s are weird in that they can output in different color spaces
          # simultaneously. The readback code for capturing a screenshot assumes
          # only one color space, so disable wide color gamut for the test to
          # work around the issue. See https://crbug.com/1166379 for more
          # information.
          '--extra-browser-args=--disable-wcg-for-test',
        ],
      },
    },
  },
  'services_unittests': {
    'remove_from': [
      'ToTLinuxMSan',  # https://crbug.com/831676
      # The face and barcode detection tests fail on the Mac Pros.
      'Mac Pro FYI Release (AMD)',
      'Linux ChromiumOS MSan Tests',  # https://crbug.com/831676
      'Linux MSan Tests',  # https://crbug.com/831676
    ],
    'replacements': {
      # TODO(crbug.com/1078982): Remove once the test is fixed on 10.15.4.
      'Mac FYI Experimental Release (Intel)': {
        'args': {
          '--gtest_filter': '*Detection*:-FaceDetectionImplMacTest.ScanOneFace*',
        },
      },
    },
    'modifications': {
      'android-nougat-arm64-rel': {
        # TODO(crbug.com/1108055): Remove this filter
        'args': [
          '--gtest_filter=-SystemPerfettoTest.*',
        ],
      },
      'fuchsia-code-coverage': {
        'swarming': {
          'shards': 7,
        },
      },
    }
  },
  'swiftshader_unittests': {
    'remove_from': [
      # Save capacity on the hardware where we have only a few machines.
      'Mac FYI Experimental Release (Intel)',
      'Mac FYI Experimental Retina Release (AMD)',
      'Mac FYI Experimental Retina Release (NVIDIA)',
      'Mac Pro FYI Release (AMD)',
    ],
  },
  'sync_integration_tests': {
    'remove_from': [
      'CrWinAsan(dll)', # https://crbug.com/935598
    ],
    'modifications': {
      'Linux ASan LSan Tests (1)': {
        'swarming': {
          'shards': 4,
        },
      },
      # TODO(crbug.com/1200904): Remove after migration
      'Linux TSan (bionic)': {
        'swarming': {
          'shards': 6,
        },
      },
      'Linux TSan Tests': {
        'swarming': {
          'shards': 6,
        },
      },
      # TODO(crbug.com/1131588) Tests are flaky only on CQ.
      'Mac10.13 Tests': {
        'precommit_args': [
            '--gtest_filter=-*',
          ],
      },
      # TODO(crbug.com/1131588) Tests are flaky only on CQ.
      'Mac10.15 Tests': {
        'precommit_args': [
            '--gtest_filter=-*',
          ],
      },
      'Mac11 Tests': {
        # TODO(crbug.com/1206401): Restore to defaults when there is enough
        # capacity.
        'swarming': {
          'dimension_sets': [
            {
              'machine_type': 'n1-standard-4',
            }
          ],
          'shards': 1,
        },
      },
      'ToTLinuxTSan': {
        'swarming': {
          'shards': 6,
        },
      },
      'Win10 Tests x64 (dbg)': {
        'experiment_percentage': 100, # https://crbug.com/840369
      },
      'Win7 Tests (dbg)(1)': {
        'swarming': {
          'shards': 2,
        },
      },
      'linux-chromeos-code-coverage': {
        'swarming': {
          'shards': 4,
        },
      },
      'linux-code-coverage': {
        'swarming': {
          'shards': 4,
        },
      },
      # https://crbug.com/1199909,
      'linux-lacros-code-coverage': {
        'args': [
           '--test-launcher-filter-file=../../testing/buildbot/filters/linux-lacros.sync_integration_tests.filter',
        ]
      },
      'linux-lacros-rel': {
        'args': [
           '--test-launcher-filter-file=../../testing/buildbot/filters/linux-lacros.sync_integration_tests.filter',
        ]
      },
      'linux-lacros-tester-rel': {
        'args': [
          '--test-launcher-filter-file=../../testing/buildbot/filters/linux-lacros.sync_integration_tests.filter',
        ],
      },
    },
  },
  'system_webview_shell_layout_test_apk': {
    'remove_from': [
      'android-11-x86-fyi-rel', # crbug.com/1165280
    ],
  },
  'system_webview_wpt': {
    'modifications': {
      'android-webview-pie-x86-wpt-fyi-rel': {
        'swarming': {
          'dimension_sets': [
            {
              'machine_type': 'n1-standard-8',
            },
          ],
          'shards': 18,
        },
      },
    },
  },
  'tab_capture_end2end_tests': {
    # Run these only on Release bots.
    'remove_from': [
      'Linux Debug (NVIDIA)',
      'Mac Debug (Intel)',
      'Mac Retina Debug (AMD)',
      'Win10 FYI x64 Debug (NVIDIA)',
      # Disabled due to dbus crashes crbug.com/927465
      'Linux FYI Release (Intel HD 630)',
      'Linux FYI Release (NVIDIA)',
      'Linux FYI SkiaRenderer Vulkan (Intel HD 630)',
      'Linux FYI SkiaRenderer Vulkan (NVIDIA)',
      'Linux Release (NVIDIA)',
    ],
  },
  'telemetry_chromium_minidump_unittests': {
    'remove_from': [
      'android-marshmallow-x86-rel-non-cq', # crbug.com/1084352
    ],
  },
  'telemetry_monochrome_minidump_unittests': {
    'remove_from': [
      # Monochrome isn't supported on M.
      'android-marshmallow-arm64-rel',
      'android-marshmallow-x86-rel-non-cq',
    ],
  },
  'telemetry_perf_unittests': {
    'modifications': {
      'Linux Tests': {
        'args': [
          '--xvfb',
          '--jobs=1',
        ],
      },
      'Linux Tests (dbg)(1)': {
        'args': [
          '--xvfb',
          '--jobs=1',
        ],
      },
      # TODO crbug.com/1143924: Remove when experimentation is complete
      'Linux Tests Robocrop': {
        'args': [
          '--xvfb',
          '--jobs=1',
        ],
      },
      # Disable parallelism on all Mac bots.
      'Mac10.11 Tests': {
        'args': [
          '--jobs=1',
        ],
      },
      'Mac10.12 Tests': {
        'args': [
          '--jobs=1',
        ],
      },
      'Mac11 Tests': {
        # TODO(crbug.com/1206401): Restore to defaults when there is enough
        # capacity.
        'swarming': {
          'dimension_sets': [
            {
              'machine_type': 'n1-standard-4',
            },
          ],
          'shards': 1,
        },
      },
      'Win7 Tests (dbg)(1)': {
        'args': [
          '--jobs=1',
        ],
        'swarming': {
          'shards': 20,
        },
        'experiment_percentage': 100,
      },
      'chromeos-eve-chrome': {
        'args': [
          # TODO(crbug.com/1191132): Re-enable.
          '--skip=benchmarks.benchmark_smoke_unittest.BenchmarkSmokeTest.wasmpspdfkit',
        ],
      },
      'chromeos-kevin-chrome': {
        # TODO(crbug.com/1182948): Remove the experiment.
        'experiment_percentage': 100,
      },
      'linux-bionic-rel': {
        'args': [
          '--xvfb',
          '--jobs=1',
        ],
      },
      'linux-chromium-tests-staging-tests': {
        'args': [
          '--xvfb',
          '--jobs=1',
        ],
      },
      'linux-trusty-rel': {
        'args': [
          '--xvfb',
          '--jobs=1',
        ],
      },
      'linux-xenial-rel': {
        'args': [
          '--xvfb',
          '--jobs=1',
        ],
      },
    },
    'remove_from': [
      'android-marshmallow-x86-rel-non-cq', # crbug.com/1084352
      # There's no need to run telemetry_perf_unittests on both lollipop and
      # marshmallow on the CQ. https://crbug.com/1026487.
      'android-marshmallow-arm64-rel',
      'android-nougat-arm64-rel', # crbug.com/1108124
      'android-pie-arm64-rel',
      # crbug.com/936540
      'Mac10.11 Tests',
      'Mac10.13 Tests',
      'Mac10.15 Tests',
      'Mac10.15 Tests (dbg)',
      'Linux - Future (dbg)',  # client.v8.chromium
      'Win10 Tests x64',
      'Win10 Tests x64 (dbg)',
    ],
  },
  'telemetry_unittests': {
    'modifications': {
      # TODO(crbug.com/1206401): Restore to defaults when there is
      # enough capacity.
      'Mac11 Tests': {
        'swarming': {
          'dimension_sets': [
            {
              'machine_type': 'n1-standard-4',
            },
          ],
          'shards': 1,
        },
      },
      'Win10 Tests x64 (dbg)': {
        'experiment_percentage': 100,  # crbug.com/870673
      },
    },
    'remove_from': [
      'chromeos-kevin-rel',  # crbug.com/1141234: Restore when there's more DUTs

      # crbug.com/936540
      'Mac10.11 Tests',

      'Win10 Tests x64',
    ],
  },
  'test_buildbucket_api_gpu_use_cases': {
    'remove_from': [
      # crbug.com/1080749
      'Optional Linux Release (NVIDIA)',
    ],
  },
  'unit_tests': {
    'remove_from': [
      # There's no need to run unit_tests on both lollipop and marshmallow
      # on the CQ. https://crbug.com/1026487.
      'android-marshmallow-arm64-rel',
      'android-marshmallow-x86-rel-non-cq', # runs on MM-x86-rel already
      'android-pie-arm64-rel',  # https://crbug.com/1010211
    ],
    'modifications': {
      'Linux ASan LSan Tests (1)': {
        # These are slow on the ASAN trybot for some reason.
        # crbug.com/794372
        'swarming': {
          'shards': 4,
        },
      },
      'Linux Chromium OS ASan LSan Tests (1)': {
        # These are slow on the ASAN trybot for some reason.
        # crbug.com/794372
        'swarming': {
          'shards': 2,
        },
      },
      'Linux ChromiumOS MSan Tests': {
        # These are very slow on the Chrome OS MSAN trybot for some reason.
        # crbug.com/865455
        'swarming': {
          'shards': 2,
        },
      },
      # TODO(crbug.com/1200904): Remove after migration
      'Linux TSan (bionic)': {
        'swarming': {
          'shards': 2,
        },
      },
      'Linux TSan Tests': {
        'swarming': {
          'shards': 2,
        },
      },
      'Mac11 Tests': {
        # TODO(crbug.com/1206401): Restore to defaults when there is enough
        # capacity.
        'swarming': {
          'dimension_sets': [
            {
              'machine_type': 'n1-standard-4',
            },
          ],
        },
      },
      'ToTLinuxASan': {
        'swarming': {
          'shards': 2,
        },
      },
      'android-asan': {
        'args': [
          '--test-launcher-filter-file=../../testing/buildbot/filters/android.asan.unit_tests.filter',
        ],
      },
      'android-marshmallow-arm64-rel-swarming': {
        'swarming': {
          'shards': 8,
        },
      },
      'linux-chromeos-chrome': {
        'args': [
          '--test-launcher-filter-file=../../testing/buildbot/filters/chromeos.unit_tests.filter',
        ],
      },
      'linux-chromeos-dbg': {
        'swarming': {
          'shards': 2,
        },
      },
      'linux-chromeos-rel': {
        'swarming': {
          'shards': 2,
        },
      },
      # https://crbug.com/1111979,
      'linux-lacros-code-coverage': {
        'args': [
          '--test-launcher-filter-file=../../testing/buildbot/filters/linux-lacros.unit_tests.filter',
        ],
      },
      # https://crbug.com/1111979,
      'linux-lacros-rel': {
        'args': [
          '--test-launcher-filter-file=../../testing/buildbot/filters/linux-lacros.unit_tests.filter',
        ],
      },
      # https://crbug.com/1111979,
      'linux-lacros-tester-rel': {
        'args': [
          '--test-launcher-filter-file=../../testing/buildbot/filters/linux-lacros.unit_tests.filter',
        ],
      },
    },
  },
  'unit_tests_wayland': {
    'modifications': {
      # CI Ozone/Wayland tester.
      'Linux Tester (Ozone Wayland)': {
        'args': [
          '--test-launcher-filter-file=../../testing/buildbot/filters/ozone-linux.unit_tests_wayland.filter',
        ],
      },
    }
  },
  'video_decode_accelerator_gl_unittest': {
    'remove_from': [
      # Windows Intel doesn't have the GL extensions to support this test.
      'Optional Win10 x64 Release (Intel HD 630)',
      'Win10 FYI x64 Release (Intel HD 630)',
      'Win10 FYI x64 Exp Release (Intel HD 630)',
    ],
  },
  'views_unittests': {
    'modifications': {
      # https://crbug.com/1111979,
      'linux-lacros-code-coverage': {
        'args': [
          '--gtest_filter=-DesktopWidgetFocusManagerTest.AnchoredDialogInDesktopNativeWidgetAura:'
          'DesktopWidgetTest*:'
          'DesktopWindowTreeHostPlatformTest*:'
          'EditableComboboxTest*:'
          'MenuRunnerTest*:'
          'TextfieldTest*:'
          'TooltipControllerTest*:'
          'TooltipStateManagerTest*'
        ],
      },
      'linux-lacros-tester-rel': {
        'args': [
          '--gtest_filter=-DesktopWidgetFocusManagerTest.AnchoredDialogInDesktopNativeWidgetAura:'
          'DesktopWidgetTest*:'
          'DesktopWindowTreeHostPlatformTest*:'
          'EditableComboboxTest*:'
          'MenuRunnerTest*:'
          'TextfieldTest*:'
          'TooltipControllerTest*:'
          'TooltipStateManagerTest*'
        ],
      },
    },
  },
  'views_unittests_wayland': {
    'modifications': {
      # CQ tester.
      'Linux Ozone Tester (Wayland)': {
        'args': [
          '--test-launcher-filter-file=../../testing/buildbot/filters/ozone-linux.wayland_views_unittests.filter',
        ],
      },
      # CI tester.
      'Linux Tester (Ozone Wayland)': {
        'args': [
          '--test-launcher-filter-file=../../testing/buildbot/filters/ozone-linux.wayland_views_unittests.filter',
        ],
      },
    },
  },
  'viz_unittests': {
    'modifications': {
      'android-11-x86-fyi-rel': {
        'args': [
          '--test-launcher-filter-file=../../testing/buildbot/filters/android.emulator_11.viz_unittests.filter',
        ],
      },
      'android-marshmallow-x86-rel-non-cq': {
        'args': [
          '--test-launcher-filter-file=../../testing/buildbot/filters/android.emulator.viz_unittests.filter',
        ],
      },
      'android-pie-x86-rel': {
        'args': [
          '--test-launcher-filter-file=../../testing/buildbot/filters/android.emulator.viz_unittests.filter',
        ],
      },
    },
  },
  'vr_android_unittests': {
    'remove_from': [
      'android-lollipop-arm-rel',
      'android-marshmallow-x86-rel-non-cq',
      'android-pie-x86-rel',
      'android-11-x86-fyi-rel',
    ],
  },
  'vr_common_unittests': {
    'remove_from': [
      'android-pie-x86-rel',
    ],
  },
  'vr_pixeltests': {
    'remove_from': [
      'android-pie-x86-rel',
      'VR Linux',
    ],
  },
  'wayland_client_perftests': {
    'remove_from': [
      'linux-chromeos-dbg',  # https://crbug.com/859307
    ],
  },
  'web_engine_browsertests': {
    'modifications': {
      'fuchsia-code-coverage': {
        'swarming': {
          'shards': 14,
        },
      },
    },
  },
  'webdriver_tests_suite': {
    'remove_from': [
      'Linux Tests',  # https://crbug.com/929689, https://crbug.com/936557
      'linux-xenial-rel',
    ],
  },
  'webgl2_conformance_gl_passthrough_tests': {
    'remove_from': [
      # Not enough capacity. https://crbug.com/982294
      'Mac Pro FYI Release (AMD)',
      'Mac FYI Retina Release (NVIDIA)',
    ],
  },
  'webgl2_conformance_validating_tests': {
    'remove_from': [
      # The Mac NVIDIA Retina bots don't have the capacity to run
      # this test suite on mac_optional_gpu_tests_rel.
      'Optional Mac Retina Release (NVIDIA)',
    ],
    'modifications': {
      'Mac FYI GPU ASAN Release': {
        'args': [
          '--is-asan',
        ]
      },
    },
  },
  'webgl_conformance_gl_passthrough_tests': {
    'remove_from': [
      # crbug.com/555545 and crbug.com/649824:
      # Disable webgl_conformance_gl_tests on some Win/AMD cards.
      # Always fails on older cards, flaky on newer cards.
      'Win7 FYI Release (AMD)',
    ],
  },
  'webgl_conformance_metal_passthrough_tests': {
    'remove_from': [
      # crbug.com/1158857: re-enable if Metal shader cache workaround is added.
      'Mac FYI Retina Release (NVIDIA)',
    ],
  },
  'webgl_conformance_tests': {
    'remove_from': [
      # Too slow on this configuration, which is severely hardware
      # constrained. crbug.com/950690
      'Mac FYI Retina Debug (NVIDIA)',
    ],
  },
  'webgl_conformance_validating_tests': {
    'modifications': {
      'Mac FYI GPU ASAN Release': {
        'args': [
          '--is-asan',
        ]
      },
    },
  },
  'webkit_unit_tests': {
    'remove_from': [
      # Flakily fails on Win7. https://crbug.com/943372.
      'Win7 Tests (1)',
      'Win 7 Tests x64 (1)',
      'android-lollipop-arm-rel', # crbug.com/1133002#c6
      # Runs on android-marshmallow-x86-rel already (crbug.com/1127110)
      'android-marshmallow-arm64-rel',
      'android-marshmallow-x86-rel-non-cq',
    ],
    'modifications': {
      'Linux ASan LSan Tests (1)': {
        # These are very slow on the ASAN trybot for some reason.
        # crbug.com/794372
        'swarming': {
          'shards': 5,
        },
      },
      # TODO(crbug.com/1200904): Remove after migration
      'Linux TSan (bionic)': {
        'swarming': {
          'shards': 2,
        },
      },
      'Linux TSan Tests': {
        'swarming': {
          'shards': 2,
        },
      },
      'Marshmallow 64 bit Tester': {
        # Increase timeout. See https://crbug.com/847229.
        'swarming': {
          'hard_timeout': 1200,
        },
      },
      'android-11-x86-fyi-rel': {
        'args': [
          '--test-launcher-filter-file=../../testing/buildbot/filters/android.emulator_11.blink_unittests.filter',
        ],
      },
      'linux-blink-heap-concurrent-marking-tsan-rel': {
        'swarming': {
          'shards': 2,
        },
      },
    },
  },
  'weblayer_browsertests': {
    'modifications': {
      'android-11-x86-fyi-rel': {
        'args': [
          # TODO(crbug.com/1191784): Enable this test once the issue is fixed.
          '--gtest_filter=-DownloadBrowserTest.OverrideDownloadDirectory',
        ],
      },
      'android-pie-arm64-rel': {
        # TODO(crbug.com/1111436): Move this back to walleye if/when additional
        # capacity has been deployed.
        'swarming': {
          'dimension_sets': [
            {
              'device_type': 'sailfish',
            },
          ],
        },
      },
    },
  },
  'weblayer_bundle_test': {
    'remove_from': [
      'android-marshmallow-x86-rel-non-cq', # crbug.com/1088013
      'android-11-x86-fyi-rel', # crbug.com/1165280
    ],
  },
  'weblayer_instrumentation_test_apk': {
    'remove_from': [
      'android-marshmallow-x86-rel-non-cq', # crbug.com/1088013
      'android-11-x86-fyi-rel', # crbug.com/1165280
    ],
    'modifications': {
      'android-pie-arm64-rel': {
        # TODO(crbug.com/1111436): Move this back to walleye if/when additional
        # capacity has been deployed.
        'swarming': {
          'dimension_sets': [
            {
              'device_type': 'sailfish',
            },
          ],
        },
      },
    },
  },
  'weblayer_instrumentation_test_apk_ToT_Tests': {
    'modifications': {
      'android-weblayer-10-x86-rel-tests': {
        'args': [
          '--replace-system-package=org.chromium.weblayer.shell,apks/WebLayerShellSystemWebView.apk'
        ]
      },
      'android-weblayer-marshmallow-x86-rel-tests': {
        'args': [
          '--replace-system-package=org.chromium.weblayer.shell,apks/WebLayerShellSystemWebView.apk'
        ]
      }
    }
  },
  'weblayer_private_instrumentation_test_apk': {
    'modifications': {
      # TODO(crbug.com/1189403): Remove the filter once the issue is fixed.
      'android-11-x86-fyi-rel': {
        'args': [
          '--gtest_filter=-org.chromium.weblayer.test.MediaCaptureTest.*',
        ],
      },
    },
  },
  'weblayer_shell_wpt': {
    'modifications': {
      # TODO(crbug.com/1171555): remove this when test can run with more emulators
      'android-weblayer-pie-x86-wpt-fyi-rel': {
        'swarming': {
          'dimension_sets': [
            {
              'machine_type': 'n1-standard-8',
            },
          ],
          'shards': 18,
        },
      },
      'android-weblayer-pie-x86-wpt-smoketest': {
        'args': [
	  '--default-exclude',
          '--include-file=../../third_party/blink/web_tests/android/WPTSmokeTestCases'
        ],
        'swarming': {
          'dimension_sets': [
            {
              'machine_type': 'n1-standard-8',
            },
          ],
          'shards': 3,
        },
      },
    },
  },
  'webview_cts_tests': {
    'remove_from': [
      'android-11-x86-fyi-rel', # crbug.com/1165280
      'android-pie-arm64-coverage-experimental-rel', # TODO(crbug.com/1190999):
                                                     # GLIBC_2.28 Not found.
    ],
    'modifications': {
      'android-pie-arm64-rel': {
        # TODO(crbug.com/1111436): Move this back to walleye if/when additional
        # capacity has been deployed.
        'swarming': {
          'dimension_sets': [
            {
              'device_type': 'sailfish',
            },
          ],
        },
      },
    },
  },
  'webview_cts_tests_gtest': {
    'remove_from': [
      'android-marshmallow-arm64-rel-dual-coverage',
    ],
  },
  'webview_instrumentation_test_apk': {
    'remove_from': [
      # This test frequently fails on Android, https://crbug.com/824959
      'android-lollipop-arm-rel',
      # matching android builders, the test fails on these.
      'ToTAndroid',
      'android-asan',  # https://crbug.com/964562
      'android-code-coverage-native', # Does not generate profraw data.
      'android-pie-arm64-coverage-experimental-rel', # Does not generate profraw data.

      # On chromium.swarm, this should possibly be being run (or removed
      # from android-marshmallow-arm64-rel-swarming).
      'android-lollipop-arm-rel-swarming',
      # https://crbug.com/1147531 - covered on pie
      'android-marshmallow-arm64-rel',
    ],
    'modifications': {
      # chromium.android.fyi
      'Android WebView P FYI (rel)': {
        'args': [
          '--annotation',
          'DisabledTest,FlakyTest' # Monitor status of disabled tests.
        ],
      },
      'Oreo Phone Tester': {
        # TODO(crbug.com/997362): Enable this once it's passing.
        # TODO(https://crbug.com/884413): Re-enable this once the tests are
        # either passing or there is more capacity.
        'experiment_percentage': 0,
      },
      'android-11-x86-fyi-rel': {
        'args': [
          # TODO(crbug.com/1189746) Enable this test once the issue is fixed.
          '--gtest_filter=-org.chromium.net.NetworkChangeNotifierTest.testNetworkChangeNotifierJavaObservers',
        ],
      },
      'android-pie-x86-rel': {
        'args': [
          '--test-launcher-filter-file=../../testing/buildbot/filters/android.emulator.webview_instrumentation_test_apk.filter',
        ],
      },
    },
  },
  'webview_ui_instrumentation_tests': {
    'remove_from': [
      'android-marshmallow-arm64-rel-dual-coverage',
    ],
  },
  'webview_ui_test_app_test_apk': {
    'remove_from': [
      'android-11-x86-fyi-rel', # crbug.com/1165280
    ],
  },
  'xr_browser_tests': {
    'remove_from': [
      # Fails on the bot, http://crbug.com/868143
      'Win7 FYI Release (AMD)',
    ],
  },
}
