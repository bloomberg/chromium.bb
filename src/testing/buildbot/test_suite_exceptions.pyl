# Copyright 2017 The Chromium Authors. All rights reserved.
# Use of this source code is governed by a BSD-style license that can be
# found in the LICENSE file.

# This is a .pyl, or "Python Literal", file. You can treat it just like a
# .json file, with the following exceptions:
# * all keys must be quoted (use single quotes, please);
# * comments are allowed, using '#' syntax; and
# * trailing commas are allowed.

# Exceptions to the common test suites can only include removal from
# particular bots, and modifications on particular bots. By design,
# it's not possible to add one-off tests to bots. Instead they have to
# be added to one of the test suites in test_suites.pyl.
#
# The goal is to drive the number of exceptions to zero, to make all
# the bots behave similarly.
{
  'android_browsertests': {
    'modifications': {
      'android-pie-arm64-rel': {
        'args': [
          '--gtest_filter=-ImportantSitesUtilBrowserTest.DSENotConsideredImportantInRegularMode', # https://crbug.com/1034001
        ],
      },
      'android-pie-x86-rel': {
        'args': [
          '--gtest_filter=-ImportantSitesUtilBrowserTest.DSENotConsideredImportantInRegularMode', # https://crbug.com/1034001
        ],
      },
    },
  },
  'android_webview_unittests': {
    'remove_from': [
      # On chromium.android, these do not need to run prior to M.
      'android-lollipop-arm-rel',
      'android-code-coverage-native', # crbug/1018434
    ],
  },
  'angle_end2end_tests': {
    'remove_from': [
      # TODO(ynovikov) Investigate why the test breaks on older devices.
      'Android FYI Release (Nexus 5)',
      'Android FYI Release (Nexus 6)',
      'Android FYI Release (Nexus 9)',
      # Temporarily disabled due to AMDGPU-PRO issues crbug.com/786219
      'Linux FYI Release (AMD R7 240)',
      # Temporarily disabled due to bad NVIDIA driver upgrade crbug.com/950542
      'Linux FYI Debug (NVIDIA)',
      'Linux FYI GPU TSAN Release',
      # Disabling on RX 550 as we are currently qualifying the card and not
      # checking for regressions. crbug.com/1025745
      'Win10 FYI x64 Release (AMD RX 550)',
    ],
  },
  'angle_perftests': {
    'remove_from': [
      'Android FYI Release (Nexus 5)',  # crbug.com/915429
      'Android FYI Release (Nexus 6)',  # anglebug.com/2433
      'Linux FYI GPU TSAN Release',  # crbug.com/950542
    ],
  },
  'angle_unittests': {
    'remove_from': [
      # On Android, these are already run on the main waterfall.
      'Android FYI Release (Nexus 5X)',
    ],
    'modifications': {
      'Linux ASan LSan Tests (1)': {
        'swarming': {
          'shards': 10,
        },
      },
    },
  },
  'angle_white_box_tests': {
    'remove_from': [
      # https://crbug.com/1035178
      'Win10 FYI x64 Release (AMD RX 550)',
      # https://crbug.com/1035461
      'Linux FYI GPU TSAN Release',
    ],
  },
  'blink_web_tests': {
    'remove_from': [
      'Win 7 Tests x64 (1)',  # 64-bit win is unsupported by the layout tests.
      'Win10 Tests x64 (dbg)',
    ],
    'modifications': {
      'Fuchsia x64': {
        'args': [
          '--platform=fuchsia',
        ],
        'swarming': {
          'shards': 1,
        },
      },
      'Linux Tests': {
        "args": [
          "--additional-env-var=LLVM_PROFILE_FILE=${ISOLATED_OUTDIR}/profraw/default-%2m.profraw",
        ],
      },
      'Linux Tests (dbg)(1)': {
        'args': [
          '--debug',
        ],
        'swarming': {
          'shards': 20,
        },
      },
      'Mac10.10 Tests': {
        # TODO(kbr): this is essentially redundant.
        'swarming': {
          'dimension_sets': [
            {
              'gpu': 'none',
              'os': 'Mac-10.10.5',
            },
          ],
          'shards': 25,
        },
      },
      'Mac10.11 Tests': {
        # TODO(kbr): this is essentially redundant.
        'swarming': {
          'dimension_sets': [
            {
              'gpu': 'none',
              'os': 'Mac-10.11.6',
            },
          ],
          'shards': 25,
        },
      },
      'Mac10.12 Tests': {
        'swarming': {
          'shards': 25,
        },
      },
      'Mac10.13 Tests': {
        'swarming': {
          'dimension_sets': [
            {
              # Run the layout tests on a consistent set of hardware
              # (Mac Minis).
              'gpu': '8086:0a2e',
            },
          ],
          'shards': 25,
        },
      },
      'Mac10.13 Tests (dbg)': {
        'args': [
          '--debug',
        ],
        'swarming': {
          'shards': 25,
        },
      },
      'V8 Blink Linux Debug': {
        'args': [
          '--debug',
        ],
      },
      'V8 Blink Linux Future': {
        'args': [
          '--additional-driver-flag=--js-flags=--future',
        ],
      },
      'WebKit Linux ASAN': {
        'args': [
          '--additional-expectations',
          '../../third_party/blink/web_tests/ASANExpectations',
          '--time-out-ms',
          '48000',
          '--enable-sanitizer',
        ],
        'swarming': {
          'shards': 20,
        },
      },
      'WebKit Linux Leak': {
        'args': [
          '--additional-expectations',
          '../../third_party/blink/web_tests/LeakExpectations',
          '--time-out-ms',
          '48000',
          '--enable-leak-detection',
        ],
        'swarming': {
          'shards': 10,
        },
      },
      'WebKit Linux MSAN': {
        'args': [
          '--additional-expectations',
          '../../third_party/blink/web_tests/MSANExpectations',
          '--time-out-ms',
          '66000',
          '--enable-sanitizer',
        ],
        'swarming': {
          'expiration': 36000,
          'hard_timeout': 10800,
          'io_timeout': 3600,
          'shards': 20,
        },
      },
      'WebKit Linux composite_after_paint Dummy Builder': {
        'args': [
          '--additional-driver-flag=--enable-blink-features=CompositeAfterPaint',
        ],
      },
      'WebKit Linux layout_ng_disabled Builder': {
        'args': [
          '--additional-driver-flag=--disable-blink-features=LayoutNG',
        ],
      },
      'Win10 Tests x64': {
        'args': [
          '--target',
          'Release_x64',
        ],
        'swarming': {
          "shards": 28
        },
      },
      'Win10 Tests x64 (dbg)': {
        'args': [
          '--debug',
          '--target',
          'Debug_x64',
        ],
      },
      'Win10 Tests x64 Code Coverage': {
        'args': [
          '--target',
          'Release_x64',
        ],
        'swarming': {
          "shards": 28
        },
      },
      'Win7 Tests (dbg)(1)': {
        'args': [
          '--debug',
          '--time-out-ms',
          '60000'
        ],
        'experiment_percentage': 100,
        # TODO(kbr): the "Windows-7-SP1" Swarming dimension set is implicit,
        # from prefered_os_dimension in
        # tools/build/scripts/slave/recipe_modules/swarming/api.py. Ideally,
        # Swarming dimensions would be either specified for all testers on the
        # waterfall (and therefore, explicitly specified for all tests in the
        # generated JSON), or this would be removed, and the implicit one used.
        'swarming': {
          'dimension_sets': [
            {
              'os': 'Windows-7-SP1',
            }
          ],
        },
      },
      # tryserver.chromium.android
      'android_blink_rel': {
        'args': [
          '--release',
          '--android',
          # TODO(crbug.com/912120): Breakpad was entirely disabled on
          # Android. Remove this when it no longer affects Android crash
          # log handling.
          '--disable-breakpad',
          # TODO(crbug.com/875172): run on the real GPU since the
          # software fallback, SwiftShader, isn't yet for 32-bit ARM.
          '--additional-driver-flag=--use-gpu-in-tests',
        ],
      },
      'devtools_frontend_linux_blink_light_rel': {
        'args': [
          'http/tests/devtools',
        ],
        'swarming': {
          'shards': 4,
        },
      },
      'fuchsia-fyi-x64-rel': {
        'args': [
          '--platform=fuchsia',
        ],
        'swarming': {
          'shards': 1,
        },
      },
      'linux-autofill-assistant': {
        'args': [
          '--release',
        ],
      },
      'linux-bfcache-rel': {
        'args': [
          '--additional-driver-flag=--enable-features=BackForwardCache',
          '--additional-expectations=../../third_party/blink/web_tests/FlagExpectations/enable-features=BackForwardCache',
        ],
      },
      'linux-blink-animation-use-time-delta': {
        'args': [
          '--debug',
        ],
      },
      'linux-blink-cors-rel': {
        'args': [
          '--additional-driver-flag=--disable-features=OutOfBlinkCors',
          '--additional-expectations=../../third_party/blink/web_tests/FlagExpectations/disable-features=OutOfBlinkCors',
        ],
      },
      'linux-blink-heap-concurrent-marking-tsan-rel': {
        'args': [
          '--release',
          '--additional-driver-flag=--enable-features=BlinkHeapConcurrentMarking',
        ],
      },
      'linux-code-coverage': {
        'args': [
          '--additional-env-var=LLVM_PROFILE_FILE=${ISOLATED_OUTDIR}/profraw/default-%2m.profraw',
        ],
        'swarming': {
          'shards': 20,
        },
      },
      'linux-layout-tests-edit-ng': {
        'args': [
          '--additional-driver-flag=--enable-blink-features=EditingNG',
        ],
      },
      'linux-layout-tests-fragment-item': {
        'args': [
          '--additional-driver-flag=--enable-blink-features=LayoutNGFragmentItem',
        ],
      },
      'mac10.10-blink-rel-dummy': {
        'swarming': {
          'shards': 20,
        },
      },
      'mac10.11-blink-rel-dummy': {
        'swarming': {
          'shards': 20,
        },
      },
      'mac10.12-blink-rel-dummy': {
        'swarming': {
          'shards': 20,
        },
      },
      'mac10.13-blink-rel-dummy': {
        'swarming': {
          'shards': 20,
        },
      },
      'mac10.13_retina-blink-rel-dummy': {
        'swarming': {
          'shards': 20,
        },
      },
      'mac10.14-blink-rel-dummy': {
        'swarming': {
          'shards': 20,
        },
      },
      'mac10.15-blink-rel-dummy': {
        'swarming': {
          'shards': 20,
        },
      },
    },
  },
  'boringssl_crypto_tests': {
    'remove_from': [
      # https://crbug.com/1054545
      'Fuchsia ARM64',
    ],
  },
  'boringssl_ssl_tests': {
    'remove_from': [
      # https://crbug.com/1054545
      'Fuchsia ARM64',
    ],
  },
  'breakpad_unittests': {
    'modifications': {
      'android-asan': {
        'args': [
          '--test-launcher-filter-file=../../testing/buildbot/filters/android.asan.breakpad_unittests.filter',
        ],
      },
    },
  },
  'browser_tests': {
    'remove_from': [
      'CrWinAsan(dll)', # https://crbug.com/935598
      'linux-win_cross-rel',
      'ToTLinuxTSan',  # https://crbug.com/368525
      'Mac10.10 Tests',  # https://crbug.com/828031
      'Mac10.13 Tests',  # https://crbug.com/1042757
      'Linux TSan Tests',  # https://crbug.com/368525
      'Win10 Tests x64 (dbg)',
    ],
    'modifications': {
      'Linux - Future (dbg)': {  # client.v8.chromium
        'swarming': {
          'shards': 10,
        },
      },
      'Linux ASan LSan Tests (1)': {
        # These are very slow on the ASAN trybot for some reason.
        # crbug.com/794372
        'swarming': {
          'shards': 40,
        },
      },
      'Linux ASan Tests (sandboxed)': {
        'swarming': {
          'shards': 12, # https://crbug.com/1056300
        },
      },
      'Linux Chromium OS ASan LSan Tests (1)': {
        # These are very slow on the ASAN trybot for some reason.
        # crbug.com/794372
        'swarming': {
          'shards': 31,
        },
      },
      'Linux ChromiumOS MSan Tests': {
        # These are very slow on the Chrome OS MSAN trybot for some reason.
        # crbug.com/865455
        'swarming': {
          # TODO(crbug.com/1071693): Drop back down to 32 shards.
          'shards': 40,
        },
      },
      'Linux Tests (dbg)(1)': {
        # crbug.com/1066161
        'swarming': {
          'shards': 20,
        },
      },
      'Mac ASan 64 Tests (1)': {
        'swarming': {
          'dimension_sets': [
            {
              # These shards are liable to time out when running on minis.
              'cores': '8',
            }
          ],
          'shards': 20,
        },
      },
      'Mac10.13 Tests (dbg)': {
        'swarming': {
          'shards': 20,
        },
      },
      'ToTWin(dbg)': {
        'swarming': {
          'shards': 20,
        },
      },
      'ToTWin64(dbg)': {
        'swarming': {
          'shards': 20,
        },
      },
      'Win10 Tests x64': {
        # crbug.com/868082
        'args': [
          '--disable-features=WebRTC-H264WithOpenH264FFmpeg',
        ],
        'swarming': {
          # This is for slow test execution that often becomes a critical path of
          # swarming jobs. crbug.com/868114
          'shards': 15,
        }
      },
      'Win10 Tests x64 Code Coverage': {
        # crbug.com/868082
        'args': [
          '--disable-features=WebRTC-H264WithOpenH264FFmpeg',
        ],
        'swarming': {
          # This is for slow test execution that often becomes a critical path of
          # swarming jobs. crbug.com/868114
          'shards': 15,
        }
      },
      'Win7 Tests (1)': {
        # This is for slow test execution that often becomes a critical path of
        # swarming jobs. crbug.com/868114
        'swarming': {
          'shards': 15,
        },
      },
      'Win7 Tests (dbg)(1)': {
        'swarming': {
          'shards': 20,
        },
      },
      'linux-chromeos-chrome': {
        # TODO(https://crbug.com/932269): Promote out of experiment when the
        # tests are green.
        'args': [
          '--test-launcher-filter-file=../../testing/buildbot/filters/chromeos.browser_tests.filter',
        ],
      },
      'linux-chromeos-code-coverage': {
        'swarming': {
          'shards': 50,
        },
      },
      'linux-chromeos-dbg': {
        'swarming': {
          'shards': 30,
        },
      },
      'linux-chromeos-rel': {
        'swarming': {
          'shards': 20,
          'dimension_sets': [
            {
              'kvm': '1',
            },
          ],
        },
      },
      'linux-code-coverage': {
        'args': [
          '--no-sandbox',
        ],
        'swarming': {
          'shards': 50,
        },
      },
      'linux-trusty-rel': {
       'args': [
          '--test-launcher-filter-file=../../testing/buildbot/filters/linux_trusty_rel.browser_tests.filter',
        ],
      },
      'mac-code-coverage': {
        'swarming': {
          'shards': 15,
        },
      },
      'win-asan': {
        # browser_tests shards were reaching a timeout limit of 60 minutes on win-asan
        # (https://crbug.com/1031096).
        'swarming': {
          'shards': 20,
        },
      },
    },
  },
  'cc_unittests': {
    'modifications': {
      'Linux TSan Tests': {
        'swarming': {
          'shards': 3,
        },
      },
      'android-marshmallow-x86-fyi-rel': {
        # https://crbug.com/1039860
        'args': [
          '--test-launcher-filter-file=../../testing/buildbot/filters/android.emulator.cc_unittests.filter',
        ],
      },
      'android-pie-x86-rel': {
        # https://crbug.com/1039860
        'args': [
          '--test-launcher-filter-file=../../testing/buildbot/filters/android.emulator.cc_unittests.filter',
        ],
      },
    },
  },
  'checkbins': {
    'remove_from': [
      'linux-archive-dbg',
      'linux-archive-rel',
      'mac-archive-dbg',
      'mac-archive-rel',
    ],
  },
  'chrome_java_test_pagecontroller_tests': {
    'modifications': {
      'android-pie-arm64-rel': {
        'experiment_percentage': 100, # https://crbug.com/924194
      },
    },
  },
  'chrome_public_smoke_test': {
    'remove_from': [
      'android-code-coverage-native', # https://crbug.com/1018780
    ],
  },
  'chrome_public_test_apk': {
    'remove_from': [
      'android-asan',  # https://crbug.com/964562
      'android-code-coverage-native', # https://crbug.com/1018780
      'android-lollipop-arm-rel', # https://crbug.com/1060245
    ],
    'modifications': {
      'Android CFI': {
        'args': [
          '--exclude-annotation',
          'Feature=RenderTest', # https://crbug.com/1068294
        ],
      },
      'Marshmallow 64 bit Tester': {
        'swarming': {
          'shards': 14,
        },
      },
      'Marshmallow Tablet Tester': {
        'args': [
          '--timeout-scale',
          '2.0',
        ],
      },
      'Oreo Phone Tester': {
        # TODO(https://crbug.com/884413): Re-enable this once the tests are
        # either passing or there is more capacity.
        'experiment_percentage': 0,
      },
      'android-arm64-proguard-rel': {
        'swarming': {
          'shards': 25,
        },
      },
      'android-lollipop-arm-rel-swarming': {
        'swarming': {
          'service_account': 'chrome-gold-dev@chops-service-accounts.iam.gserviceaccount.com'
        },
      },
      'android-marshmallow-arm64-rel': {
        'swarming': {
          'shards': 25,
        },
      },
      'android-marshmallow-arm64-rel-swarming': {
        'swarming': {
          'service_account': 'chrome-gold-dev@chops-service-accounts.iam.gserviceaccount.com'
        },
      },
      'android-pie-arm64-rel': {
        'args': [
          '--test-launcher-filter-file=../../testing/buildbot/filters/android.pie_arm64_rel.chrome_public_test_apk.filter', # https://crbug.com/1010211
        ],
      },
      'android-pie-x86-rel': {
        'args': [
          '--avd-config=../../tools/android/avd/proto/generic_playstore_android28.textpb',
          # https://crbug.com/1046059
          '--test-launcher-filter-file=../../testing/buildbot/filters/android.emulator.chrome_public_test_apk.filter',
        ],
        'swarming': {
          'named_caches': [
            {
              'name': 'avd_generic_playstore_android28',
              'path': '.android',
            },
            {
              'name': 'system_images_android_28_google_apis_playstore_x86',
              'path': '.emulator_sdk',
            },
          ]
        },
      },
    },
  },
  'chrome_public_test_vr_apk': {
    'remove_from': [
      'Lollipop Tablet Tester',
      'Marshmallow Tablet Tester',
      'android-marshmallow-x86-fyi-rel',
      'android-pie-x86-rel',
      'android-pie-arm64-rel', # https://crbug.com/1010211
      'ToTAndroid',
      'ToTAndroidCFI',
      'android-asan',  # https://crbug.com/964562
      'android-code-coverage-native', # https://crbug.com/1018780
    ],
  },
  'chrome_public_test_vr_apk-vega': {
    'modifications': {
      'Oreo Phone Tester': {
        'swarming': {
          'dimension_sets': [
            {
              'device_os': 'OVR1.180808.003',
              'device_type': 'vega',
              'os': 'Android',
            },
          ],
        },
      }
    }
  },
  'chromedriver_py_tests': {
    'remove_from': [
      # Timeout happens sometimes (crbug.com/951799).
      'Win10 Tests x64 (dbg)',
    ],
  },
  'components_browsertests': {
    'remove_from': [
      'android-code-coverage-native', # crbug/1018434
    ],
  },
  'components_unittests': {
    'remove_from': [
      'Fuchsia ARM64',  # https://crbug.com/961457
      'Fuchsia x64', # https://crbug.com/961457
      'android-code-coverage-native', # crbug/1018431
      'fuchsia-fyi-arm64-rel',  # https://crbug.com/961457
      'fuchsia-fyi-x64-dbg',  # https://crbug.com/961457
      'fuchsia-fyi-x64-rel',  # https://crbug.com/961457
    ],
    'modifications': {
      'Linux ASan LSan Tests (1)': {
        # These are very slow on the ASAN trybot for some reason.
        # crbug.com/794372
        'swarming': {
          'shards': 5,
        },
      },
      'Linux Chromium OS ASan LSan Tests (1)': {
        # These are very slow on the ASAN trybot for some reason.
        # crbug.com/794372
        'swarming': {
          'shards': 5,
        },
      },
      'Linux TSan Tests': {
        'swarming': {
          'shards': 2,
        },
      },
      'linux-blink-heap-concurrent-marking-tsan-rel': {
        'swarming': {
          'shards': 2,
        },
      },
    },
  },
  'content_browsertests': {
    'remove_from': [
      'CrWinAsan(dll)', # https://crbug.com/935598
      'android-code-coverage-native', # crbug/1018434
      # http://crbug.com/1060245#c30: due to low utility and capacity.
      'android-marshmallow-arm64-rel',
    ],
    'modifications': {
      'Cast Audio Linux': {
        'args': [
          '--test-launcher-filter-file=../../testing/buildbot/filters/cast-linux.content_browsertests.filter',
        ],
      },
      'Cast Linux': {
        'args': [
          '--test-launcher-filter-file=../../testing/buildbot/filters/cast-linux.content_browsertests.filter',
        ],
      },
      'Linux ASan LSan Tests (1)': {
        'swarming': {
          'shards': 12,
        },
      },
      'Linux ASan Tests (sandboxed)': {
        'swarming': {
          'shards': 4, # https://crbug.com/1051944
        },
      },
      'Linux TSan Tests': {
        'swarming': {
          'shards': 15,
        },
      },
      'Lollipop Phone Tester': {
        'swarming': {
          'shards': 13,
        },
      },
      'Win10 Tests x64': {
        # crbug.com/868082
        'args': [
          '--disable-features=WebRTC-H264WithOpenH264FFmpeg',
        ],
      },
      'Win10 Tests x64 (dbg)': {
        'experiment_percentage': 100,
        # crbug.com/868082
        'args': [
          '--disable-features=WebRTC-H264WithOpenH264FFmpeg',
        ],
      },
      'Win10 Tests x64 Code Coverage': {
        # crbug.com/868082
        'args': [
          '--disable-features=WebRTC-H264WithOpenH264FFmpeg',
        ],
      },
      'android-arm64-proguard-rel': {
        'swarming': {
          'shards': 16,
        },
      },
      'android-asan': {
        'args': [
          '--test-launcher-filter-file=../../testing/buildbot/filters/android.asan.content_browsertests.filter',
        ],
        'swarming': {
          'shards': 18,
        },
      },
      'android-lollipop-arm-rel': {
        'swarming': {
          'shards': 15,
        },
      },
      'android-marshmallow-arm64-rel': {
        'swarming': {
          'shards': 16,
        },
      },
      'android-marshmallow-x86-fyi-rel': {
        'args': [
          '--test-launcher-filter-file=../../testing/buildbot/filters/android.emulator.content_browsertests.filter',
        ],
      },
      'android-pie-x86-rel': {
        'args': [
          '--test-launcher-filter-file=../../testing/buildbot/filters/android.emulator.content_browsertests.filter',
        ],
      },
      'linux-blink-heap-concurrent-marking-tsan-rel': {
        'swarming': {
          'shards': 4,
        },
      },
      'linux-chromeos-code-coverage': {
        'swarming': {
          'shards': 12,
        },
      },
      'linux-chromeos-rel': {
        'swarming': {
          'shards': 3,
        },
      },
      'linux-code-coverage': {
        'args': [
          '--no-sandbox',
        ],
        'swarming': {
          'shards': 12,
        },
      },
    },
  },
  'content_browsertests_wayland': {
    'modifications': {
      'Linux Ozone Tester (Wayland)': {
        'args': [
          '--test-launcher-filter-file=../../testing/buildbot/filters/ozone-linux.wayland_content_browsertests.filter',
        ],
      },
    },
  },
  'content_browsertests_x11': {
    'modifications': {
      'Linux Ozone Tester (X11)': {
        'args': [
          '--test-launcher-filter-file=../../testing/buildbot/filters/ozone-linux.x11_content_browsertests.filter',
        ],
      },
    },
  },
  'content_shell_crash_test': {
    'modifications': {
      'Win10 Tests x64 (dbg)': {
        'experiment_percentage': 100,  # https://crbug.com/861730
      },
    },
  },
  'content_shell_test_apk': {
    'remove_from': [
      'android-asan',  # https://crbug.com/964562
      'android-code-coverage-native', # crbug/1018434
    ],
    'modifications': {
      'android-marshmallow-x86-fyi-rel': {
        'args': [
          '--gtest_filter=-ContentViewScrollingTest.testFling',
        ],
      },
      'android-pie-x86-rel': {
        'args': [
          '--gtest_filter=-ContentViewScrollingTest.testFling',
        ],
      },
    },
  },
  'content_unittests': {
    'remove_from': [
      'android-code-coverage-native', # crbug/1018434
    ],
    'modifications': {
      'Linux ASan LSan Tests (1)': {
        # These are slow on the ASAN trybot for some reason.
        # crbug.com/794372
        'swarming': {
          'shards': 2,
        },
      },
      'Linux ChromiumOS MSan Tests': {
        # These are very slow on the Chrome OS MSAN trybot for some reason.
        # crbug.com/865455
        'swarming': {
          'shards': 2,
        },
      },
    },
  },
  'context_lost_tests': {
    # TODO(https://crbug.com/850107): Remove the Android FYI Release (Pixel 2)
    # exception once there is enough capacity to run these tests.
    'remove_from': [
      'Android FYI Release (Pixel 2)',
    ],
    'modifications': {
      'Mac FYI GPU ASAN Release': {
        'args': [
          '--is-asan',
        ]
      },
      'Win10 x64 Debug (NVIDIA)': {
        'args': [
          # TODO(https://crbug.com/1007013): Remove this flag when it's no
          # longer necessary to figure out why the renderer process is hanging.
          '--extra-browser-args=--no-sandbox',
        ],
      },
    },
  },
  'crashpad_tests': {
    'remove_from': [
      'linux-win_cross-rel', # https://crbug.com/762167
      # https://crbug.com/crashpad/304
      'Linux TSan Tests',
      'ToTLinuxTSan',
      # https://crbug.com/crashpad/306
      'Linux CFI',
      'CFI Linux ToT',
    ],
  },
  'cronet_sizes': {
    'modifications': {
      'android-cronet-arm-dbg': {
        'swarming': {
          'dimension_sets': [
            {
              'device_os': None,
              'device_type': None,
              'os': 'Ubuntu-16.04',
            },
          ],
        },
      },
    },
  },
  'dawn_end2end_tests': {
    'remove_from': [
      'Linux FYI Release (AMD R7 240)', # https://crbug.com/915430
    ],
  },
  'depth_capture_tests': {
    # TODO(https://crbug.com/850107): Remove the Android FYI Release (Pixel 2)
    # exception once there is enough capacity to run these tests.
    'remove_from': [
      'Android FYI Release (Pixel 2)',
    ],
    'modifications': {
      'Win10 x64 Debug (NVIDIA)': {
        'args': [
          # TODO(https://crbug.com/1007013): Remove this flag when it's no
          # longer necessary to figure out why the renderer process is hanging.
          '--extra-browser-args=--no-sandbox',
        ],
      },
    },
  },
  'disk_usage_tast_test': {
    # TODO(crbug.com/1077659): Add the test back after it's fixed.
    'remove_from': [
      'chromeos-kevin-rel',
    ],
  },
  'extensions_browsertests': {
    'remove_from': [
      'CrWinAsan(dll)', # https://crbug.com/935598
    ],
    'modifications': {
      'Win10 Tests x64 (dbg)': {
        'experiment_percentage': 100, # https://crbug.com/876615
      },
    },
  },
  'gin_unittests': {
    'remove_from': [
      'ToTLinuxASan',  # https://crbug.com/831667
      'Linux ASan LSan Tests (1)',  # https://crbug.com/831667
      'Linux Chromium OS ASan LSan Tests (1)',  # https://crbug.com/831667
    ],
  },
  'gl_tests': {
    'remove_from': [
      'CFI Linux ToT',
      'Android FYI Release (Nexus 5X)',
      # Can't run on MSAN because gl_tests uses the hardware driver,
      # which isn't instrumented.
      'Linux MSan Tests',
    ],
    'modifications': {
      # TODO(kbr): figure out a better way to specify blocks of
      # arguments like this for tests on multiple machines.
      'Linux ASan LSan Tests (1)': {
        'args': [
          '--use-gpu-in-tests',
          '--no-xvfb',
        ],
        'swarming': {
          'dimension_sets': [
            {
              'gpu': '10de:1cb3',
              'os': 'Ubuntu',
              'pool': 'chromium.tests.gpu.template',
            },
          ],
        },
        'use_xvfb': False,
      },
      'Linux CFI': {
        'args': [
          '--use-gpu-in-tests',
          '--no-xvfb',
        ],
        'swarming': {
          'dimension_sets': [
            {
              'gpu': '10de:1cb3',
              'os': 'Ubuntu',
              'pool': 'chromium.tests.gpu.template',
            },
          ],
        },
        'use_xvfb': False,
      },
      'Linux TSan Tests': {
        'args': [
          '--use-gpu-in-tests',
          '--no-xvfb',
        ],
        'swarming': {
          'dimension_sets': [
            {
              'gpu': '10de:1cb3',
              'os': 'Ubuntu',
              'pool': 'chromium.tests.gpu.template',
            },
          ],
        },
        'use_xvfb': False,
      },
      'android-marshmallow-x86-fyi-rel': {
        'args': [
          '--test-launcher-filter-file=../../testing/buildbot/filters/android.emulator.gl_tests.filter',
        ],
      },
      'android-pie-arm64-rel': {
        'args': [
          '--test-launcher-filter-file=../../testing/buildbot/filters/android.pie_arm64_rel.gl_tests.filter', # https://crbug.com/1034007
        ],
      },
      'android-pie-x86-rel': {
        'args': [
          '--test-launcher-filter-file=../../testing/buildbot/filters/android.emulator.gl_tests.filter',
        ],
      },
    },
  },
  'gl_unittests': {
    'remove_from': [
      # On Android, these are already run on the main waterfall.
      # Run them on the one-off Android FYI bots, though.
      'Android FYI Release (Nexus 5X)',
      # Temporarily disabled due to AMDGPU-PRO issues crbug.com/786219
      'Linux FYI Release (AMD R7 240)',
    ],
    'modifications': {
      'CFI Linux ToT': {
        'args': [
          '--use-gpu-in-tests',
          '--no-xvfb',
        ],
        'swarming': {
          'dimension_sets': [
            {
              'gpu': '10de:1cb3',
              'os': 'Ubuntu',
              'pool': 'chromium.tests.gpu.template',
            },
          ],
        },
        'use_xvfb': False,
      },
      'Linux CFI': {
        'args': [
          '--use-gpu-in-tests',
          '--no-xvfb',
        ],
        'swarming': {
          'dimension_sets': [
            {
              'gpu': '10de:1cb3',
              'os': 'Ubuntu',
              'pool': 'chromium.tests.gpu.template',
            },
          ],
        },
        'use_xvfb': False,
      },
    },
  },
  'gl_unittests_ozone': {
    'remove_from': [
      # Can't run on MSAN because gl_unittests_ozone uses the hardware driver,
      # which isn't instrumented.
      'Linux ChromiumOS MSan Tests',
    ],
  },
  'gpu_process_launch_tests': {
    # TODO(https://crbug.com/850107): Remove the Android FYI Release (Pixel 2)
    # exception once there is enough capacity to run these tests.
    'remove_from': [
      'Android FYI Release (Pixel 2)',
    ],
    'modifications': {
      'Win10 x64 Debug (NVIDIA)': {
        'args': [
          # TODO(https://crbug.com/1007013): Remove this flag when it's no
          # longer necessary to figure out why the renderer process is hanging.
          '--extra-browser-args=--no-sandbox',
        ],
      },
    },
  },
  'hardware_accelerated_feature_tests': {
    # TODO(https://crbug.com/850107): Remove the Android FYI Release (Pixel 2)
    # exception once there is enough capacity to run these tests.
    'remove_from': [
      'Android FYI Release (Pixel 2)',
    ],
  },
  'headless_browsertests': {
    'remove_from': [
      'CrWinAsan(dll)', # https://crbug.com/935598
    ],
  },
  'info_collection_tests': {
    'remove_from': [
      # The Mac ASAN swarming bot runs tests on two different GPU
      # types, so we can't have one expected vendor ID / device ID.
      'Mac FYI GPU ASAN Release',
      'Android V8 FYI Release (Nexus 5X)',
      'Linux V8 FYI Release (NVIDIA)',
      'Linux V8 FYI Release - pointer compression (NVIDIA)',
      'Mac V8 FYI Release (Intel)',
      'Win V8 FYI Release (NVIDIA)',
    ],
    'modifications': {
      # TODO(https://crbug.com/1099762): Remove the --expected-device-id args
      # once JSON generation properly handles multiple GPUs.
      'ANGLE GPU Win10 x64 Release (Intel HD 630)': {
        'args': [
          '--expected-device-id', '3e92',
        ],
      },
      'Optional Win10 x64 Release (Intel HD 630)': {
        'args': [
          '--expected-device-id', '3e92',
        ],
      },
      'Win10 FYI x64 Exp Release (Intel HD 630)': {
        'args': [
          # TODO(https://crbug.com/1053803): Add this to all tests once UHD
          # 630 machines are used alongside HD 630 machines.
          '--expected-device-id', '3e92',
        ],
      },
      'Win10 FYI x64 Release (Intel HD 630)': {
        'args': [
          '--expected-device-id', '3e92',
        ],
      },
      'Win10 FYI x64 dEQP Release (Intel HD 630)': {
        'args': [
          '--expected-device-id', '3e92',
        ],
      },
      'Win10 x64 Debug (NVIDIA)': {
        'args': [
          # TODO(https://crbug.com/1007013): Remove this flag when it's no
          # longer necessary to figure out why the renderer process is hanging.
          '--extra-browser-args=--no-sandbox',
        ],
      },
    },
  },
  'interactive_ui_tests': {
    'remove_from': [
      'CrWinAsan(dll)', # https://crbug.com/935598
    ],
    'modifications': {
      'Linux - Future (dbg)': {  # client.v8.chromium
        'swarming': {
          'shards': 3,
        },
      },
      'Linux ASan LSan Tests (1)': {
        # These are slow on the ASan trybot for some reason, crbug.com/794372
        'swarming': {
          'shards': 6,
        },
      },
      'Linux ChromiumOS MSan Tests': {
        # These are very slow on the Chrome OS MSAN trybot for some reason.
        # crbug.com/865455
        'swarming': {
          'shards': 5,
        },
      },
      'Linux TSan Tests': {
        # These are slow on the TSan bots for some reason, crbug.com/794372
        'swarming': {
          'shards': 20,
        },
      },
      'ToTLinuxTSan': {
        # These are slow on the TSan bots for some reason, crbug.com/794372
        'swarming': {
          'shards': 6,
        },
      },
      'Win 7 Tests x64 (1)': {
        # These tests are continually flaky on Win7 bots, crbug.com/967588
        'args': [
          '--test-launcher-filter-file=../../testing/buildbot/filters/autofill.interactive_ui_tests.filter',
        ],
      },
      # temporary, https://crbug.com/818832
      'Win10 Tests x64 (dbg)': {
        'experiment_percentage': 100,
      },
      'Win7 Tests (1)': {
        # These tests are continually flaky on Win7 bots, crbug.com/967588
        'args': [
          '--test-launcher-filter-file=../../testing/buildbot/filters/autofill.interactive_ui_tests.filter',
        ],
      },
      'Win7 Tests (dbg)(1)': {
        # These tests are continually flaky on Win7 bots, crbug.com/967588
        'args': [
          '--test-launcher-filter-file=../../testing/buildbot/filters/autofill.interactive_ui_tests.filter',
        ],
        'swarming': {
          'shards': 4,
        },
      },
      'linux-chromeos-chrome': {
        # TODO(crbug.com/970649): Remove this filter.
        'args': [
          '--gtest_filter=-SadTabViewInteractiveUITest.ReloadMultipleSadTabs',
        ],
      },
      'linux-chromeos-code-coverage': {
        'swarming': {
          'shards': 10,
        },
      },
      'linux-code-coverage': {
        'swarming': {
          'shards': 10,
        },
      },
    },
  },
  'ipc_tests': {
    'modifications': {
      'android-asan': {
        'swarming': {
          'shards': 2,
        },
      },
    },
  },
  'maps_pixel_test': {
    # TODO(https://crbug.com/850107): Remove the Android FYI Release (Pixel 2)
    # exception once there is enough capacity to run these tests.
    'remove_from': [
      'Android FYI Release (Pixel 2)',
    ],
    'replacements': {
      # The V8 builders pass the V8 revision for ${got_revision}, so instead
      # use ${got_cr_revision}, which is only set on the V8 bots.
      'Android V8 FYI Release (Nexus 5X)': {
        'args': {
          '--git-revision': '${got_cr_revision}',
        },
      },
      'Linux V8 FYI Release (NVIDIA)': {
        'args': {
          '--git-revision': '${got_cr_revision}',
        },
      },
      'Linux V8 FYI Release - pointer compression (NVIDIA)': {
        'args': {
          '--git-revision': '${got_cr_revision}',
        },
      },
      'Mac V8 FYI Release (Intel)': {
        'args': {
          '--git-revision': '${got_cr_revision}',
        },
      },
      'Win V8 FYI Release (NVIDIA)': {
        'args': {
          '--git-revision': '${got_cr_revision}',
        },
      },
    },
  },
  'media_unittests': {
    'modifications': {
      'android-marshmallow-x86-fyi-rel': {
        'args': [
          '--test-launcher-filter-file=../../testing/buildbot/filters/android.emulator.media_unittests.filter',
        ],
      },
      'android-pie-arm64-rel': {
        'args': [
          '--gtest_filter=-AAudio/AudioOutputTest.Play200HzTone/0', # https://crbug.com/1034009
        ],
      },
      'android-pie-x86-rel': {
        'args': [
          '--test-launcher-filter-file=../../testing/buildbot/filters/android.emulator.media_unittests.filter',
        ],
      },
    },
  },
  'mojo_unittests': {
    'modifications': {
      'android-asan': {
        'swarming': {
          'shards': 5,
        },
      },
    },
  },
  'monochrome_apk_checker': {
    'modifications': {
      'ToTAndroid': {
        'swarming': {
          'dimension_sets': [
            {
              'cpu': 'x86-64',
              'device_os': None,
              'device_playstore_version': None,
              'device_type': None,
              'os': 'Ubuntu-16.04',
            },
          ],
        },
      },
      'android-arm64-proguard-rel': {
        'swarming': {
          'dimension_sets': [
            {
              'cpu': 'x86-64',
              'device_os': None,
              'device_playstore_version': None,
              'device_type': None,
              'os': 'Ubuntu-16.04',
            },
          ],
        },
      },
      'android-pie-arm64-rel': {
        'swarming': {
          'dimension_sets': [
            {
              'cpu': 'x86-64',
              'device_os': None,
              'device_os_flavor': None,
              'device_playstore_version': None,
              'device_type': None,
              'os': 'Ubuntu-16.04',
            },
          ],
        },
      },
    },
  },
  'monochrome_public_test_ar_apk': {
    'modifications': {
      'Nougat Phone Tester': {
        'args': [
          # ArCore is not installed as a system app on N, so we can install it
          # normally instead of replacing the system version.
          '--additional-apk=//third_party/arcore-android-sdk/test-apks/arcore/arcore_current.apk'
        ],
      },
      # We need to match the Playstore version as well because AR tests fail on
      # old versions of the Playstore.
      'Oreo Phone Tester': {
        'args': [
          # ArCore is not installed as a system app on O, so we can install it
          # normally instead of replacing the system version.
          '--additional-apk=//third_party/arcore-android-sdk/test-apks/arcore/arcore_current.apk'
        ],
        'swarming': {
          'dimension_sets': [
            {
              'device_os': 'OPR3.170623.008',
              'device_playstore_version': '12.8.23-all',
              'device_type': 'marlin',
              'os': 'Android',
            },
          ],
        },
      },
      'android-10-arm64-rel': {
        'args': [
          '--replace-system-package=com.google.ar.core,//third_party/arcore-android-sdk/test-apks/arcore/arcore_current.apk'
        ]
      },
      'android-pie-arm64-dbg': {
        'args': [
          '--replace-system-package=com.google.ar.core,//third_party/arcore-android-sdk/test-apks/arcore/arcore_current.apk'
        ]
      }
    },
  },
  'nacl_helper_nonsfi_unittests': {
    'remove_from': [
      'Linux TSan Tests',  # Sets enable_nacl=false.
    ],
  },
  'nacl_loader_unittests': {
    'remove_from': [
      'ToTMacASan',  # The mac asan tot bot sets enable_nacl=false
      'linux-win_cross-rel',  # Sets enable_nacl=false, https://crbug.com/774186
      'Linux TSan Tests',  # The TSan bot sets enable_nacl=false
      'Mac ASan 64 Tests (1)',  # The mac asan bot sets enable_nacl=false
    ],
  },
  'net_unittests': {
    'remove_from': [
      'Fuchsia ARM64',  # https://crbug.com/877248
      'fuchsia-fyi-x64-dbg',  # https://crbug.com/844416
    ],
    'modifications': {
      'Linux ASan LSan Tests (1)': {
        # These are very slow on the ASAN trybot for some reason.
        # crbug.com/794372
        'swarming': {
          'shards': 16,
        },
      },
      'Linux Chromium OS ASan LSan Tests (1)': {
        # These are very slow on the ASAN trybot for some reason.
        # crbug.com/794372
        'swarming': {
          'shards': 8,
        }
      },
      'Linux ChromiumOS MSan Tests': {
        # These are very slow on the Chrome OS MSAN trybot for some reason.
        # crbug.com/865455
        'swarming': {
          'shards': 2,
        },
      },
      'Linux TSan Tests': {
        'swarming': {
          'shards': 4,
        }
      },
      # The suite runs signficantly slower on linux dbg, so increase shards.
      'Linux Tests (dbg)(1)': {
        'swarming': {
          'shards': 2,
        },
      },
      'ToTLinuxASan': {
        # TODO(crbug.com/794372): net_unittests is slow under ASan.
        'swarming': {
          'shards': 16,
        },
      },
      'ToTLinuxTSan': {
        'swarming': {
          'shards': 4,
        }
      },
      'android-marshmallow-x86-fyi-rel': {
        # crbug.com/1046060
        'args': [
          '--test-launcher-filter-file=../../testing/buildbot/filters/android.emulator.net_unittests.filter',
        ],
      },
      'android-pie-x86-rel': {
        # crbug.com/1046060
        'args': [
          '--test-launcher-filter-file=../../testing/buildbot/filters/android.emulator.net_unittests.filter',
        ],
      },
      'chromeos-betty-chrome': {
        # TODO(crbug.com/986904): Remove this filter.
        'args': [
          '--gtest_filter=-NetworkQualityEstimatorTest.TestTCPSocketRTT',
        ],
      },
      'linux-blink-heap-concurrent-marking-tsan-rel': {
        'swarming': {
          'shards': 4,
        }
      },
      'linux-chromeos-dbg': {
        'swarming': {
          'shards': 2,
        },
      },
    },
  },
  'network_service_browser_tests': {
    'remove_from': [
      'CrWinAsan(dll)', # https://crbug.com/935598
      'ToTLinuxTSan',  # https://crbug.com/368525
      'Linux ASan LSan Tests (1)',  # No capacity, https://crbug.com/852442
      'Linux TSan Tests',  # No capacity, https://crbug.com/852442
      'Win7 Tests (1)',  # For swarming capacity reasons.
      'Win10 Tests x64 (dbg)',  # Matches browser_tests.
      # Only run network service tests on Mac 10.12 for capacity reasons.
      'Mac10.10 Tests',
      'Mac10.11 Tests',
      'Mac10.13 Tests',
      'Mac10.13 Tests (dbg)',
      'Mac ASan 64 Tests (1)',
      'ToTMacASan',
    ],
    'modifications': {
      'Win10 Tests x64': {
        # crbug.com/868082
        'args': [
          '--disable-features=WebRTC-H264WithOpenH264FFmpeg',
        ],
        # This is for slow test execution that often becomes a critical path of
        # swarming jobs. crbug.com/868114
        'swarming': {
          'shards': 20,
        },
      },
      'Win10 Tests x64 Code Coverage': {
        # crbug.com/868082
        'args': [
          '--disable-features=WebRTC-H264WithOpenH264FFmpeg',
        ],
        # This is for slow test execution that often becomes a critical path of
        # swarming jobs. crbug.com/868114
        'swarming': {
          'shards': 20,
        },
      },
      'linux-code-coverage': {
        'args': [
          '--no-sandbox',
        ],
        'swarming': {
          'shards': 20,
        },
      }
    },
  },
  'network_service_components_browsertests': {
    'remove_from': [
      'Linux ASan LSan Tests (1)',  # No capacity, https://crbug.com/852442
      'Linux TSan Tests',  # No capacity, https://crbug.com/852442
      'Win7 Tests (1)',  # For swarming capacity reasons.
      'Win10 Tests x64 (dbg)',  # Matches components_browsertests.
      # Only run network service tests on Mac 10.12 for capacity reasons.
      'Mac10.10 Tests',
      'Mac10.11 Tests',
      'Mac10.13 Tests',
      'Mac10.13 Tests (dbg)',
      'Mac ASan 64 Tests (1)',
      'ToTMacASan',
    ],
  },
  'network_service_content_browsertests': {
    'remove_from': [
      'CrWinAsan(dll)', # https://crbug.com/935598
      'ToTLinuxTSan',  # Match 'Linux TSan Tests' below since this is slow.
      'Linux ASan LSan Tests (1)',  # No capacity, https://crbug.com/852442
      'Linux TSan Tests',  # No capacity, https://crbug.com/852442
      'Win7 Tests (1)',  # For swarming capacity reasons.
      'Win10 Tests x64 (dbg)',  # flaky: https://crbug.com/852786
      # Only run network service tests on Mac 10.12 for capacity reasons.
      'Mac10.10 Tests',
      'Mac10.11 Tests',
      'Mac10.13 Tests',
      'Mac10.13 Tests (dbg)',
      'Mac ASan 64 Tests (1)',
      'ToTMacASan',
    ],
  },
  'network_service_extensions_browsertests': {
    'remove_from': [
      'CrWinAsan(dll)', # https://crbug.com/935598
      'Linux ASan LSan Tests (1)',  # No capacity, https://crbug.com/852442
      'Linux TSan Tests',  # No capacity, https://crbug.com/852442
      'Win7 Tests (1)',  # For swarming capacity reasons.
      'Win10 Tests x64 (dbg)',  # Matches extensions_browsertests.
      # Only run network service tests on Mac 10.12 for capacity reasons.
      'Mac10.10 Tests',
      'Mac10.11 Tests',
      'Mac10.13 Tests',
      'Mac10.13 Tests (dbg)',
      'Mac ASan 64 Tests (1)',
      'ToTMacASan',
    ],
  },
  'network_service_headless_browsertests': {
    'remove_from': [
      'CrWinAsan(dll)', # https://crbug.com/935598
    ],
  },
  'network_service_interactive_ui_tests': {
    'remove_from': [
      'CrWinAsan(dll)', # https://crbug.com/935598
      'ToTLinuxTSan',  # Match 'Linux TSan Tests' below since this is slow.
      'Linux ASan LSan Tests (1)',  # No capacity, https://crbug.com/852442
      'Linux TSan Tests',  # No capacity, https://crbug.com/852442
      'Win7 Tests (1)',  # For swarming capacity reasons.
      # Only run network service tests on Mac 10.12 for capacity reasons.
      'Mac10.10 Tests',
      'Mac10.11 Tests',
      'Mac10.13 Tests',
      'Mac10.13 Tests (dbg)',
      'Mac ASan 64 Tests (1)',
      'ToTMacASan',
    ],
    'modifications': {
      'Win10 Tests x64 (dbg)': {
        'experiment_percentage': 100,  # https://crbug.com/852786
      },
    },
  },
  'network_service_out_of_process_chrome_public_test_apk': {
    'remove_from': [
      'android-asan',
      # Don't run on trybots; waterfall is enough.
      'android-lollipop-arm-rel',
      'android-marshmallow-arm64-rel',
      'android-pie-arm64-rel',
      # No capacity for tablet testers.
      'Lollipop Tablet Tester',
      'Marshmallow Tablet Tester',
      'android-code-coverage-native', # https://crbug.com/1018780
    ],
    'modifications': {
      'Android CFI': {
        'args': [
          '--exclude-annotation',
          'Feature=RenderTest', # https://crbug.com/1068294
        ],
      },
      'android-pie-x86-rel': {
        'args': [
          '--avd-config=../../tools/android/avd/proto/generic_playstore_android28.textpb',
          # https://crbug.com/1046059
          '--test-launcher-filter-file=../../testing/buildbot/filters/android.emulator.chrome_public_test_apk.filter',
        ],
        'swarming': {
          'named_caches': [
            {
              'name': 'avd_generic_playstore_android28',
              'path': '.android',
            },
            {
              'name': 'system_images_android_28_google_apis_playstore_x86',
              'path': '.emulator_sdk',
            },
          ]
        },
      },
    },
  },
  'network_service_out_of_process_components_browsertests': {
    'remove_from': [
      'android-asan',
      # Don't run on trybots; waterfall is enough.
      'android-lollipop-arm-rel',
      'android-marshmallow-arm64-rel',
      'android-pie-arm64-rel',
      # No capacity for tablet testers.
      'Lollipop Tablet Tester',
      'Marshmallow Tablet Tester',
      'android-code-coverage-native', # crbug/1018434
    ],
  },
  'network_service_out_of_process_content_browsertests': {
    'remove_from': [
      'android-asan',
      # Don't run on trybots; waterfall is enough.
      'android-lollipop-arm-rel',
      'android-marshmallow-arm64-rel',
      'android-pie-arm64-rel',
      # No capacity for tablet testers.
      'Lollipop Tablet Tester',
      'Marshmallow Tablet Tester',
      'android-code-coverage-native', # crbug/1018434
    ],
    'modifications': {
      'android-marshmallow-x86-fyi-rel': {
        'args': [
          '--test-launcher-filter-file=../../testing/buildbot/filters/android.emulator.content_browsertests.filter',
        ],
        'swarming': {
          'shards': 10,
        },
      },
      'android-pie-x86-rel': {
        'args': [
          '--test-launcher-filter-file=../../testing/buildbot/filters/android.emulator.content_browsertests.filter',
        ],
        'swarming': {
          'shards': 10,
        },
      },
    },
  },
  'network_service_out_of_process_content_shell_test_apk': {
    'remove_from': [
      'android-asan',
      # Don't run on trybots; waterfall is enough.
      'android-lollipop-arm-rel',
      'android-marshmallow-arm64-rel',
      'android-pie-arm64-rel',
      # No capacity for tablet testers.
      'Lollipop Tablet Tester',
      'Marshmallow Tablet Tester',
      'android-code-coverage-native', # crbug/1018434
    ],
    'modifications': {
      'android-marshmallow-x86-fyi-rel': {
        'args': [
          '--gtest_filter=-ContentViewScrollingTest.testFling',
        ],
      },
      'android-pie-x86-rel': {
        'args': [
          '--gtest_filter=-ContentViewScrollingTest.testFling',
        ],
      },
    },
  },
  'network_service_webview_instrumentation_test_apk': {
    # Only run these on the phone testers for now due to capacity.
    'remove_from': [
      'android-lollipop-arm-rel',
      'android-marshmallow-arm64-rel',
      'android-pie-arm64-rel',
      'Lollipop Tablet Tester',
      'Marshmallow Tablet Tester',
      'android-asan',  # https://crbug.com/964562
      'Android CFI',
      'ToTAndroid',
      'ToTAndroidCFI',
      'android-code-coverage-native', # https://crbug.com/1018431
    ],
    'modifications': {
      'android-pie-x86-rel': {
        'args': [
          '--test-launcher-filter-file=../../testing/buildbot/filters/android.emulator.webview_instrumentation_test_apk.filter',
        ],
      },
    },
  },
  'not_site_per_process_blink_web_tests': {
    'remove_from': [
      # TODO(dpranke): Should we be running this step on Linux Tests (dbg)(1)?
      'Linux Tests (dbg)(1)',
    ],
    'modifications': {
      'Linux Tests': {
        "args": [
          "--additional-env-var=LLVM_PROFILE_FILE=${ISOLATED_OUTDIR}/profraw/default-%2m.profraw",
        ],
      },
      'linux-code-coverage': {
        'args': [
          '--additional-env-var=LLVM_PROFILE_FILE=${ISOLATED_OUTDIR}/profraw/default-%2m.profraw',
        ],
        'swarming': {
          'shards': 20,
        },
      },
    },
  },
  'notification_helper_unittests': {
    'remove_from': [
      # The test uses WinRT, which only exists in Windows 8 or above.
      # (https://crbug.com/813553)
      'Win 7 Tests x64 (1)',
      'Win7 Tests (1)',
      'Win7 Tests (dbg)(1)',
      # all these bots run Windows 7.
      'ToTWin',
      'ToTWin(dbg)',
      'ToTWin(dll)',
      'ToTWinOfficial',
      'ToTWin64',
      'ToTWin64(dbg)',
      'ToTWin64(dll)',
      'ToTWinCFI',
      'ToTWinCFI64',
      'ToTWinThinLTO64',
    ],
  },
  'ozone_unittests': {
    'modifications': {
      'chromeos-betty-chrome': {
        'args': [
          '--test-launcher-filter-file=../../testing/buildbot/filters/chromeos.ozone_unittests.filter',
        ],
      },
      'chromeos-betty-pi-arc-chrome': {
        'args': [
          '--test-launcher-filter-file=../../testing/buildbot/filters/chromeos.ozone_unittests.filter',
        ],
      },
      'linux-chromeos-chrome': {
        'args': [
          '--test-launcher-filter-file=../../testing/buildbot/filters/chromeos.ozone_unittests.filter',
        ],
      },
    },
  },
  'perfetto_unittests': {
    'remove_from': [
      'android-arm64-proguard-rel',
      'android-asan',
      'android-code-coverage',
      'android-code-coverage-native',
      'android-lollipop-arm-rel',
      'android-marshmallow-arm64-rel',
      'android-marshmallow-x86-fyi-rel',
      'android-pie-arm64-rel',
      'android-pie-x86-rel',
      'Android CFI',
      'Lollipop Phone Tester',
      'Lollipop Tablet Tester',
      'Marshmallow 64 bit Tester',
      'Marshmallow Tablet Tester',
      'Nougat Phone Tester',
      'ToTAndroid',
      'ToTAndroidCFI'
    ]
  },
  'performance_test_suite': {
    'modifications': {
      'Mac10.13 Tests (dbg)': {
        'args': [
          '--browser=debug',
        ],
      },
      'Win10 Tests x64 (dbg)': {
        'args': [
          '--browser=debug_x64',
        ],
        'experiment_percentage': 100,
      },
      'Win7 Tests (dbg)(1)': {
        'args': [
          '--browser=debug',
        ],
      },
    },
  },
  'pixel_skia_gold_test': {
    'replacements': {
      # The V8 builders pass the V8 revision for ${got_revision}, so instead
      # use ${got_cr_revision}, which is only set on the V8 bots.
      'Android V8 FYI Release (Nexus 5X)': {
        'args': {
          '--git-revision': '${got_cr_revision}',
        },
      },
      'Linux V8 FYI Release (NVIDIA)': {
        'args': {
          '--git-revision': '${got_cr_revision}',
        },
      },
      'Linux V8 FYI Release - pointer compression (NVIDIA)': {
        'args': {
          '--git-revision': '${got_cr_revision}',
        },
      },
      'Mac V8 FYI Release (Intel)': {
        'args': {
          '--git-revision': '${got_cr_revision}',
        },
      },
      'Win V8 FYI Release (NVIDIA)': {
        'args': {
          '--git-revision': '${got_cr_revision}',
        },
      },
    },
  },
  'pixel_test':{
    'modifications': {
      'Android Release (Nexus 5X)': {
        'swarming': {
          'shards': 2,
        },
      },
    },
  },
  'rendering_representative_perf_tests': {
    'modifications': {
      'Win10 FYI x64 Exp Release (Intel HD 630)': {
        'args': [
          '--browser=release_x64',
        ],
      },
      'Win10 FYI x64 Exp Release (NVIDIA)': {
        'args': [
          '--browser=release_x64',
        ],
      },
      'Win10 FYI x64 Release (Intel HD 630)': {
        'args': [
          '--browser=release_x64',
        ],
      },
      'Win10 FYI x64 Release (Intel UHD 630)': {
        'args': [
          '--browser=release_x64',
        ],
      },
      'Win10 FYI x64 Release (NVIDIA)': {
        'args': [
          '--browser=release_x64',
        ],
      },
      'Win10 x64 Release (NVIDIA)': {
        'args': [
          '--browser=release_x64',
        ],
      },
      'Win10 x64 Release (NVIDIA) Code Coverage': {
        'args': [
          '--browser=release_x64',
        ],
      },
    },
  },
  'sandbox_linux_unittests': {
    'modifications': {
      'Lollipop Phone Tester': {
        'args': [
          '--shard-timeout=300',
        ],
      },
      'android-lollipop-arm-rel': {
        'args': [
          '--shard-timeout=300',
        ],
      },
      'android-marshmallow-x86-fyi-rel': {
        'args': [
          '--test-launcher-filter-file=../../testing/buildbot/filters/android.emulator.sandbox_linux_unittests.filter',
        ]
      },
      'android-pie-x86-rel': {
        'args': [
          '--test-launcher-filter-file=../../testing/buildbot/filters/android.emulator.sandbox_linux_unittests.filter',
        ]
      },
    },
    'remove_from': [
      'android-asan',  # https://crbug.com/962650
    ],
  },
  'services_unittests': {
    'remove_from': [
      'ToTLinuxMSan',  # https://crbug.com/831676
      # The face and barcode detection tests fail on the Mac Pros.
      'Mac Pro FYI Release (AMD)',
      'Linux ChromiumOS MSan Tests',  # https://crbug.com/831676
      'Linux MSan Tests',  # https://crbug.com/831676
    ],
    'replacements': {
      # TODO(crbug.com/1078982): Remove once the test is fixed on 10.15.4.
      'Mac FYI Experimental Release (Intel)': {
        'args': {
          '--gtest_filter': '*Detection*:-FaceDetectionImplMacTest.ScanOneFace*',
        },
      },
    },
  },
  'skia_renderer_gl_blink_web_tests': {
    'modifications': {
      'Win10 FYI x64 SkiaRenderer GL (NVIDIA)': {
        'args': [
          '--target',
          'Release_x64',
        ],
      },
    },
  },
  'storage_service_unsandboxed_content_browsertests': {
    'modifications': {
      'Linux Tests (dbg)(1)': {
        'swarming': {
          'shards': 4,
        },
      },
    },
  },
  'storage_service_unsandboxed_interactive_ui_tests': {
    'modifications': {
      'linux-chromeos-chrome': {
        # TODO(crbug.com/970649): Remove this filter.
        'args': [
          '--gtest_filter=-SadTabViewInteractiveUITest.ReloadMultipleSadTabs',
        ],
      },
    }
  },
  'swiftshader_unittests': {
    'remove_from': [
      # Save capacity on the hardware where we have only a few machines.
      'Mac FYI Experimental Release (Intel)',
      'Mac FYI Experimental Retina Release (AMD)',
      'Mac FYI Experimental Retina Release (NVIDIA)',
      'Mac Pro FYI Release (AMD)',
    ],
  },
  'sync_integration_tests': {
    'remove_from': [
      'CrWinAsan(dll)', # https://crbug.com/935598
    ],
    'modifications': {
      'Linux ASan LSan Tests (1)': {
        'swarming': {
          'shards': 4,
        },
      },
      'Linux TSan Tests': {
        'swarming': {
          'shards': 6,
        },
      },
      'ToTLinuxTSan': {
        'swarming': {
          'shards': 6,
        },
      },
      'Win10 Tests x64 (dbg)': {
        'experiment_percentage': 100, # https://crbug.com/840369
      },
      'Win7 Tests (dbg)(1)': {
        'swarming': {
          'shards': 2,
        },
      },
      'linux-chromeos-code-coverage': {
        'swarming': {
          'shards': 4,
        },
      },
      'linux-code-coverage': {
        'swarming': {
          'shards': 4,
        },
      },
    },
  },
  'tab_capture_end2end_tests': {
    # Run these only on Release bots.
    'remove_from': [
      'Linux Debug (NVIDIA)',
      'Mac Debug (Intel)',
      'Mac Retina Debug (AMD)',
      'Win10 FYI x64 Debug (NVIDIA)',
      'Win7 FYI Debug (AMD)',
      # Disabled due to dbus crashes crbug.com/927465
      'Linux FYI Release (Intel HD 630)',
      'Linux FYI Release (Intel UHD 630)',
      'Linux FYI Release (NVIDIA)',
      'Linux FYI SkiaRenderer Vulkan (Intel HD 630)',
      'Linux FYI SkiaRenderer Vulkan (NVIDIA)',
      'Linux Release (NVIDIA)',
    ],
  },
  'telemetry_monochrome_minidump_unittests': {
    'remove_from': [
      # Monochrome isn't supported on M.
      'android-marshmallow-arm64-rel',
      'android-marshmallow-x86-fyi-rel',
    ],
  },
  'telemetry_perf_unittests': {
    'modifications': {
      'Linux Tests': {
        'args': [
          '--xvfb',
          '--jobs=1',
        ],
      },
      'Linux Tests (dbg)(1)': {
        'args': [
          '--xvfb',
          '--jobs=1',
        ],
      },
      # Disable parallelism on all Mac bots.
      'Mac10.10 Tests': {
        'args': [
          '--jobs=1',
        ],
      },
      'Mac10.11 Tests': {
        'args': [
          '--jobs=1',
        ],
      },
      'Mac10.12 Tests': {
        'args': [
          '--jobs=1',
        ],
      },
      'Win7 Tests (dbg)(1)': {
        'args': [
          '--jobs=1',
        ],
        'swarming': {
          'shards': 20,
        },
        'experiment_percentage': 100,
      },
      'linux-chromium-tests-staging-tests': {
        'args': [
          '--xvfb',
          '--jobs=1',
        ],
      },
      'linux-trusty-rel': {
        'args': [
          '--xvfb',
          '--jobs=1',
        ],
      },
    },
    'remove_from': [
      # There's no need to run telemetry_perf_unittests on both lollipop and
      # marshmallow on the CQ. https://crbug.com/1026487.
      'android-marshmallow-arm64-rel',
      'android-pie-arm64-rel',
      # crbug.com/936540
      'Mac10.10 Tests',
      'Mac10.11 Tests',
      'Mac10.13 Tests',
      'Mac10.13 Tests (dbg)',
      'Linux - Future (dbg)',  # client.v8.chromium
      'Win10 Tests x64',
      'Win10 Tests x64 (dbg)',
      'Win10 Tests x64 Code Coverage',
    ],
  },
  'telemetry_unittests': {
    'modifications': {
      'Win10 Tests x64 (dbg)': {
        'experiment_percentage': 100,  # crbug.com/870673
      }
    },
    'remove_from': [
      # crbug.com/936540
      'Mac10.10 Tests',
      'Mac10.11 Tests',

      'Win10 Tests x64',
      'Win10 Tests x64 Code Coverage',
    ],
  },
  'test_buildbucket_api_gpu_use_cases': {
    'remove_from': [
      # crbug.com/1080749
      'Optional Linux Release (NVIDIA)',
    ],
  },
  'unit_tests': {
    'remove_from': [
      'android-code-coverage-native', # crbug/1018434
      # There's no need to run unit_tests on both lollipop and marshmallow
      # on the CQ. https://crbug.com/1026487.
      'android-marshmallow-arm64-rel',
    ],
    'modifications': {
      'Linux ASan LSan Tests (1)': {
        # These are slow on the ASAN trybot for some reason.
        # crbug.com/794372
        'swarming': {
          'shards': 4,
        },
      },
      'Linux Chromium OS ASan LSan Tests (1)': {
        # These are slow on the ASAN trybot for some reason.
        # crbug.com/794372
        'swarming': {
          'shards': 2,
        },
      },
      'Linux ChromiumOS MSan Tests': {
        # These are very slow on the Chrome OS MSAN trybot for some reason.
        # crbug.com/865455
        'swarming': {
          'shards': 2,
        },
      },
      'Linux TSan Tests': {
        'swarming': {
          'shards': 2,
        },
      },
      'ToTLinuxASan': {
        'swarming': {
          'shards': 2,
        },
      },
      'android-asan': {
        'args': [
          '--test-launcher-filter-file=../../testing/buildbot/filters/android.asan.unit_tests.filter',
        ],
      },
      'android-marshmallow-arm64-rel-swarming': {
        'swarming': {
          'shards': 8,
        },
      },
      'android-pie-arm64-rel': {
        'experiment_percentage': 100, # https://crbug.com/1010211
      },
      'linux-chromeos-chrome': {
        'args': [
          '--test-launcher-filter-file=../../testing/buildbot/filters/chromeos.unit_tests.filter',
        ],
      },
      'linux-chromeos-dbg': {
        'swarming': {
          'shards': 2,
        },
      },
      'linux-chromeos-rel': {
        'swarming': {
          'shards': 2,
        },
      },
    },
  },
  'url_unittests': {
    'remove_from': [
      # crbug.com/1054240
      'Fuchsia ARM64',
    ],
  },
  'video_decode_accelerator_gl_unittest': {
    'remove_from': [
      # Windows Intel doesn't have the GL extensions to support this test.
      'ANGLE GPU Win10 x64 Release (Intel HD 630)',
      'Optional Win10 x64 Release (Intel HD 630)',
      'Win10 FYI x64 Release (Intel HD 630)',
      'Win10 FYI x64 Release (Intel UHD 630)',
      'Win10 FYI x64 Exp Release (Intel HD 630)',
    ],
  },
  'views_unittests_wayland': {
    'modifications': {
      'Linux Ozone Tester (Wayland)': {
        'args': [
          '--test-launcher-filter-file=../../testing/buildbot/filters/ozone-linux.wayland_views_unittests.filter',
        ],
      },
    },
  },
  'views_unittests_x11': {
    'modifications': {
      'Linux Ozone Tester (X11)': {
        'args': [
          '--test-launcher-filter-file=../../testing/buildbot/filters/ozone-linux.x11_views_unittests.filter',
        ],
      },
    },
  },
  'viz_unittests': {
    'modifications': {
      'android-marshmallow-x86-fyi-rel': {
        'args': [
          '--test-launcher-filter-file=../../testing/buildbot/filters/android.emulator.viz_unittests.filter',
        ],
      },
      'android-pie-x86-rel': {
        'args': [
          '--test-launcher-filter-file=../../testing/buildbot/filters/android.emulator.viz_unittests.filter',
        ],
      },
    },
  },
  'vr_android_unittests': {
    'remove_from': [
      'android-marshmallow-x86-fyi-rel',
      'android-pie-x86-rel',
      'android-code-coverage-native', # crbug/1018434
    ],
  },
  'vr_common_unittests': {
    'remove_from': [
      'android-marshmallow-x86-fyi-rel',
      'android-pie-x86-rel',
      'android-code-coverage-native', # crbug/1018431
    ],
  },
  'vr_pixeltests': {
    'remove_from': [
      'android-marshmallow-x86-fyi-rel',
      'android-pie-x86-rel',
      'VR Linux',
      'android-code-coverage-native', # crbug/1018431
      # These tests fail on Win7, and given that We don't support VR there,
      # these tests are unnecessary there.
      # chromium.win
      'Win 7 Tests x64 (1)',
      'Win7 Tests (1)',
      'Win7 Tests (dbg)(1)',
    ],
  },
  'wayland_client_perftests': {
    'remove_from': [
      'linux-chromeos-dbg',  # https://crbug.com/859307
    ],
  },
  'webdriver_tests_suite': {
    'remove_from': [
      'Linux Tests',  # https://crbug.com/929689, https://crbug.com/936557
    ],
  },
  'webgl2_conformance_gl_passthrough_tests': {
    'remove_from': [
      # Not enough capacity. https://crbug.com/946694
      'ANGLE GPU Win10 x64 Release (Intel HD 630)',
      # Not enough capacity. https://crbug.com/982294
      'Mac Pro FYI Release (AMD)',
      'Mac FYI Retina Release (NVIDIA)',
    ],
  },
  'webgl2_conformance_validating_tests': {
    'remove_from': [
      # The Mac NVIDIA Retina bots don't have the capacity to run
      # this test suite on mac_optional_gpu_tests_rel.
      'Optional Mac Retina Release (NVIDIA)',
    ],
    'modifications': {
      'Mac FYI GPU ASAN Release': {
        'args': [
          '--is-asan',
        ]
      },
    },
  },
  'webgl_conformance_gl_passthrough_tests': {
    'remove_from': [
      # crbug.com/555545 and crbug.com/649824:
      # Disable webgl_conformance_gl_tests on some Win/AMD cards.
      # Always fails on older cards, flaky on newer cards.
      'Win7 FYI Debug (AMD)',
      'Win7 FYI Release (AMD)',
      # crbug.com/1005814
      'Win10 FYI x64 Release (AMD RX 550)',
    ],
  },
  'webgl_conformance_tests': {
    'modifications': {
      # On desktop platforms these don't take very long (~7 minutes),
      # but on Android they take ~30 minutes and we want to use more
      # shards than on desktop.
      'Android Release (Nexus 5X)': {
        'swarming': {
          'shards': 6,
        },
      },
      'chromeos-amd64-generic-rel': {
        'swarming': {
          'shards': 12,
        },
      },
    },
    'replacements': {
      'chromeos-kevin-rel-hw-tests': {
        # Replace VM args with the magic hostname that resolves to a CrOS
        # device in the test lab.
        'args': {
          '--remote': 'variable_chromeos_device_hostname',
          '--remote-ssh-port': None,
        },
      },
    },
    'remove_from': [
      # Too slow on this configuration, which is severely hardware
      # constrained. crbug.com/950690
      'Mac FYI Retina Debug (NVIDIA)',
    ],
  },
  'webgl_conformance_validating_tests': {
    'modifications': {
      'Mac FYI GPU ASAN Release': {
        'args': [
          '--is-asan',
        ]
      },
    },
  },
  'webgl_conformance_vulkan_passthrough_tests': {
    'remove_from': [
      'Win7 FYI Debug (AMD)',
    ],
  },
  'webkit_unit_tests': {
    'remove_from': [
      # Flakily fails on Win7. https://crbug.com/943372.
      'Win7 Tests (1)',
      'Win 7 Tests x64 (1)',
      'android-code-coverage-native', # crbug/1018431
    ],
    'modifications': {
      'Linux ASan LSan Tests (1)': {
        # These are very slow on the ASAN trybot for some reason.
        # crbug.com/794372
        'swarming': {
          'shards': 5,
        },
      },
      'Linux TSan Tests': {
        'swarming': {
          'shards': 2,
        },
      },
      'Marshmallow 64 bit Tester': {
        # Increase timeout. See https://crbug.com/847229.
        'swarming': {
          'hard_timeout': 1200,
        },
      },
      'linux-blink-heap-concurrent-marking-tsan-rel': {
        'swarming': {
          'shards': 2,
        },
      },
    },
  },
  'webview_instrumentation_test_apk': {
    'remove_from': [
      # This test frequently fails on Android, https://crbug.com/824959
      'android-lollipop-arm-rel',
      # matching android builders, the test fails on these.
      'ToTAndroid',
      'android-asan',  # https://crbug.com/964562
      # On chromium.swarm, this should possibly be being run (or removed
      # from android-marshmallow-arm64-rel-swarming).
      'android-lollipop-arm-rel-swarming',
      'android-code-coverage-native', # https://crbug.com/1018431
    ],
    'modifications': {
      # chromium.android.fyi
      'Android WebView P FYI (rel)': {
        'args': [
          '--annotation',
          'DisabledTest,FlakyTest' # Monitor status of disabled tests.
        ],
      },
      'Oreo Phone Tester': {
        # TODO(crbug.com/997362): Enable this once it's passing.
        # TODO(https://crbug.com/884413): Re-enable this once the tests are
        # either passing or there is more capacity.
        'experiment_percentage': 0,
      },
      'android-pie-x86-rel': {
        'args': [
          '--test-launcher-filter-file=../../testing/buildbot/filters/android.emulator.webview_instrumentation_test_apk.filter',
        ],
      },
    },
  },
  'xr_browser_tests': {
    'remove_from': [
      # Randomly hangs indefinitely https://crbug.com/1018896.
      'Win10 FYI x64 Release (AMD RX 550)',
      # This exception probably needs to stay due to lack of capacity
      # on the Win AMD bots.
      'Win7 FYI Debug (AMD)',
      # Fails on the bot, http://crbug.com/868143
      'Win7 FYI Release (AMD)',
    ],
  },
}
