<!DOCTYPE html>
<script src="../resources/testharness.js"></script>
<script src="../resources/testharnessreport.js"></script>
<script src="file:///gen/layout_test_data/mojo/public/js/mojo_bindings.js"></script>
<script src="file:///gen/third_party/blink/public/mojom/webshare/webshare.mojom.js"></script>
<script src="resources/mock-share-service.js"></script>
<script>

function getAbsoluteUrl(url) {
  return new URL(url, document.baseURI).toString();
}

share_test(mock => {
  mock.pushShareResult('true', 'the object', 'http://example.com/',
                       blink.mojom.ShareError.OK);

  const textWithToString = {toString() { return 'the object'; }};
  const urlWithToString = {toString() { return 'http://example.com/'; }};
  return callWithKeyDown(() => navigator.share(
        {title: true, text: textWithToString, url: urlWithToString}));
}, 'share of types other than string (expect implicitly converted to string)');

share_test(mock => {
  // null fields should convert into the string 'null' (because the field is
  // not nullable, it just converts to a string like any other type).
  mock.pushShareResult('null', '', '',
                       blink.mojom.ShareError.OK);
  return callWithKeyDown(() => navigator.share(
        {title: null, text: undefined}));
}, 'share of null/undefined dict values');

</script>
