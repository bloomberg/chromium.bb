# Copyright 2020 The Chromium Authors. All rights reserved.
# Use of this source code is governed by a BSD-style license that can be
# found in the LICENSE file.

# This config is applied to targets that depend on libhwy
config("libhwy_external_config") {
  include_dirs = [ "src" ]
  defines = []
  if (is_win) {
    # Compiling AVX2/3 on Windows produces a warning and disabled those targets.
    # TODO(deymo): Validate if these targets are actually broken in Windows.
    defines += [ "HWY_BROKEN_TARGETS=(HWY_AVX2|HWY_AVX3)" ]
    if (target_cpu == "arm64") {
      # TODO(richard.townsend@arm.com): investigate why these flags are needed.
      cflags = [
        "-Wno-uninitialized",
        "-Wno-unused-const-variable",
      ]
    }
  }
}

source_set("libhwy") {
  sources = [
    "src/hwy/aligned_allocator.cc",
    "src/hwy/targets.cc",
  ]

  public_configs = [ ":libhwy_external_config" ]
}
