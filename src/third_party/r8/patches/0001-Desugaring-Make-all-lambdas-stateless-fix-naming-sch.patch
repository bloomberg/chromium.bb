From 43c8250f2420c41640305d68b9d4512d69b850b0 Mon Sep 17 00:00:00 2001
From: Sam Maier <smaier@chromium.org>
Date: Tue, 19 May 2020 15:55:44 -0400
Subject: [PATCH 1/3] Desugaring: Make all lambdas stateless & fix naming
 scheme of method references

Statefull lambdas regress dex size.

Bug: b/129997269
---
 .../java/com/android/tools/r8/ir/desugar/LambdaClass.java    | 5 +++--
 1 file changed, 3 insertions(+), 2 deletions(-)

diff --git a/src/main/java/com/android/tools/r8/ir/desugar/LambdaClass.java b/src/main/java/com/android/tools/r8/ir/desugar/LambdaClass.java
index c9e47c259..b5b72c0ab 100644
--- a/src/main/java/com/android/tools/r8/ir/desugar/LambdaClass.java
+++ b/src/main/java/com/android/tools/r8/ir/desugar/LambdaClass.java
@@ -130,7 +130,8 @@ public final class LambdaClass {
     // If the lambda class should match 1:1 the class it is accessed from, we
     // just add the name of this type to make lambda class name unique.
     // It also helps link the class lambda originated from in some cases.
-    if (match.delegatesToLambdaImplMethod() || match.needsAccessor(accessedFrom)) {
+    if (true || match.delegatesToLambdaImplMethod() || match.needsAccessor(accessedFrom)) {
+      // Chrome: This class name is required for supersize to map the symbol to source .java file.
       lambdaClassDescriptor.append(accessedFrom.getHolderType().getName()).append('$');
     }
 
@@ -209,7 +210,7 @@ public final class LambdaClass {
   }
 
   public final boolean isStateless() {
-    return descriptor.isStateless();
+    return false; // descriptor.isStateless();
   }
 
   void addSynthesizedFrom(DexProgramClass clazz) {
-- 
2.29.2.299.gdc1121823c-goog

