<!DOCTYPE html>
<style>
  #block { color: green; }
  #block::first-line { color: red; }
  .green { color: green; }
</style>
<div id="block">
  <div>
    <p>Red <span id="t"><span>This text should be green.<span></span> Red</p>
  </div>
</div>
<script src="../../resources/run-after-layout-and-paint.js"></script>
<script>
runAfterLayoutAndPaint(function() {
  document.getElementById('t').className = 'green';
}, true);
</script>
