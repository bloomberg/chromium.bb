# Copyright 2020 The Chromium Authors. All rights reserved.
# Use of this source code is governed by a BSD-style license that can be
# found in the LICENSE file.

# Import list of source files and flags from the jpeg-xl project.
import("src/lib/lib.gni")

# This config is applied to targets that depend on libjxl.
config("libjxl_external_config") {
  include_dirs = [
    # Path to the public headers.
    "src/lib/include",

    # Configuration headers normally generated by the cmake build system.
    "gen_headers",
  ]
}

source_set("libjxl") {
  # TODO(deymo): Remove libjxl_enc_sources when there are not dependencies
  # into it.
  sources = rebase_path(libjxl_dec_sources + libjxl_enc_sources, ".", "src/lib")

  cflags_cc = [ "-Wno-unused-function" ]

  defines = libjxl_version_defines + [ "JPEGXL_ENABLE_SKCMS=1" ]

  include_dirs = [
    "src",
    "//third_party/skia/include/third_party/skcms",  # for "skcms.h"
  ]

  deps = [
    "//skia:skcms",
    "//third_party/brotli:dec",

    # TODO(deymo): Compile only the decoder-side files.
    "//third_party/brotli:enc",
    "//third_party/highway:libhwy",
  ]

  public_configs = [ ":libjxl_external_config" ]
}
