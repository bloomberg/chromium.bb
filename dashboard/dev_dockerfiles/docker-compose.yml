version: "3"
services:
  make:
    build: .
    volumes:
      - ../..:/catapult
    command: [bash, -xc, "make clean && make"]
    working_dir: /catapult/dashboard/dashboard
  python-unittest:
    build: .
    volumes:
      - ../..:/catapult
    command:
      [/catapult/dashboard/bin/run_py_tests]
  deploy:
    build: .
    volumes:
      - ../..:/catapult
      - gcloud-config:/root/.config/gcloud
    command:
      [/catapult/dashboard/bin/deploy, app.yaml, --promote]
  auth:
    build: .
    volumes:
      - ../..:/catapult
      - gcloud-config:/root/.config/gcloud
    command: [bash, -xc, "gcloud auth login && gcloud config set project chromeper"]
networks:
  default:
    external:
      name: host
volumes:
  gcloud-config: