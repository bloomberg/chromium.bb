<!DOCTYPE html>
<meta charset="UTF-8">
<body>
<script src="../interpolation/resources/interpolation-test.js"></script>
<script>
assertComposition({
  property: 'backdrop-filter',
  underlying: 'blur(10px)',
  addFrom: 'blur(40px)',
  addTo: 'blur(90px)',
}, [
  {at: -0.5, is: 'blur(10px) blur(15px)'},
  {at: 0, is: 'blur(10px) blur(40px)'},
  {at: 0.25, is: 'blur(10px) blur(52.5px)'},
  {at: 0.5, is: 'blur(10px) blur(65px)'},
  {at: 0.75, is: 'blur(10px) blur(77.5px)'},
  {at: 1, is: 'blur(10px) blur(90px)'},
  {at: 1.5, is: 'blur(10px) blur(115px)'},
]);

// Here we have add-from and replace-to, so the list will be have mismatched
// lengths and the replace-to list will have to be extended to interpolate as
// per https://drafts.fxtf.org/filter-effects-1/#interpolation-of-filters
//
// That is, this becomes an interpolation of the form:
//   sepia(0.5) sepia(0.5) --> sepia(1) sepia(0)
assertComposition({
  property: 'backdrop-filter',
  underlying: 'sepia(0.5)',
  addFrom: 'sepia(0.5)',
  replaceTo: 'sepia(1)',
}, [
  {at: -0.5, is: 'sepia(0.25) sepia(0.75)'},
  {at: 0, is: 'sepia(0.5) sepia(0.5)'},
  {at: 0.25, is: 'sepia(0.625) sepia(0.375)'},
  {at: 0.5, is: 'sepia(0.75) sepia(0.25)'},
  {at: 0.75, is: 'sepia(0.875) sepia(0.125)'},
  {at: 1, is: 'sepia(1) sepia(0)'},
  {at: 1.5, is: 'sepia(1) sepia(0)'},
]);

// In this case we have replace-from and add-to, so similar extending behavior
// takes place. Note that brightness has an initial value of 1.
//
// That is, this becomes an interpolation of the form:
//   brightness(0.5) brightness(1) --> brightness(0) brightness(1.5)
assertComposition({
  property: 'backdrop-filter',
  underlying: 'brightness(0)',
  replaceFrom: 'brightness(0.5)',
  addTo: 'brightness(1.5)',
}, [
  {at: -0.5, is: 'brightness(0.75) brightness(0.75)'},
  {at: 0, is: 'brightness(0.5) brightness(1)'},
  {at: 0.25, is: 'brightness(0.375) brightness(1.125)'},
  {at: 0.5, is: 'brightness(0.25) brightness(1.25)'},
  {at: 0.75, is: 'brightness(0.125) brightness(1.375)'},
  {at: 1, is: 'brightness(0) brightness(1.5)'},
  {at: 1.5, is: 'brightness(0) brightness(1.75)'},
]);

// Test mixing properties.
assertComposition({
  property: 'backdrop-filter',
  underlying: 'invert(0.5)',
  addFrom: 'saturate(2)',
  addTo: 'saturate(3)',
}, [
  {at: -0.5, is: 'invert(0.5) saturate(1.5)'},
  {at: 0, is: 'invert(0.5) saturate(2)'},
  {at: 0.25, is: 'invert(0.5) saturate(2.25)'},
  {at: 0.5, is: 'invert(0.5) saturate(2.5)'},
  {at: 0.75, is: 'invert(0.5) saturate(2.75)'},
  {at: 1, is: 'invert(0.5) saturate(3)'},
  {at: 1.5, is: 'invert(0.5) saturate(3.5)'},
]);

// Test the 'none' behavior; composition happens before interpolation, so this
// is actually an interpolation of:
//   invert(0.5) saturate(1) --> invert(1) saturate(3)
assertComposition({
  property: 'backdrop-filter',
  underlying: 'invert(0.5)',
  addFrom: 'none',
  replaceTo: 'invert(1) saturate(3)',
}, [
  {at: -0.5, is: 'invert(0.25) saturate(0)'},
  {at: 0, is: 'invert(0.5) saturate(1)'},
  {at: 0.25, is: 'invert(0.625) saturate(1.5)'},
  {at: 0.5, is: 'invert(0.75) saturate(2)'},
  {at: 0.75, is: 'invert(0.875) saturate(2.5)'},
  {at: 1, is: 'invert(1) saturate(3)'},
  {at: 1.5, is: 'invert(1.25) saturate(4)'},
]);

// Test having multiple underlying values
assertComposition({
  property: 'backdrop-filter',
  underlying: 'grayscale(25%) blur(10px)',
  addFrom: 'brightness(0)',
  addTo: 'brightness(1)',
}, [
  {at: -0.5, is: 'grayscale(25%) blur(10px) brightness(0)'},
  {at: 0, is: 'grayscale(25%) blur(10px) brightness(0)'},
  {at: 0.25, is: 'grayscale(25%) blur(10px) brightness(0.25)'},
  {at: 0.5, is: 'grayscale(25%) blur(10px) brightness(0.5)'},
  {at: 0.75, is: 'grayscale(25%) blur(10px) brightness(0.75)'},
  {at: 1, is: 'grayscale(25%) blur(10px) brightness(1)'},
  {at: 1.5, is: 'grayscale(25%) blur(10px) brightness(1.5)'},
]);

// Make sure that a matching underlying value is still prefixed.
assertComposition({
  property: 'backdrop-filter',
  underlying: 'blur(10px)',
  addFrom: 'grayscale(50%) blur(10px)',
  addTo: 'grayscale(25%) blur(10px)',
}, [
  {at: -0.5, is: 'blur(10px) grayscale(0.625) blur(10px)'},
  {at: 0, is: 'blur(10px) grayscale(0.5) blur(10px)'},
  {at: 0.25, is: 'blur(10px) grayscale(0.4375) blur(10px)'},
  {at: 0.5, is: 'blur(10px) grayscale(0.375) blur(10px)'},
  {at: 0.75, is: 'blur(10px) grayscale(0.3125) blur(10px)'},
  {at: 1, is: 'blur(10px) grayscale(0.25) blur(10px)'},
  {at: 1.5, is: 'blur(10px) grayscale(0.125) blur(10px)'},
]);

// Check the case where composition causes a url() to be included; the animation
// should change to discrete.
assertComposition({
  property: 'backdrop-filter',
  underlying: 'url(#a)',
  addFrom: 'grayscale(50%) blur(30px)',
  addTo: 'grayscale(25%) blur(40px)',
}, [
  {at: -0.5, is: 'url("#a") grayscale(0.5) blur(30px)'},
  {at: 0, is: 'url("#a") grayscale(0.5) blur(30px)'},
  {at: 0.25, is: 'url("#a") grayscale(0.5) blur(30px)'},
  {at: 0.5, is: 'url("#a") grayscale(0.25) blur(40px)'},
  {at: 0.75, is: 'url("#a") grayscale(0.25) blur(40px)'},
  {at: 1, is: 'url("#a") grayscale(0.25) blur(40px)'},
  {at: 1.5, is: 'url("#a") grayscale(0.25) blur(40px)'},
]);

// And check the inverse; nothing fancy here but it should be a discrete
// animation with blur prepended.
assertComposition({
  property: 'backdrop-filter',
  underlying: 'blur(10px)',
  addFrom: 'url(#a) brightness(1)',
  addTo: 'url(#b) brightness(0)',
}, [
  {at: -0.5, is: 'blur(10px) url(#a) brightness(1)'},
  {at: 0, is: 'blur(10px) url(#a) brightness(1)'},
  {at: 0.25, is: 'blur(10px) url(#a) brightness(1)'},
  {at: 0.5, is: 'blur(10px) url(#b) brightness(0)'},
  {at: 0.75, is: 'blur(10px) url(#b) brightness(0)'},
  {at: 1, is: 'blur(10px) url(#b) brightness(0)'},
  {at: 1.5, is: 'blur(10px) url(#b) brightness(0)'},
]);
</script>
</body>
