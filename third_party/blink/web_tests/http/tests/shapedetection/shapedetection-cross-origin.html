<!DOCTYPE html>
<script src=../../../../resources/testharness.js></script>
<script src=../../../../resources/testharnessreport.js></script>
<script>

// http:// resources are considered cross-origin from the current file://.
const IMAGE_URL = "http://localhost:8080/security/resources/abe.png";
const VIDEO_URL = "http://localhost:8080/external/wpt/media/white.webm";

// Verifies that TextDetector rejects a cross-origin HTMLImageElement.
promise_test(async t => {
  const img = new Image();
  const imgWatcher = new EventWatcher(t, img, ["load", "error"]);
  img.src = IMAGE_URL;
  await imgWatcher.wait_for("load");
  const detector = new TextDetector();
  await promise_rejects(t, "SecurityError", detector.detect(img));
},
"TextDetector should reject cross-origin HTMLImageElements with a SecurityError.");

// Verifies that TextDetector rejects a cross-origin ImageBitmap.
promise_test(async t => {
  const img = new Image();
  const imgWatcher = new EventWatcher(t, img, ["load", "error"]);
  img.src = IMAGE_URL;
  await imgWatcher.wait_for("load");
  const imgBitmap = await createImageBitmap(img);
  const detector = new TextDetector();
  await promise_rejects(t, "SecurityError", detector.detect(imgBitmap));
},
"TextDetector should reject cross-origin ImageBitmaps with a SecurityError.");

// Verifies that TextDetector rejects a cross-origin HTMLVideoElement.
promise_test(async t => {
  const video = document.createElement('video');
  const videoWatcher = new EventWatcher(t, video, ["load", "error"]);
  video.src = VIDEO_URL;
  await videoWatcher.wait_for("error");
  const detector = new TextDetector();
  await promise_rejects(t, "SecurityError", detector.detect(video));
},
"TextDetector should reject cross-origin HTMLVideoElements with a SecurityError.");

// Verifies that TextDetector rejects a cross-origin HTMLCanvasElement.
promise_test(async t => {
  const img = new Image();
  const imgWatcher = new EventWatcher(t, img, ["load", "error"]);
  img.src = IMAGE_URL;
  await imgWatcher.wait_for("load");
  const canvas = document.createElement("canvas");
  canvas.getContext("2d").drawImage(img, 0, 0);
  const detector = new TextDetector();
  await promise_rejects(t, "SecurityError", detector.detect(canvas));
},
"TextDetector should reject cross-origin HTMLCanvasElements with a SecurityError.");

</script>
