// Copyright 2014 The Chromium Authors. All rights reserved.
// Use of this source code is governed by a BSD-style license that can be
// found in the LICENSE file.

// This file has been auto-generated by code_generator_v8.py. DO NOT MODIFY!

// clang-format off

#include "AnyCallbackFunctionOptionalAnyArg.h"

#include "bindings/core/v8/ExceptionState.h"
#include "bindings/core/v8/ScriptState.h"
#include "bindings/core/v8/ScriptValue.h"
#include "bindings/core/v8/ToV8.h"
#include "bindings/core/v8/V8Binding.h"
#include "core/dom/ExecutionContext.h"
#include "wtf/Assertions.h"

namespace blink {

AnyCallbackFunctionOptionalAnyArg::AnyCallbackFunctionOptionalAnyArg(v8::Isolate* isolate, v8::Local<v8::Function> callback)
    : m_callback(isolate, callback)
{
    DCHECK(!m_callback.isEmpty());
    m_callback.setPhantom();
}

DEFINE_TRACE(AnyCallbackFunctionOptionalAnyArg)
{
}

DEFINE_TRACE_WRAPPERS(AnyCallbackFunctionOptionalAnyArg)
{
    visitor->traceWrappers(&m_callback.cast<v8::Object>());
}

bool AnyCallbackFunctionOptionalAnyArg::call(ScriptState* scriptState, ScriptWrappable* scriptWrappable, ScriptValue optionalAnyArg, ScriptValue& returnValue)
{
    if (!scriptState->contextIsValid())
        return false;

    ExecutionContext* context = scriptState->getExecutionContext();
    DCHECK(context);
    if (context->activeDOMObjectsAreSuspended() || context->activeDOMObjectsAreStopped())
        return false;

    if (m_callback.isEmpty())
        return false;

    // TODO(bashi): Make sure that using TrackExceptionState is OK.
    // crbug.com/653769
    TrackExceptionState exceptionState;
    ScriptState::Scope scope(scriptState);

    v8::Local<v8::Value> optionalAnyArgArgument = optionalAnyArg.v8Value();

    v8::Local<v8::Value> thisValue = toV8(scriptWrappable, scriptState->context()->Global(), scriptState->isolate());

    v8::Local<v8::Value> argv[] = { optionalAnyArgArgument };

    v8::Local<v8::Value> v8ReturnValue;
    v8::TryCatch exceptionCatcher(scriptState->isolate());
    exceptionCatcher.SetVerbose(true);

    if (V8ScriptRunner::callFunction(m_callback.newLocal(scriptState->isolate()), scriptState->getExecutionContext(), thisValue, 1, argv, scriptState->isolate()).ToLocal(&v8ReturnValue))
    {
        ScriptValue cppValue = ScriptValue(ScriptState::current(scriptState->isolate()), v8ReturnValue);
        returnValue = cppValue;
        return true;
    }
    return false;
}

} // namespace blink
