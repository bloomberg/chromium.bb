// Copyright 2016 The Chromium Authors. All rights reserved.
// Use of this source code is governed by a BSD-style license that can be
// found in the LICENSE file.

#include "core/editing/Editor.h"

#include "core/clipboard/Pasteboard.h"
#include "core/editing/commands/EditorCommand.h"
#include "core/editing/testing/EditingTestBase.h"
#include "core/html/forms/HTMLInputElement.h"

namespace blink {

class EditorTest : public EditingTestBase {
};

TEST_F(EditorTest, copyGeneratedPassword) {
  // Checks that if the password field has the value generated by Chrome
  // (HTMLInputElement::shouldRevealPassword will be true), copying the field
  // should be available.
  const char* body_content = "<input type='password' id='password'></input>";
  SetBodyContent(body_content);

  HTMLInputElement& element =
      ToHTMLInputElement(*GetDocument().getElementById("password"));

  const String kPasswordValue = "secret";
  element.focus();
  element.setValue(kPasswordValue);
  element.SetSelectionRange(0, kPasswordValue.length());

  Editor& editor = GetDocument().GetFrame()->GetEditor();
  EXPECT_FALSE(editor.CanCopy());

  element.SetShouldRevealPassword(true);
  EXPECT_TRUE(editor.CanCopy());
}

TEST_F(EditorTest, DontCopyHiddenSelections) {
  const char* body_content =
      "<input type=checkbox id=checkbox>"
      "<input id=hiding value=HEY></input>";
  SetBodyContent(body_content);

  HTMLInputElement& text_control =
      ToHTMLInputElement(*GetDocument().getElementById("hiding"));
  text_control.select();

  HTMLInputElement& checkbox =
      ToHTMLInputElement(*GetDocument().getElementById("checkbox"));
  checkbox.focus();

  Editor& editor = GetDocument().GetFrame()->GetEditor();
  editor.CreateCommand("Copy").Execute();

  const String copied = Pasteboard::GeneralPasteboard()->PlainText();
  EXPECT_TRUE(copied.IsEmpty()) << copied << " was copied.";
}

}  // namespace blink
