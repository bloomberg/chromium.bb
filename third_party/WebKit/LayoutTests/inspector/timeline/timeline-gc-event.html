<html>
<head>
<script src="../../http/tests/inspector/inspector-test.js"></script>
<script src="../../http/tests/inspector/timeline-test.js"></script>
<script>

function produceGarbageForGCEvents(callback)
{
    if (window.testRunner) {
        window.gc();
        testRunner.displayAsyncThen(callback);
    }
}

function test()
{
    InspectorTest.invokeAsyncWithTimeline("produceGarbageForGCEvents", validate);

    function validate(records)
    {
        var gcRecords = InspectorTest.filterTimelineRecords(WebInspector.TimelineModel.RecordType.GCEvent, true);
        if (gcRecords.length) {
            InspectorTest.addResult("The expected GC event record");
            InspectorTest.addObject(gcRecords[0], InspectorTest.timelinePropertyFormatters);
        } else {
            InspectorTest.addResult("FAILED: GC event record wasn't found");
        }

        InspectorTest.completeTest();
    }
}

</script>
</head>

<body onload="runTest()">
<p>
Tests the Timeline API instrumentation of a gc event
</p>
</body>
</html>
