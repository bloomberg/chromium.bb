#!/usr/bin/env python
# Copyright 2018 The Chromium Authors. All rights reserved.
# Use of this source code is governed by a BSD-style license that can be
# found in the LICENSE file.
#
# Helper script used to update namespace in C++ files generated by fidlgen. This
# is necessary to avoid naming conflicts with existing code in chromium. For
# example ui::Event FIDL interface collides with ui::Event class in chromium.
# This script moves it to fuchsia::ui::Event.
#
# TODO(sergeyu): Remove this script once FIDL files in fuchsia are updated to
# use fuchsia namespace.

import sys
import re

def main(namespace, libname, input_file, output_file):
  with open(input_file) as f:
    text = f.read()

  text = re.sub(r'^namespace\ %s\ \{$' % libname,
                r'namespace %s {\nnamespace %s {' %
                    (namespace, libname),
                text, flags=re.MULTILINE)

  text = re.sub(r'}\ \ // namespace\ %s$' % libname,
                r'}  // namespace %s\n}  // namespace %s'
                    % (libname, namespace),
                text, flags=re.MULTILINE)

  text = re.sub(r'(?<![a-z0-9_])%s::' % libname,
                r'%s::%s::' % (namespace, libname),
                text)

  with open(output_file, "w") as f:
    f.write(text)

if __name__ == "__main__":
  sys.exit(main(*sys.argv[1:]))
