diff -uNr XaoS-3.4/conf13721.sh XaoS-mod/conf13721.sh
--- XaoS-3.4/conf13721.sh	1969-12-31 19:00:00.000000000 -0500
+++ XaoS-mod/conf13721.sh	2008-12-04 19:39:58.881784000 -0500
@@ -0,0 +1,2 @@
+#! /bin/sh
+exit 0
diff -uNr XaoS-3.4/config.sub XaoS-mod/config.sub
--- XaoS-3.4/config.sub	2008-03-10 23:29:22.000000000 -0400
+++ XaoS-mod/config.sub	2008-12-04 19:38:46.208998000 -0500
@@ -715,6 +715,10 @@
 		basic_machine=i370-ibm
 		os=-mvs
 		;;
+	nacl*)
+		basic_machine=i686-pc
+		os=-nacl
+		;;
 	ncr3000)
 		basic_machine=i486-ncr
 		os=-sysv4
@@ -1222,7 +1226,7 @@
 	      | -os2* | -vos* | -palmos* | -uclinux* | -nucleus* \
 	      | -morphos* | -superux* | -rtmk* | -rtmk-nova* | -windiss* \
 	      | -powermax* | -dnix* | -nx6 | -nx7 | -sei* | -dragonfly* \
-	      | -skyos* | -haiku* | -rdos* | -toppers* | -drops*)
+	      | -skyos* | -haiku* | -rdos* | -toppers* | -drops* | -nacl*)
 	# Remember, each alternative MUST END IN *, to match a version number.
 		;;
 	-qnx*)
diff -uNr XaoS-3.4/configure.in XaoS-mod/configure.in
--- XaoS-3.4/configure.in	2008-05-22 15:10:28.000000000 -0400
+++ XaoS-mod/configure.in	2008-12-04 19:38:44.865226000 -0500
@@ -39,6 +39,7 @@
 use_asm=no
 x11_linked=no
 x_driver_test=yes
+nacl_driver_test=yes
 dga_driver_test=no
 ggi_driver_test=no
 gtk_driver_test=no
@@ -632,6 +633,10 @@
     fi
 ])
 
+if test  "$nacl_driver_test" = yes; then
+  nacl_driver=true
+fi
+
 if test "$aa_driver_test" = yes; then
     OLDLIBS="$LIBS"
     OLDCFLAGS="$CFLAGS"
@@ -827,6 +832,16 @@
 fi
 fi
 
+if test "$nacl_driver_test" = yes; then
+if test "x$nacl_driver" = xtrue; then
+  drivers=yes
+  AC_DEFINE(NACL_DRIVER)
+  DRIVERDIRS="$DRIVERDIRS ui/ui-drv/nacl"
+  DRIVERLIBS="$DRIVERLIBS lib/libuinacl.a"
+  echo "   nacl-lib"
+fi
+fi
+
 if test "$gtk_driver_test" = yes; then
 if test "x$gtk_driver" = xtrue; then
   drivers=yes
@@ -1011,6 +1026,7 @@
     src/util/Makefile src/ui/Makefile src/filter/Makefile src/ui-hlp/Makefile
     src/ui/ui-drv/aa/Makefile src/ui/ui-drv/ggi/Makefile
     src/ui/ui-drv/svga/Makefile src/ui/ui-drv/x11/Makefile
+    src/ui/ui-drv/nacl/Makefile
     src/ui/ui-drv/dga/Makefile src/ui/ui-drv/win32/Makefile
     src/ui/ui-drv/BeOS/Makefile doc/Makefile help/Makefile 
     src/ui/ui-drv/gtk/Makefile src/sffe/Makefile
diff -uNr XaoS-3.4/src/i18n/Makefile.in XaoS-mod/src/i18n/Makefile.in
--- XaoS-3.4/src/i18n/Makefile.in	2008-06-01 19:13:25.000000000 -0400
+++ XaoS-mod/src/i18n/Makefile.in	2008-12-04 19:36:22.918238000 -0500
@@ -1,4 +1,4 @@
-PO-FILES= cs.po es.po hu.po fr.po de.po ro.po it.po
+PO-FILES=
 LANGUAGES=$(PO-FILES:.po=)
 
 # Maybe this should be autogenerated by "configure".
diff -uNr XaoS-3.4/src/include/aconfig.h XaoS-mod/src/include/aconfig.h
--- XaoS-3.4/src/include/aconfig.h	1969-12-31 19:00:00.000000000 -0500
+++ XaoS-mod/src/include/aconfig.h	2008-12-04 19:37:31.168548000 -0500
@@ -0,0 +1,60 @@
+/* src/include/aconfig.h.  Generated by configure.  */
+#ifndef ACONFIG_H
+#define ACONFIG_H
+/* #undef HAVE_PTHREAD_SIGHANDLER */
+#define DATAPATH "/usr/local/nacl-sdk//share/XaoS"
+/* #undef C_ALLOCA */
+/* #undef const */
+/* #undef USE_PTHREAD */
+/*Avoid stack frame explosion on Windoze*/
+#ifndef _WIN32
+/*BeOS crashes badly when large amounts of stack are consumed */
+#ifndef __BEOS__
+#define HAVE_ALLOCA 1
+#define HAVE_ALLOCA_H 1
+#endif
+#endif
+/* #undef HAVE_FABSL */
+/* #undef HAVE__FABSL */
+/* #undef HAVE___FABSL */
+/* #undef HAVE_FTIME */
+/* #undef USE_PNG */
+#define HAVE_FINITE 1
+/* #undef HAVE_SELECT */
+/* #undef HAVE_LONG_DOUBLE */
+/* #undef HAVE_REDRAWWIN */
+/* #undef HAVE_WREDRAWLN */
+/* #undef USE_NCURSES */
+/* #undef inline */
+/* #undef _POSIX_SOURCE */
+#define STDC_HEADERS 1
+/* Define if you can safely include both <sys/time.h> and <time.h>.  */
+#define TIME_WITH_SYS_TIME 1
+#define HAVE_GETTIMEOFDAY 1
+/* #undef HAVE_USLEEP */
+/* #undef HAVE_TERMATTRS */
+/* #undef HAVE_MOUSEMASK */
+/* #undef HAVE_SETITIMER */
+/* Define if you have the <limits.h> header file.  */
+#define HAVE_LIMITS_H 1
+/* Define if you have the <sys/time.h> header file.  */
+#define HAVE_SYS_TIME_H 1
+/* Define if you have the <unistd.h> header file.  */
+#define HAVE_UNISTD_H 1
+/* #undef MITSHM */
+/* #undef CURSES_DRIVER */
+/* #undef BEOS_DRIVER */
+/* #undef AA_DRIVER */
+/* #undef GTK_DRIVER */
+/* #undef GGI_DRIVER */
+/* #undef X11_DRIVER */
+/* #undef DGA_DRIVER */
+/* #undef SVGA_DRIVER */
+/* #undef WIN32_DRIVER */
+/* #undef DDRAW_DRIVER */
+#define SIZEOF_SHORT 2
+#define SIZEOF_INT 4
+#define SIZEOF_LONG 4
+/* #undef HAVE_GETTEXT */
+/* #undef NO_MALLOC_H */
+#endif
diff -uNr XaoS-3.4/src/include/config/aconfig.nacl XaoS-mod/src/include/config/aconfig.nacl
--- XaoS-3.4/src/include/config/aconfig.nacl	1969-12-31 19:00:00.000000000 -0500
+++ XaoS-mod/src/include/config/aconfig.nacl	2008-12-04 19:37:23.586637000 -0500
@@ -0,0 +1,28 @@
+/* aconfig.h.  Generated automatically by configure.  */
+#ifndef ACONFIG_H
+#define DATAPATH "./"
+#define ACONFIG_H
+#define HAVE_LONG_DOUBLE 1
+#define USE_PNG
+#define SIZEOF_INT 4
+#define HAVE_FINITE
+#define USE_STDIO
+#define SIZEOF_SHORT 2
+#define SIZEOF_LONG 4
+/* #undef inline */
+/* #undef _POSIX_SOURCE */
+#define STDC_HEADERS 1
+/* Define if you can safely include both <sys/time.h> and <time.h>.  */
+#define TIME_WITH_SYS_TIME 1
+#define HAVE_GETTIMEOFDAY 1
+#define HAVE_MOUSEMASK 1
+#define HAVE_USLEEP 1
+#define USE_ALLEGRO 1
+#define HAVE_UCLOCK 1
+#define HAVE_TERMATTRS 1
+#define HAVE_SETITIMER 1
+#define HAVE_LIMITS_H 1
+#define HAVE_SYS_TIME_H 1
+#define HAVE_UNISTD_H 1
+#define AA_DRIVER 1
+#endif
diff -uNr XaoS-3.4/src/include/config/config.autoconf XaoS-mod/src/include/config/config.autoconf
--- XaoS-3.4/src/include/config/config.autoconf	2008-05-22 15:10:30.000000000 -0400
+++ XaoS-mod/src/include/config/config.autoconf	2008-12-04 19:37:22.908787000 -0500
@@ -2,6 +2,12 @@
 #define CONFIG_H
 #define HOMEDIR
 
+#ifdef __native_client__
+#define HAVE_GETTIMEOFDAY 1
+#define HAVE_UNISTD_H 1
+#define HAVE_UNISTD_H 1
+#endif
+
 #ifdef __BEOS__
 #define MAIN_FUNCTION be_main
 #ifdef __POWERPC__
diff -uNr XaoS-3.4/src/include/config/config.nacl XaoS-mod/src/include/config/config.nacl
--- XaoS-3.4/src/include/config/config.nacl	1969-12-31 19:00:00.000000000 -0500
+++ XaoS-mod/src/include/config/config.nacl	2008-12-04 19:37:23.812640000 -0500
@@ -0,0 +1,28 @@
+#ifndef CONFIG_H
+#define CONFIG_H
+#define CONFIGFILE "xaos.cfg"
+#define FPOINT_TYPE  long double
+				       /*floating point math type on computers
+				          with medium speed floating point math should   
+				          use float instead */
+#define USE_LONG		/*for autoconf..undefine if
+				   fpoint_type is set to other than
+				   long_double */
+/*#define MITSHM */
+				       /*undefine this if you system does not
+				          support shared memory */
+/* You don't need to change these lines unless you now what you are doing */
+
+#include <aconfig.h>
+#define USE_STDIO
+#include <gccaccel.h>
+#define HAVE_GETTIMEOFDAY
+#define TIME_WITH_SYS_TIME
+#define HAVE_LIMITS_H
+#define HAVE_UNISTH_H
+#define HAVE_SYS_TIME_H
+#define 
+#define STRUECOLOR24
+#define STRUECOLOR
+#define STRUECOLOR16
+#endif				/*CONFIG_H */
diff -uNr XaoS-3.4/src/include/version.h XaoS-mod/src/include/version.h
--- XaoS-3.4/src/include/version.h	2008-05-22 15:32:11.000000000 -0400
+++ XaoS-mod/src/include/version.h	2008-12-04 19:37:30.767660000 -0500
@@ -1,6 +1,6 @@
-/* src/include/version.h.  Generated from version.h.in by configure.  */
-/* 
- *     XaoS, a fast portable realtime fractal zoomer 
+/* src/include/version.h.  Generated by configure.  */
+/*
+ *     XaoS, a fast portable realtime fractal zoomer
  *                  Copyright (C) 1996,1997 by
  *
  *      Jan Hubicka          (hubicka@paru.cas.cz)
diff -uNr XaoS-3.4/src/ui/drivers.c XaoS-mod/src/ui/drivers.c
--- XaoS-3.4/src/ui/drivers.c	2008-05-21 16:23:37.000000000 -0400
+++ XaoS-mod/src/ui/drivers.c	2008-12-04 19:35:11.873249000 -0500
@@ -26,7 +26,7 @@
   plan9_driver, plan9_driver, mac_driver, mac_full_driver, osx_driver, 
   osx_fullscreen_driver, os2vio_driver, cocoa_driver, cocoa_fullscreen_driver,
   be_driver, be_direct_driver, be_screen_driver, aalib_driver, gtk_driver, 
-  ggi_driver, win32_driver, dxw_driver, dxf_driver, DGA_driver;
+  ggi_driver, win32_driver, dxw_driver, dxf_driver, DGA_driver, nacl_driver;
 CONST struct ui_driver *CONST drivers[] = {
 #ifdef WIN32_DRIVER
   &win32_driver,
@@ -35,6 +35,9 @@
   &dxw_driver,
   &dxf_driver,
 #endif
+// #ifdef NACL_DRIVER
+  &nacl_driver,
+//#endif
 #ifdef SVGA_DRIVER
   &svga_driver,
 #endif
diff -uNr XaoS-3.4/src/ui/ui-drv/nacl/Makefile.in XaoS-mod/src/ui/ui-drv/nacl/Makefile.in
--- XaoS-3.4/src/ui/ui-drv/nacl/Makefile.in	1969-12-31 19:00:00.000000000 -0500
+++ XaoS-mod/src/ui/ui-drv/nacl/Makefile.in	2008-12-04 19:36:10.235932000 -0500
@@ -0,0 +1,39 @@
+CC     = @CC@
+CFLAGS = @CFLAGS@
+LIBS   = @LIBS@ -lm
+LFLAGS = @LDFLAGS@
+#AR     = @AR@
+RANLIB = @RANLIB@
+
+SRCS = ui_nacl.c 
+
+OBJS = $(SRCS:.c=.o)
+
+TLIB = @LIBPATH@/libuinacl.a
+
+
+all:	$(TLIB)
+
+$(TLIB):$(OBJS)
+	rm -f $@
+	$(AR) rc $@ $^
+	$(RANLIB) $@ 
+
+clean:
+	rm -f $(TLIB)
+	rm -f *.[oas]
+	rm -f *~
+	rm -f core 
+
+distclean:clean
+	rm  Makefile
+
+#dep:
+#	rm -f .depend
+#	make .depend
+#
+#.depend:
+#	echo '# Program dependencies' >.depend
+#	gcc -I svgalib $(DEFINES) -MM $(patsubst %.o,%.c,$(OBJS)) >>.depend
+#
+#include .depend
diff -uNr XaoS-3.4/src/ui/ui-drv/nacl/ui_nacl.c XaoS-mod/src/ui/ui-drv/nacl/ui_nacl.c
--- XaoS-3.4/src/ui/ui-drv/nacl/ui_nacl.c	1969-12-31 19:00:00.000000000 -0500
+++ XaoS-mod/src/ui/ui-drv/nacl/ui_nacl.c	2008-12-04 19:36:10.010062000 -0500
@@ -0,0 +1,272 @@
+#include "aconfig.h"
+// #ifdef NACL_DRIVER
+/*includes */
+#include <ui.h>
+#include <sys/audio_video.h>
+#include <stdlib.h>
+#include <string.h>
+
+char* getcwd(char* buf, size_t size) {strcpy(buf, "/tmp"); return buf;}
+extern struct ui_driver nacl_driver;
+
+static int width = NACL_DIM_W;
+static int height = NACL_DIM_H;
+static int depth = 32;
+static int currentbuf = 0;
+static void* buffers[2] = { NULL, NULL };
+static int mouse;
+
+static int
+nacl_set_color (int r, int g, int b, int init)
+{
+  return ( /*pixel value or -1 for full palette */ -1);
+}
+
+static void
+nacl_setpalette (ui_palette pal, int start, int end)
+{
+}
+
+static void
+nacl_print (int x, int y, CONST char *text)
+{
+}
+
+static void
+nacl_display ()
+{
+  nacl_video_update(buffers[currentbuf]);
+}
+
+static void
+nacl_flip_buffers ()
+{
+  currentbuf ^= 1;
+}
+
+void
+nacl_free_buffers (char *b1, char *b2)
+{
+  free(buffers[0]);
+  free(buffers[1]);
+}
+
+int
+nacl_alloc_buffers (char **b1, char **b2)
+{
+  buffers[0] = malloc(height * width * depth / 8);
+  if (NULL == buffers[0]) {
+    return 0;
+  }
+  *b1 = buffers[0];
+  buffers[1] = malloc(height * width * depth / 8);
+  if (NULL == buffers[1]) {
+    return 0;
+  }
+  *b2 = buffers[1];
+  return width * (depth / 8);			/* bytes per scanline */
+}
+
+static void
+nacl_getsize (int *w, int *h)
+{
+  *w = width;
+  *h = height;
+}
+
+
+static void
+nacl_processevents (int wait, int *mx, int *my, int *mb, int *k)
+{
+  union NaClMultimediaEvent event;
+  static unsigned int mousebuttons = 0;
+  static unsigned int mousex = 100;
+  static unsigned int mousey = 0;
+  static int iflag = 0;
+
+  if (0 == nacl_video_poll_event(&event)) {
+    switch (event.type) {
+      case NACL_EVENT_MOUSE_MOTION:
+        mousex = event.motion.x;
+        mousey = event.motion.y;
+        break;
+      case NACL_EVENT_MOUSE_BUTTON_DOWN:
+        switch (event.button.button) {
+          case NACL_MOUSE_BUTTON_LEFT:
+            mousebuttons |= BUTTON1;
+            break;
+          case NACL_MOUSE_BUTTON_MIDDLE:
+            mousebuttons |= BUTTON2;
+            break;
+          case NACL_MOUSE_BUTTON_RIGHT:
+            mousebuttons |= BUTTON3;
+            break;
+          default:
+            break;
+        }
+        break;
+      case NACL_EVENT_MOUSE_BUTTON_UP:
+        switch (event.button.button) {
+          case NACL_MOUSE_BUTTON_LEFT:
+            mousebuttons &= ~BUTTON1;
+            break;
+          case NACL_MOUSE_BUTTON_MIDDLE:
+            mousebuttons &= ~BUTTON2;
+            break;
+          case NACL_MOUSE_BUTTON_RIGHT:
+            mousebuttons &= ~BUTTON3;
+            break;
+          default:
+            break;
+        }
+        break;
+      case NACL_EVENT_KEY_DOWN:
+        switch (event.key.keysym.sym) {
+          case NACL_KEY_LEFT:
+            iflag |= 1;
+            ui_key (UIKEY_LEFT);
+            break;
+          case NACL_KEY_RIGHT:
+            iflag |= 2;
+            ui_key (UIKEY_RIGHT);
+            break;
+          case NACL_KEY_UP:
+            iflag |= 4;
+            ui_key (UIKEY_UP);
+            break;
+          case NACL_KEY_DOWN:
+            iflag |= 8;
+            ui_key (UIKEY_DOWN);
+            break;
+          case NACL_KEY_PAGEUP:
+            iflag |= 4;
+            ui_key (UIKEY_PGUP);
+            break;
+          case NACL_KEY_PAGEDOWN:
+            iflag |= 8;
+            ui_key (UIKEY_PGDOWN);
+            break;
+          case NACL_KEY_ESCAPE:
+            ui_key (UIKEY_ESC);
+            break;
+          case NACL_KEY_BACKSPACE:
+            ui_key (UIKEY_BACKSPACE);
+            break;
+          default:
+            if (event.key.keysym.sym > 0 && event.key.keysym.sym < 128) {
+              ui_key (event.key.keysym.sym);
+            }
+            break;
+        }
+        break;
+      case NACL_EVENT_KEY_UP:
+        switch (event.key.keysym.sym) {
+          case NACL_KEY_LEFT:
+            iflag &= ~1;
+            break;
+          case NACL_KEY_RIGHT:
+            iflag &= ~2;
+            break;
+          case NACL_KEY_UP:
+            iflag &= ~4;
+            break;
+          case NACL_KEY_DOWN:
+            iflag &= ~8;
+            break;
+          case NACL_KEY_PAGEUP:
+            iflag &= ~4;
+            break;
+          case NACL_KEY_PAGEDOWN:
+            iflag &= ~8;
+            break;
+          default:
+            break;
+        }
+        break;
+      default:
+        break;
+    }
+  }
+  *mx = mousex;
+  *my = mousey;
+  *mb = mousebuttons;
+  *k = iflag;
+}
+
+static int
+nacl_init ()
+{
+  int retval;
+  retval = nacl_multimedia_init(NACL_SUBSYSTEM_VIDEO | NACL_SUBSYSTEM_EMBED);
+  if (0 != retval) {
+    return 0;
+  }
+  retval = nacl_video_init(width, height);
+  if (0 != retval) {
+    return 0;
+  }
+  nacl_driver.rmask = 0x00ff0000;
+  nacl_driver.gmask = 0x0000ff00;
+  nacl_driver.bmask = 0x000000ff;
+  return 1; /*1 for success 0 for fail */
+}
+
+static void
+nacl_uninitialise ()
+{
+  nacl_video_shutdown();
+  nacl_multimedia_shutdown();
+}
+
+static void
+nacl_getmouse (int *x, int *y, int *b)
+{
+}
+
+
+static void
+nacl_mousetype (int type)
+{
+}
+
+static void
+nacl_flush (void) {
+  /* nacl_video_update(buffers[currentbuf]); */
+}
+
+static struct params params[] = {
+  {"", P_HELP, NULL, "Template driver options:"},
+  // {"-flag", P_SWITCH, &variable, "Example flag..."},
+  {NULL, 0, NULL, NULL}
+};
+
+struct ui_driver nacl_driver = {
+  "Native Client",
+  nacl_init,
+  nacl_getsize,
+  nacl_processevents,
+  nacl_getmouse,
+  nacl_uninitialise,
+  NULL, /* nacl_set_color, You should implement just one */
+  nacl_setpalette, /* nacl_setpalette, of these and add NULL as second */
+  nacl_print,
+  nacl_display,
+  nacl_alloc_buffers,
+  nacl_free_buffers,
+  nacl_flip_buffers,
+  NULL, /* nacl_mousetype. This should be NULL */
+  nacl_flush,				/*flush */
+  8,				/*text width */
+  8,				/*text height */
+  params, /* params */
+  0,				/*flags...see ui.h */
+  0.0, 0.0,			/*width/height of screen in centimeters */
+  0, 0,				/*resolution of screen for windowed systems */
+  UI_TRUECOLOR,			/*Image type */
+  0, 255, 255			/*start, end of palette and maximum allocatable */
+    /*entries */
+};
+
+/* DONT FORGET TO ADD DOCUMENTATION ABOUT YOUR DRIVER INTO xaos.hlp FILE!*/
+
+// #endif
diff -uNr XaoS-3.4/src/ui/ui.c XaoS-mod/src/ui/ui.c
--- XaoS-3.4/src/ui/ui.c	2008-05-21 16:23:37.000000000 -0400
+++ XaoS-mod/src/ui/ui.c	2008-12-04 19:35:11.034308000 -0500
@@ -1425,6 +1425,7 @@
   globaluih = uih =
     uih_mkcontext (driver->flags, image, ui_passfunc, ui_message,
 		   ui_updatemenus);
+  driver->print (0, 0, "done with uih_mkcontext");
   if (driver->gui_driver && driver->gui_driver->setrootmenu)
     driver->gui_driver->setrootmenu (uih, uih->menuroot);
   ui_flush ();
diff -uNr XaoS-3.4/src/ui-hlp/save.c XaoS-mod/src/ui-hlp/save.c
--- XaoS-3.4/src/ui-hlp/save.c	2008-03-05 06:02:10.000000000 -0500
+++ XaoS-mod/src/ui-hlp/save.c	2008-12-04 19:37:08.425756000 -0500
@@ -695,8 +695,9 @@
       last = 1;
       if (uih->savec->mode >= UIH_SAVEANIMATION)
 	uih_saveframe (uih);
-      if (xio_close (uih->savec->file))
+      if (xio_close (uih->savec->file)) {
 	outputerror (uih);
+      }
       uih->save = 0;
       free (uih->savec->fcontext);
       tl_free_timer (uih->savec->timer);
diff -uNr XaoS-3.4/src/util/timers.c XaoS-mod/src/util/timers.c
--- XaoS-3.4/src/util/timers.c	2004-11-24 02:11:51.000000000 -0500
+++ XaoS-mod/src/util/timers.c	2008-12-04 19:36:32.933840000 -0500
@@ -222,6 +222,7 @@
 #ifndef HAVE_FTIME
 #ifndef _plan9_
 #ifndef _MAC
+#ifndef __native_client__
 #error I am unable to get time in milisecond. Please edit timers.c and make tl_update_time and tl_lookup_timer to work for your architecture and send me then back(to hubicka@paru.cas.cz). You will need also define timers.h and change type of lasttime.
 #endif
 #endif
@@ -229,6 +230,7 @@
 #endif
 #endif
 #endif
+#endif
 
 
 #ifdef USE_ALLEGRO
