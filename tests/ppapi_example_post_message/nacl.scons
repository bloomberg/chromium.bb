# -*- python -*-
# Copyright (c) 2011 The Native Client Authors. All rights reserved.
# Use of this source code is governed by a BSD-style license that can be
# found in the LICENSE file.

# This is a Pepper PostMessage example from ppapi/examples/scripting.

Import('env')

env.Prepend(CPPDEFINES=['XP_UNIX'])

nexe_name = 'ppapi_example_post_message_${TARGET_FULLARCH}'
nexe = env.ComponentProgram(
    nexe_name,
    ['$MAIN_DIR/src/third_party/ppapi/examples/scripting/post_message.cc'],
    EXTRA_LIBS=['${PPAPI_LIBS}', 'ppapi_cpp'])

# Note that the html is required to run this program.
env.Publish(nexe_name, 'run',
            ['ppapi_example_post_message.html',
             'ppapi_example_post_message.nmf'])


test = env.PPAPIBrowserTester(
    'ppapi_example_post_message_test.out',
    url='ppapi_example_post_message.html',
    files=env.ExtractPublishedFiles(nexe_name),
    args=['--enable_experimental_js'])

env.AddNodeToTestSuite(test,
                       ['chrome_browser_tests'],
                       'run_ppapi_example_post_message_test',
                       is_broken=env.PPAPIBrowserTesterIsBroken())
